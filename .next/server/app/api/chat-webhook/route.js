(()=>{var e={};e.id=541,e.ids=[541],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{"use strict";e.exports=require("buffer")},6162:e=>{"use strict";e.exports=require("worker_threads")},7742:e=>{"use strict";e.exports=require("node:process")},2477:e=>{"use strict";e.exports=require("node:stream/web")},1111:(e,t,r)=>{"use strict";let n,o,s,a;r.r(t),r.d(t,{originalPathname:()=>oG,patchFetch:()=>oQ,requestAsyncStorage:()=>oX,routeModule:()=>oJ,serverHooks:()=>oK,staticGenerationAsyncStorage:()=>oY});var i,l,c,u,d,h,p,f,m,g,b,y,_,w,v,S,x,R,P,T,k,$,E,A,O,C,j,q,I,D,L,B,N,M,W,z,U,F,H,V,J,X,Y,K,G,Q,Z,ee,et,er,en,eo,es,ea,ei,el,ec,eu,ed,eh,ep,ef,em,eg,eb,ey,e_,ew,ev,eS,ex,eR,eP,eT,ek,e$,eE={};r.r(eE),r.d(eE,{POST:()=>oS});var eA=r(3278),eO=r(5002),eC=r(4877),ej=r(1658);let eq=require("node:http"),eI=require("node:https"),eD=require("node:zlib"),eL=require("node:stream"),eB=require("node:buffer"),eN=function(e){if(!/^data:/i.test(e))throw TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');let t=(e=e.replace(/\r?\n/g,"")).indexOf(",");if(-1===t||t<=4)throw TypeError("malformed data: URI");let r=e.substring(5,t).split(";"),n="",o=!1,s=r[0]||"text/plain",a=s;for(let e=1;e<r.length;e++)"base64"===r[e]?o=!0:r[e]&&(a+=`;${r[e]}`,0===r[e].indexOf("charset=")&&(n=r[e].substring(8)));r[0]||n.length||(a+=";charset=US-ASCII",n="US-ASCII");let i=o?"base64":"ascii",l=unescape(e.substring(t+1)),c=Buffer.from(l,i);return c.type=s,c.typeFull=a,c.charset=n,c},eM=require("node:util");var eW=r(598),ez=r(8620);class eU extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class eF extends eU{constructor(e,t,r){super(e,t),r&&(this.code=this.errno=r.code,this.erroredSysCall=r.syscall)}}let eH=Symbol.toStringTag,eV=e=>"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&"function"==typeof e.sort&&"URLSearchParams"===e[eH],eJ=e=>e&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&/^(Blob|File)$/.test(e[eH]),eX=e=>"object"==typeof e&&("AbortSignal"===e[eH]||"EventTarget"===e[eH]),eY=(e,t)=>{let r=new URL(t).hostname,n=new URL(e).hostname;return r===n||r.endsWith(`.${n}`)},eK=(e,t)=>new URL(t).protocol===new URL(e).protocol,eG=(0,eM.promisify)(eL.pipeline),eQ=Symbol("Body internals");class eZ{constructor(e,{size:t=0}={}){let r=null;null===e?e=null:eV(e)?e=eB.Buffer.from(e.toString()):eJ(e)||eB.Buffer.isBuffer(e)||(eM.types.isAnyArrayBuffer(e)?e=eB.Buffer.from(e):ArrayBuffer.isView(e)?e=eB.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof eL||(e instanceof ez.Ct?r=(e=(0,ez.au)(e)).type.split("=")[1]:e=eB.Buffer.from(String(e))));let n=e;eB.Buffer.isBuffer(e)?n=eL.Readable.from(e):eJ(e)&&(n=eL.Readable.from(e.stream())),this[eQ]={body:e,stream:n,boundary:r,disturbed:!1,error:null},this.size=t,e instanceof eL&&e.on("error",e=>{let t=e instanceof eU?e:new eF(`Invalid response body while trying to fetch ${this.url}: ${e.message}`,"system",e);this[eQ].error=t})}get body(){return this[eQ].stream}get bodyUsed(){return this[eQ].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:t,byteLength:r}=await e0(this);return e.slice(t,t+r)}async formData(){let e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){let e=new ez.Ct;for(let[t,r]of new URLSearchParams(await this.text()))e.append(t,r);return e}let{toFormData:t}=await r.e(891).then(r.bind(r,8891));return t(this.body,e)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[eQ].body&&this[eQ].body.type||"",t=await this.arrayBuffer();return new eW.Z([t],{type:e})}async json(){return JSON.parse(await this.text())}async text(){let e=await e0(this);return new TextDecoder().decode(e)}buffer(){return e0(this)}}async function e0(e){if(e[eQ].disturbed)throw TypeError(`body used already for: ${e.url}`);if(e[eQ].disturbed=!0,e[eQ].error)throw e[eQ].error;let{body:t}=e;if(null===t||!(t instanceof eL))return eB.Buffer.alloc(0);let r=[],n=0;try{for await(let o of t){if(e.size>0&&n+o.length>e.size){let r=new eF(`content size at ${e.url} over limit: ${e.size}`,"max-size");throw t.destroy(r),r}n+=o.length,r.push(o)}}catch(t){throw t instanceof eU?t:new eF(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t)}if(!0===t.readableEnded||!0===t._readableState.ended)try{if(r.every(e=>"string"==typeof e))return eB.Buffer.from(r.join(""));return eB.Buffer.concat(r,n)}catch(t){throw new eF(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t)}else throw new eF(`Premature close of server response while trying to fetch ${e.url}`)}eZ.prototype.buffer=(0,eM.deprecate)(eZ.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer"),Object.defineProperties(eZ.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:(0,eM.deprecate)(()=>{},"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});let e1=(e,t)=>{let r,n;let{body:o}=e[eQ];if(e.bodyUsed)throw Error("cannot clone body after it is used");return o instanceof eL&&"function"!=typeof o.getBoundary&&(r=new eL.PassThrough({highWaterMark:t}),n=new eL.PassThrough({highWaterMark:t}),o.pipe(r),o.pipe(n),e[eQ].stream=r,o=n),o},e2=(0,eM.deprecate)(e=>e.getBoundary(),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),e3=(e,t)=>null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":eV(e)?"application/x-www-form-urlencoded;charset=UTF-8":eJ(e)?e.type||null:eB.Buffer.isBuffer(e)||eM.types.isAnyArrayBuffer(e)||ArrayBuffer.isView(e)?null:e instanceof ez.Ct?`multipart/form-data; boundary=${t[eQ].boundary}`:e&&"function"==typeof e.getBoundary?`multipart/form-data;boundary=${e2(e)}`:e instanceof eL?null:"text/plain;charset=UTF-8",e8=e=>{let{body:t}=e[eQ];return null===t?0:eJ(t)?t.size:eB.Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null},e4=async(e,{body:t})=>{null===t?e.end():await eG(t,e)},e6="function"==typeof eq.validateHeaderName?eq.validateHeaderName:e=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(e)){let t=TypeError(`Header name must be a valid HTTP token [${e}]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),t}},e5="function"==typeof eq.validateHeaderValue?eq.validateHeaderValue:(e,t)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(t)){let t=TypeError(`Invalid character in header content ["${e}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}};class e9 extends URLSearchParams{constructor(e){let t=[];if(e instanceof e9)for(let[r,n]of Object.entries(e.raw()))t.push(...n.map(e=>[r,e]));else if(null==e);else if("object"!=typeof e||eM.types.isBoxedPrimitive(e))throw TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");else{let r=e[Symbol.iterator];if(null==r)t.push(...Object.entries(e));else{if("function"!=typeof r)throw TypeError("Header pairs must be iterable");t=[...e].map(e=>{if("object"!=typeof e||eM.types.isBoxedPrimitive(e))throw TypeError("Each header pair must be an iterable object");return[...e]}).map(e=>{if(2!==e.length)throw TypeError("Each header pair must be a name/value tuple");return[...e]})}}return super(t=t.length>0?t.map(([e,t])=>(e6(e),e5(e,String(t)),[String(e).toLowerCase(),String(t)])):void 0),new Proxy(this,{get(e,t,r){switch(t){case"append":case"set":return(r,n)=>(e6(r),e5(r,String(n)),URLSearchParams.prototype[t].call(e,String(r).toLowerCase(),String(n)));case"delete":case"has":case"getAll":return r=>(e6(r),URLSearchParams.prototype[t].call(e,String(r).toLowerCase()));case"keys":return()=>(e.sort(),new Set(URLSearchParams.prototype.keys.call(e)).keys());default:return Reflect.get(e,t,r)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let t=this.getAll(e);if(0===t.length)return null;let r=t.join(", ");return/^content-encoding$/i.test(e)&&(r=r.toLowerCase()),r}forEach(e,t){for(let r of this.keys())Reflect.apply(e,t,[this.get(r),r,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,t)=>(e[t]=this.getAll(t),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,t)=>{let r=this.getAll(t);return"host"===t?e[t]=r[0]:e[t]=r.length>1?r:r[0],e},{})}}Object.defineProperties(e9.prototype,["get","entries","forEach","values"].reduce((e,t)=>(e[t]={enumerable:!0},e),{}));let e7=new Set([301,302,303,307,308]),te=e=>e7.has(e),tt=Symbol("Response internals");class tr extends eZ{constructor(e=null,t={}){super(e,t);let r=null!=t.status?t.status:200,n=new e9(t.headers);if(null!==e&&!n.has("Content-Type")){let t=e3(e,this);t&&n.append("Content-Type",t)}this[tt]={type:"default",url:t.url,status:r,statusText:t.statusText||"",headers:n,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[tt].type}get url(){return this[tt].url||""}get status(){return this[tt].status}get ok(){return this[tt].status>=200&&this[tt].status<300}get redirected(){return this[tt].counter>0}get statusText(){return this[tt].statusText}get headers(){return this[tt].headers}get highWaterMark(){return this[tt].highWaterMark}clone(){return new tr(e1(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!te(t))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');return new tr(null,{headers:{location:new URL(e).toString()},status:t})}static error(){let e=new tr(null,{status:0,statusText:""});return e[tt].type="error",e}static json(e,t={}){let r=JSON.stringify(e);if(void 0===r)throw TypeError("data is not JSON serializable");let n=new e9(t&&t.headers);return n.has("content-type")||n.set("content-type","application/json"),new tr(r,{...t,headers:n})}get[Symbol.toStringTag](){return"Response"}}Object.defineProperties(tr.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});let tn=require("node:url"),to=e=>{if(e.search)return e.search;let t=e.href.length-1,r=e.hash||("#"===e.href[t]?"#":"");return"?"===e.href[t-r.length]?"?":""},ts=require("node:net");function ta(e,t=!1){return null==e?"no-referrer":(e=new URL(e),/^(about|blob|data):$/.test(e.protocol))?"no-referrer":(e.username="",e.password="",e.hash="",t&&(e.pathname="",e.search=""),e)}let ti=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]);function tl(e){return!!(/^about:(blank|srcdoc)$/.test(e)||"data:"===e.protocol||/^(blob|filesystem):$/.test(e.protocol))||function(e){if(/^(http|ws)s:$/.test(e.protocol))return!0;let t=e.host.replace(/(^\[)|(]$)/g,""),r=(0,ts.isIP)(t);return!!(4===r&&/^127\./.test(t)||6===r&&/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(t))||!("localhost"===e.host||e.host.endsWith(".localhost"))&&"file:"===e.protocol}(e)}let tc=Symbol("Request internals"),tu=e=>"object"==typeof e&&"object"==typeof e[tc],td=(0,eM.deprecate)(()=>{},".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)");class th extends eZ{constructor(e,t={}){let r;if(tu(e)?r=new URL(e.url):(r=new URL(e),e={}),""!==r.username||""!==r.password)throw TypeError(`${r} is an url with embedded credentials.`);let n=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(n)&&(n=n.toUpperCase()),!tu(t)&&"data"in t&&td(),(null!=t.body||tu(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw TypeError("Request with GET/HEAD method cannot have body");let o=t.body?t.body:tu(e)&&null!==e.body?e1(e):null;super(o,{size:t.size||e.size||0});let s=new e9(t.headers||e.headers||{});if(null!==o&&!s.has("Content-Type")){let e=e3(o,this);e&&s.set("Content-Type",e)}let a=tu(e)?e.signal:null;if("signal"in t&&(a=t.signal),null!=a&&!eX(a))throw TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");let i=null==t.referrer?e.referrer:t.referrer;if(""===i)i="no-referrer";else if(i){let e=new URL(i);i=/^about:(\/\/)?client$/.test(e)?"client":e}else i=void 0;this[tc]={method:n,redirect:t.redirect||e.redirect||"follow",headers:s,parsedURL:r,signal:a,referrer:i},this.follow=void 0===t.follow?void 0===e.follow?20:e.follow:t.follow,this.compress=void 0===t.compress?void 0===e.compress||e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[tc].method}get url(){return(0,tn.format)(this[tc].parsedURL)}get headers(){return this[tc].headers}get redirect(){return this[tc].redirect}get signal(){return this[tc].signal}get referrer(){return"no-referrer"===this[tc].referrer?"":"client"===this[tc].referrer?"about:client":this[tc].referrer?this[tc].referrer.toString():void 0}get referrerPolicy(){return this[tc].referrerPolicy}set referrerPolicy(e){this[tc].referrerPolicy=function(e){if(!ti.has(e))throw TypeError(`Invalid referrerPolicy: ${e}`);return e}(e)}clone(){return new th(this)}get[Symbol.toStringTag](){return"Request"}}Object.defineProperties(th.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});let tp=e=>{let{parsedURL:t}=e[tc],r=new e9(e[tc].headers);r.has("Accept")||r.set("Accept","*/*");let n=null;if(null===e.body&&/^(post|put)$/i.test(e.method)&&(n="0"),null!==e.body){let t=e8(e);"number"!=typeof t||Number.isNaN(t)||(n=String(t))}n&&r.set("Content-Length",n),""===e.referrerPolicy&&(e.referrerPolicy="strict-origin-when-cross-origin"),e.referrer&&"no-referrer"!==e.referrer?e[tc].referrer=function(e,{referrerURLCallback:t,referrerOriginCallback:r}={}){if("no-referrer"===e.referrer||""===e.referrerPolicy)return null;let n=e.referrerPolicy;if("about:client"===e.referrer)return"no-referrer";let o=e.referrer,s=ta(o),a=ta(o,!0);s.toString().length>4096&&(s=a),t&&(s=t(s)),r&&(a=r(a));let i=new URL(e.url);switch(n){case"no-referrer":return"no-referrer";case"origin":return a;case"unsafe-url":return s;case"strict-origin":if(tl(s)&&!tl(i))return"no-referrer";return a.toString();case"strict-origin-when-cross-origin":if(s.origin===i.origin)return s;if(tl(s)&&!tl(i))return"no-referrer";return a;case"same-origin":if(s.origin===i.origin)return s;return"no-referrer";case"origin-when-cross-origin":if(s.origin===i.origin)return s;return a;case"no-referrer-when-downgrade":if(tl(s)&&!tl(i))return"no-referrer";return s;default:throw TypeError(`Invalid referrerPolicy: ${n}`)}}(e):e[tc].referrer="no-referrer",e[tc].referrer instanceof URL&&r.set("Referer",e.referrer),r.has("User-Agent")||r.set("User-Agent","node-fetch"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip, deflate, br");let{agent:o}=e;"function"==typeof o&&(o=o(t));let s=to(t),a={path:t.pathname+s,method:e.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:e.insecureHTTPParser,agent:o};return{parsedURL:t,options:a}};class tf extends eU{constructor(e,t="aborted"){super(e,t)}}r(2591);let tm=new Set(["data:","http:","https:"]);async function tg(e,t){return new Promise((r,n)=>{let o=new th(e,t),{parsedURL:s,options:a}=tp(o);if(!tm.has(s.protocol))throw TypeError(`node-fetch cannot load ${e}. URL scheme "${s.protocol.replace(/:$/,"")}" is not supported.`);if("data:"===s.protocol){let e=eN(o.url);r(new tr(e,{headers:{"Content-Type":e.typeFull}}));return}let i=("https:"===s.protocol?eI:eq).request,{signal:l}=o,c=null,u=()=>{let e=new tf("The operation was aborted.");n(e),o.body&&o.body instanceof eL.Readable&&o.body.destroy(e),c&&c.body&&c.body.emit("error",e)};if(l&&l.aborted){u();return}let d=()=>{u(),p()},h=i(s.toString(),a);l&&l.addEventListener("abort",d);let p=()=>{h.abort(),l&&l.removeEventListener("abort",d)};h.on("error",e=>{n(new eF(`request to ${o.url} failed, reason: ${e.message}`,"system",e)),p()}),function(e,t){let r;let n=eB.Buffer.from("0\r\n\r\n"),o=!1,s=!1;e.on("response",e=>{let{headers:t}=e;o="chunked"===t["transfer-encoding"]&&!t["content-length"]}),e.on("socket",a=>{let i=()=>{if(o&&!s){let e=Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",t(e)}},l=e=>{(s=0===eB.Buffer.compare(e.slice(-5),n))||!r||(s=0===eB.Buffer.compare(r.slice(-3),n.slice(0,3))&&0===eB.Buffer.compare(e.slice(-2),n.slice(3))),r=e};a.prependListener("close",i),a.on("data",l),e.on("close",()=>{a.removeListener("close",i),a.removeListener("data",l)})})}(h,e=>{c&&c.body&&c.body.destroy(e)}),process.version<"v14"&&h.on("socket",e=>{let t;e.prependListener("end",()=>{t=e._eventsCount}),e.prependListener("close",r=>{if(c&&t<e._eventsCount&&!r){let e=Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",c.body.emit("error",e)}})}),h.on("response",e=>{h.setTimeout(0);let s=function(e=[]){return new e9(e.reduce((e,t,r,n)=>(r%2==0&&e.push(n.slice(r,r+2)),e),[]).filter(([e,t])=>{try{return e6(e),e5(e,String(t)),!0}catch{return!1}}))}(e.rawHeaders);if(te(e.statusCode)){let a=s.get("Location"),i=null;try{i=null===a?null:new URL(a,o.url)}catch{if("manual"!==o.redirect){n(new eF(`uri requested responds with an invalid redirect URL: ${a}`,"invalid-redirect")),p();return}}switch(o.redirect){case"error":n(new eF(`uri requested responds with a redirect, redirect mode is set to error: ${o.url}`,"no-redirect")),p();return;case"manual":break;case"follow":{if(null===i)break;if(o.counter>=o.follow){n(new eF(`maximum redirect reached at: ${o.url}`,"max-redirect")),p();return}let a={headers:new e9(o.headers),follow:o.follow,counter:o.counter+1,agent:o.agent,compress:o.compress,method:o.method,body:e1(o),signal:o.signal,size:o.size,referrer:o.referrer,referrerPolicy:o.referrerPolicy};if(!eY(o.url,i)||!eK(o.url,i))for(let e of["authorization","www-authenticate","cookie","cookie2"])a.headers.delete(e);if(303!==e.statusCode&&o.body&&t.body instanceof eL.Readable){n(new eF("Cannot follow redirect with body being a readable stream","unsupported-redirect")),p();return}(303===e.statusCode||(301===e.statusCode||302===e.statusCode)&&"POST"===o.method)&&(a.method="GET",a.body=void 0,a.headers.delete("content-length"));let l=function(e){let t=(e.get("referrer-policy")||"").split(/[,\s]+/),r="";for(let e of t)e&&ti.has(e)&&(r=e);return r}(s);l&&(a.referrerPolicy=l),r(tg(new th(i,a))),p();return}default:return n(TypeError(`Redirect option '${o.redirect}' is not a valid value of RequestRedirect`))}}l&&e.once("end",()=>{l.removeEventListener("abort",d)});let a=(0,eL.pipeline)(e,new eL.PassThrough,e=>{e&&n(e)});process.version<"v12.10"&&e.on("aborted",d);let i={url:o.url,status:e.statusCode,statusText:e.statusMessage,headers:s,size:o.size,counter:o.counter,highWaterMark:o.highWaterMark},u=s.get("Content-Encoding");if(!o.compress||"HEAD"===o.method||null===u||204===e.statusCode||304===e.statusCode){r(c=new tr(a,i));return}let f={flush:eD.Z_SYNC_FLUSH,finishFlush:eD.Z_SYNC_FLUSH};if("gzip"===u||"x-gzip"===u){r(c=new tr(a=(0,eL.pipeline)(a,eD.createGunzip(f),e=>{e&&n(e)}),i));return}if("deflate"===u||"x-deflate"===u){let t=(0,eL.pipeline)(e,new eL.PassThrough,e=>{e&&n(e)});t.once("data",e=>{r(c=new tr(a=(15&e[0])==8?(0,eL.pipeline)(a,eD.createInflate(),e=>{e&&n(e)}):(0,eL.pipeline)(a,eD.createInflateRaw(),e=>{e&&n(e)}),i))}),t.once("end",()=>{c||r(c=new tr(a,i))});return}if("br"===u){r(c=new tr(a=(0,eL.pipeline)(a,eD.createBrotliDecompress(),e=>{e&&n(e)}),i));return}r(c=new tr(a,i))}),e4(h,o).catch(n)})}let tb={comercial:9025,soporte:9023,supervision:9048},ty={soporte:75071,principal:75070};tb.comercial,tb.soporte,tb.supervision;let t_=["\xa1Hola! \xbfC\xf3mo est\xe1s hoy?","\xa1Bienvenido! Estoy aqu\xed para ayudarte.","Hola, gracias por contactarnos, \xbfen qu\xe9 puedo ayudarte?","\xa1Hola! \xbfNecesitas algo?","Hola, \xbfcu\xe1l es tu pregunta o inquietud?","\xa1Bienvenido! Te escucho, \xbfqu\xe9 necesitas?"],tw=["\xa1Hasta luego, que tengas un excelente d\xeda!","Gracias por tu tiempo, aqu\xed estar\xe9 si necesitas algo m\xe1s.","\xa1Que tengas un gran d\xeda, nos vemos pronto!","Gracias por confiar en nosotros, te esperamos para la pr\xf3xima.","Adi\xf3s por ahora, esperamos que hayas disfrutado de tu experiencia.","\xa1Hasta luego! Esperamos verte pronto por aqu\xed.","Gracias por tu tiempo, que tengas un excelente d\xeda.","Que tengas un excelente d\xeda, no dudes en hacernos saber si necesitas algo m\xe1s.","\xa1Que tengas un gran d\xeda! No dudes en preguntar si tienes otra pregunta."],tv=["\xa1Hola! Te escribo para ver si necesitas algo.","\xbfNecesitas algo? Estamos aqu\xed para ayudarte.","Hola, \xbfc\xf3mo est\xe1s? Te recuerdo que estamos aqu\xed para ayudarte.","Te hacemos saber que seguimos aqu\xed para ayudarte.","\xa1Hola! \xbfNecesitas algo? No dudes en hacernos saber.","Hola, esperamos que hayas disfrutado de tu experiencia.","Te agradecemos que nos contactes, \xbfnecesitas algo?","Que tengas un excelente d\xeda, no dudes en hacernos saber si necesitas algo m\xe1s.","Es un placer ayudarte, no dudes en hacernos saber si necesitas algo."],tS={principal:{assignTeamId:tb.comercial,tags:["lead_calificado","marketing"],priority:"high"},soporte:{assignTeamId:tb.soporte,tags:["soporte_incidente"],priority:"medium"},supervision:{assignTeamId:tb.supervision,tags:["escalado_supervision"],priority:"high"}};function tx(e){return e[Math.floor(Math.random()*e.length)]}function tR(e,t){return t?e.map(e=>e.replace(/Déjanos tu teléfono|Proporciona tu teléfono|Déjanos tu número/g,"Atenderemos tu solicitud de forma prioritaria").trim()):e}let tP=[{triggers:["precio","plan","demo","contratar","suscripci\xf3n","costo"],response:e=>tx(tR(["\uD83D\uDCBC \xa1Hola! Para consultas sobre planes o demos, podemos enviarte todos los detalles. D\xe9janos tu tel\xe9fono y te contactaremos con informaci\xf3n y promociones exclusivas, incluyendo un caso de \xe9xito reciente que muestra c\xf3mo optimizamos procesos para empresas como la tuya.","\uD83D\uDCBC \xa1Hola! Queremos ayudarte a elegir el plan adecuado. Proporciona tu tel\xe9fono y te enviaremos toda la informaci\xf3n junto con nuestra oferta especial de esta semana."],e)),inbox:"principal",tags:["lead_calificado","consulta_precio","marketing"],controlTag:"kb_respondida_demo",maxResponses:2,exceededResponse:"\xa1Gracias por tu tiempo! No dudes en hacernos saber si necesitas algo m\xe1s."},{triggers:["descuento","promoci\xf3n","oferta","rebaja","cup\xf3n","promociones"],response:e=>tx(tR(["\uD83C\uDF81 \xa1Tenemos ofertas especiales este mes! D\xe9janos tu tel\xe9fono y te enviaremos los detalles directamente. Por ejemplo, nuestra promo semanal da un 15% adicional en planes seleccionados.","\uD83C\uDF81 \xa1Excelente! Aprovecha nuestras promociones: esta semana, 2 meses gratis al contratar el plan anual. Proporciona tu tel\xe9fono para enviarte la oferta y detalles exclusivos."],e)),inbox:"principal",tags:["lead_calificado","promocion","marketing"],controlTag:"kb_respondida_promocion",maxResponses:2,exceededResponse:"\xa1Ya te enviamos la oferta! Aprovecha mientras dura. No dudes en hacernos saber si necesitas algo m\xe1s."},{triggers:["demo gratuita","prueba","test","try","free trial"],response:e=>tx(tR(["\uD83D\uDDA5️ \xa1Genial que quieras probar nuestro servicio! D\xe9janos tu n\xfamero y te enviaremos la demo gratuita, con ejemplos de funcionalidades clave y consejos para optimizar tu flujo de trabajo.","\uD83D\uDDA5️ \xa1Excelente! Proporciona tu tel\xe9fono y recibir\xe1s la demo gratuita, incluyendo casos de \xe9xito de otros usuarios que lograron resultados r\xe1pidamente."],e)),inbox:"principal",tags:["lead_calificado","solicitud_demo","marketing"],controlTag:"kb_respondida_demo_gratis",maxResponses:1,exceededResponse:"\xa1Ya te enviamos la demo gratuita! Aprovecha mientras dura. No dudes en hacernos saber si necesitas algo m\xe1s."},{triggers:["seguimiento demo","feedback demo","opini\xf3n demo"],response:e=>tx(tR(["\uD83D\uDCDE \xa1Gracias por probar nuestra demo! Queremos conocer tu opini\xf3n y ofrecerte un plan especial. D\xe9janos tu tel\xe9fono y te contactaremos con una oferta personalizada.","\uD83D\uDCDE Queremos tu feedback sobre la demo. Proporciona tu tel\xe9fono y te enviaremos un caso de \xe9xito similar a tu perfil que podr\xeda interesarte."],e)),inbox:"principal",tags:["lead_calificado","followup_demo","marketing"],controlTag:"kb_followup_demo",maxResponses:1,exceededResponse:"\xa1Gracias por tu tiempo! No dudes en hacernos saber si necesitas algo m\xe1s. Estamos aqu\xed para ayudarte."},{triggers:["caracter\xedsticas","beneficios","funcionalidades","comparar planes"],response:e=>tx(tR(["\uD83D\uDCCA Podemos enviarte un resumen completo de nuestros planes y beneficios. D\xe9janos tu tel\xe9fono y recibir\xe1s tambi\xe9n un ejemplo de ahorro y productividad seg\xfan el plan elegido.","\uD83D\uDCCA Consulta las caracter\xedsticas de cada plan y sus ventajas. Proporciona tu tel\xe9fono y te enviaremos un comparativo pr\xe1ctico que te ayudar\xe1 a decidir."],e)),inbox:"principal",tags:["lead_calificado","info_planes","marketing"],controlTag:"kb_info_planes",maxResponses:1,exceededResponse:"\xa1Gracias por tu inter\xe9s! No dudes en hacernos saber si necesitas algo m\xe1s. Estamos aqu\xed para ayudarte."},{triggers:["volver a usar","reactivar cuenta","regresar","ex-usuario"],response:e=>tx(tR(["\uD83D\uDD04 \xa1Qu\xe9 gusto verte de nuevo! Tenemos promociones exclusivas para clientes que regresan. D\xe9janos tu tel\xe9fono y te contactaremos con un plan especial de reactivaci\xf3n.","\uD83D\uDD04 Nos encantar\xeda que vuelvas a disfrutar de nuestros servicios. Proporciona tu tel\xe9fono y recibir\xe1s detalles de nuestra oferta para antiguos clientes."],e)),inbox:"principal",tags:["lead_reactivacion","marketing"],controlTag:"kb_reactivacion_cliente",maxResponses:1,exceededResponse:"\xa1Ya te enviamos la oferta de reactivaci\xf3n! No dudes en hacernos saber si necesitas algo m\xe1s. Estamos aqu\xed para ayudarte."},{triggers:["m\xe1s servicios","upgrade","mejor plan","premium"],response:e=>tx(tR(["\uD83D\uDE80 \xbfQuieres llevar tu plan al siguiente nivel? D\xe9janos tu n\xfamero y te contactaremos para ofrecerte mejoras exclusivas y descuentos por tiempo limitado.","\uD83D\uDE80 Tenemos opciones premium que aumentan tus beneficios hasta un 30%. Proporciona tu tel\xe9fono y te enviaremos una recomendaci\xf3n personalizada."],e)),inbox:"principal",tags:["upsell","marketing"],controlTag:"kb_upsell",maxResponses:1,exceededResponse:"\xa1Ya te compartimos las opciones premium! Si necesitas m\xe1s informaci\xf3n, no dudes en avisarnos."},{triggers:["horario","contacto","ubicaci\xf3n","direcci\xf3n"],response:e=>tx(tR(["\uD83D\uDCCD Aqu\xed tienes los detalles de contacto y horarios. Puedes visitarnos o escribirnos directamente.","\uD83D\uDCCD Te compartimos la ubicaci\xf3n y horario de atenci\xf3n. Estamos disponibles para cualquier consulta."],e)),inbox:"principal",tags:["informacion_general","marketing"],controlTag:"kb_info_general",maxResponses:1,exceededResponse:"Ya te enviamos la informaci\xf3n de contacto. Si necesitas algo m\xe1s, aqu\xed estamos para ayudarte."},{triggers:["factura","cfdi","pago","recibo"],response:e=>tx(tR(["\uD83E\uDDFE Puedes descargar tu factura desde tu cuenta o ver un resumen de tus transacciones.","\uD83E\uDDFE Si necesitas asistencia personalizada con facturaci\xf3n, d\xe9janos tu tel\xe9fono y te ayudaremos r\xe1pidamente."],e)),inbox:"soporte",tags:["soporte_incidente","facturacion"],controlTag:"kb_respondida_factura",maxResponses:2,exceededResponse:"Ya hemos respondido tu consulta de facturaci\xf3n. Si surge algo adicional, por favor av\xedsanos."},{triggers:["login","contrase\xf1a","usuario","acceso"],response:e=>tx(tR(["\uD83D\uDD11 Para problemas de acceso, usa '\xbfOlvidaste tu contrase\xf1a?' en nuestra plataforma.","\uD83D\uDD11 Si necesitas ayuda personalizada para recuperar tu acceso, d\xe9janos tu tel\xe9fono y te guiaremos."],e)),inbox:"soporte",tags:["soporte_tecnico","acceso"],controlTag:"kb_respondida_login",maxResponses:2,exceededResponse:"Ya te compartimos c\xf3mo recuperar el acceso. Si persiste el problema, cont\xe1ctanos directamente."},{triggers:["error","problema t\xe9cnico","fallo","bug"],response:e=>tx(tR(["⚙️ Lamentamos el inconveniente. Proporciona tu n\xfamero de contacto y nuestro equipo t\xe9cnico se pondr\xe1 en comunicaci\xf3n contigo. Tambi\xe9n podemos ofrecerte un tutorial para evitar errores similares.","⚙️ D\xe9janos tu tel\xe9fono y solucionaremos tu problema r\xe1pidamente. Adem\xe1s, recibir\xe1s recomendaciones personalizadas para optimizar tu experiencia."],e)),inbox:"soporte",tags:["soporte_funcionalidad","soporte_incidente"],controlTag:"kb_error_tecnico",maxResponses:2,exceededResponse:"Ya registramos tu problema t\xe9cnico. Nuestro equipo lo est\xe1 atendiendo, gracias por tu paciencia."},{triggers:["recuperar contrase\xf1a","olvid\xe9 contrase\xf1a","reset password"],response:e=>tx(tR(["\uD83D\uDD10 Para recuperar tu contrase\xf1a, sigue el enlace '\xbfOlvidaste tu contrase\xf1a?' en nuestra plataforma.","\uD83D\uDD10 Si surge alg\xfan inconveniente durante el proceso, d\xe9janos tu tel\xe9fono y te asistiremos paso a paso."],e)),inbox:"soporte",tags:["soporte_tecnico","acceso"],controlTag:"kb_recuperar_contrasena",maxResponses:2,exceededResponse:"Ya te enviamos las instrucciones para recuperar tu contrase\xf1a. Si tienes alg\xfan problema adicional, av\xedsanos."},{triggers:["novedades","actualizaci\xf3n","update","new features"],response:e=>tx(tR(["✨ Tenemos nuevas funcionalidades y mejoras. D\xe9janos tu tel\xe9fono para enviarte informaci\xf3n detallada y una demo de las novedades. Por ejemplo, ahora puedes personalizar tu panel de control con widgets y reportes autom\xe1ticos.","✨ \xa1Actualizamos nuestro producto! Proporciona tu n\xfamero y te contactaremos. Incluye nuevas integraciones que facilitan la gesti\xf3n de tus procesos."],e)),inbox:"principal",tags:["marketing","novedades_producto"],controlTag:"kb_actualizaciones_producto",maxResponses:1,exceededResponse:"Ya te informamos de nuestras actualizaciones. Si deseas recibir actualizaciones adicionales, h\xe1znoslo saber."},{triggers:["testimonio","caso de \xe9xito","historia","referencia"],response:e=>tx(tR(["\uD83C\uDFC6 Tenemos varios casos de \xe9xito que podr\xedan interesarte. D\xe9janos tu tel\xe9fono y te compartiremos los detalles directamente, incluyendo resultados concretos de clientes como t\xfa.","\uD83C\uDFC6 Proporciona tu n\xfamero y te enviaremos historias de \xe9xito recientes que muestran c\xf3mo nuestros clientes han optimizado sus procesos."],e)),inbox:"principal",tags:["marketing","referencias_cliente"],controlTag:"kb_testimonios",maxResponses:1,exceededResponse:"Ya te compartimos casos de \xe9xito relevantes. Si deseas m\xe1s ejemplos, h\xe1znoslo saber."},{triggers:["llamada","reuni\xf3n","contacto directo","hablar con alguien"],response:e=>tx(tR(["\uD83D\uDCDE Podemos agendar una llamada contigo para resolver tus dudas. Por favor proporciona tu tel\xe9fono y te contactaremos pronto. Adem\xe1s, podemos compartirte material previo a la reuni\xf3n para que aproveches mejor el tiempo.","\uD83D\uDCDE D\xe9janos tu tel\xe9fono y agendaremos una reuni\xf3n. Tambi\xe9n incluiremos un resumen de nuestros planes y promociones actuales para que tengas toda la informaci\xf3n lista."],e)),inbox:"principal",tags:["lead_calificado","marketing","reunion"],controlTag:"kb_solicitud_llamada",maxResponses:1,exceededResponse:"Ya hemos agendado tu solicitud de reuni\xf3n. Si quieres ajustar la fecha u hora, av\xedsanos."},{triggers:["integraci\xf3n","API","connect","plugin"],response:e=>tx(tR(["\uD83D\uDD0C Para consultas sobre integraciones o APIs, d\xe9janos tu tel\xe9fono y nuestro equipo de especialistas se comunicar\xe1 contigo. Tambi\xe9n podemos enviarte ejemplos de integraci\xf3n con otras plataformas populares.","\uD83D\uDD0C Proporciona tu n\xfamero y te guiaremos en la integraci\xf3n, incluyendo documentaci\xf3n y tips para aprovechar al m\xe1ximo la API."],e)),inbox:"principal",tags:["marketing","soporte_funcionalidad"],controlTag:"kb_integraciones",maxResponses:1,exceededResponse:"Ya te enviamos la informaci\xf3n sobre integraciones. Si necesitas soporte t\xe9cnico, ind\xedcanoslo."},{triggers:["renovar plan","renovaci\xf3n","extender suscripci\xf3n"],response:e=>tx(tR(["\uD83D\uDD04 Podemos ayudarte a renovar tu plan sin interrupciones. D\xe9janos tu tel\xe9fono y te contactaremos r\xe1pidamente con promociones exclusivas de renovaci\xf3n.","\uD83D\uDD04 Proporciona tu n\xfamero y aseguramos tu renovaci\xf3n, adem\xe1s de ofrecerte beneficios adicionales para clientes que renuevan a tiempo."],e)),inbox:"principal",tags:["marketing","lead_renovacion"],controlTag:"kb_renovacion",maxResponses:1,exceededResponse:"Ya hemos compartido la oferta de renovaci\xf3n. Si requieres m\xe1s detalles, estamos atentos."},{triggers:["sugerencia","feedback","opini\xf3n"],response:e=>tx(tR(["\uD83D\uDCAC Gracias por tu feedback. Queremos escucharte m\xe1s. D\xe9janos tu n\xfamero y te contactaremos. Tambi\xe9n te compartiremos mejoras planeadas seg\xfan tus comentarios.","\uD83D\uDCAC Proporciona tu tel\xe9fono y podremos profundizar en tus sugerencias, incluyendo oportunidades de personalizaci\xf3n y mejoras futuras."],e)),inbox:"principal",tags:["marketing","feedback"],controlTag:"kb_feedback",maxResponses:1,exceededResponse:"Gracias por tu feedback, ya lo registramos. Si quieres ampliar tu opini\xf3n, estaremos encantados de escucharte."},{triggers:["cancelar plan","darse de baja","terminar suscripci\xf3n"],response:e=>tx(tR(["❌ Lamentamos que quieras cancelar. D\xe9janos tu tel\xe9fono y te contactaremos para ofrecerte alternativas y solucionar tu situaci\xf3n de la mejor manera posible.","❌ Proporciona tu n\xfamero y revisaremos opciones antes de procesar la baja, incluyendo beneficios especiales que podr\xedas aprovechar."],e)),inbox:"principal",tags:["marketing","soporte_funcionalidad"],controlTag:"kb_cancelacion",maxResponses:1,exceededResponse:"Ya registramos tu solicitud de cancelaci\xf3n. Si quieres considerar alternativas, estamos disponibles."},{triggers:["t\xe9rminos","condiciones","legal","pol\xedtica"],response:e=>tx(tR(["\uD83D\uDCDC Puedes revisar nuestros t\xe9rminos y condiciones en nuestro sitio web.","\uD83D\uDCDC Si necesitas aclaraciones legales espec\xedficas, d\xe9janos tu tel\xe9fono y nuestro equipo te contactar\xe1."],e)),inbox:"principal",tags:["informacion_general","soporte_legal"],controlTag:"kb_legal",maxResponses:1,exceededResponse:"Ya te compartimos la informaci\xf3n legal solicitada. Si necesitas m\xe1s detalles, av\xedsanos."},{triggers:["webinar","capacitaci\xf3n","tutorial","curso"],response:e=>tx(tR(["\uD83C\uDF93 Tenemos webinars y capacitaciones disponibles. D\xe9janos tu tel\xe9fono y te enviaremos el calendario con enlaces de inscripci\xf3n y materiales de aprendizaje.","\uD83C\uDF93 Proporciona tu n\xfamero y recibir\xe1s invitaciones a nuestros cursos y tutoriales, incluyendo contenidos exclusivos para clientes activos."],e)),inbox:"principal",tags:["marketing","capacitacion"],controlTag:"kb_webinar",maxResponses:1,exceededResponse:"Ya te enviamos la informaci\xf3n sobre capacitaciones. Si deseas m\xe1s sesiones, con gusto te las compartimos."},{triggers:["reporte","estad\xedsticas","m\xe9tricas","dashboard"],response:e=>tx(tR(["\uD83D\uDCCA Podemos enviarte reportes y m\xe9tricas detalladas. D\xe9janos tu tel\xe9fono y recibir\xe1s los \xfaltimos dashboards de rendimiento y comparativos de uso.","\uD83D\uDCCA Proporciona tu n\xfamero y te haremos llegar los reportes m\xe1s relevantes, incluyendo tips para mejorar tus resultados r\xe1pidamente."],e)),inbox:"principal",tags:["marketing","reportes"],controlTag:"kb_reportes",maxResponses:1,exceededResponse:"Ya compartimos los reportes solicitados. Si requieres m\xe9tricas adicionales, av\xedsanos."},{triggers:["actualizar pago","m\xe9todo de pago","tarjeta","suscripci\xf3n vencida"],response:e=>tx(tR(["\uD83D\uDCB3 Para actualizar tu m\xe9todo de pago o resolver pagos pendientes, d\xe9janos tu tel\xe9fono y nuestro equipo te guiar\xe1 paso a paso.","\uD83D\uDCB3 Proporciona tu n\xfamero y te ayudaremos a actualizar la informaci\xf3n de pago de manera segura y r\xe1pida."],e)),inbox:"soporte",tags:["soporte_incidente","facturacion"],controlTag:"kb_actualizar_pago",maxResponses:1,exceededResponse:"Ya te enviamos las instrucciones para actualizar tu pago. Si necesitas m\xe1s ayuda, cont\xe1ctanos."},{triggers:["recordatorio","alerta","notificaci\xf3n"],response:e=>tx(tR(["⏰ Podemos enviarte recordatorios y alertas importantes. D\xe9janos tu tel\xe9fono y recibir\xe1s avisos de fechas l\xedmite, eventos o promociones.","⏰ Proporciona tu n\xfamero y te enviaremos alertas personalizadas para que no pierdas ninguna oportunidad o aviso relevante."],e)),inbox:"principal",tags:["marketing","alertas"],controlTag:"kb_recordatorios",maxResponses:1,exceededResponse:"Ya configuramos tus recordatorios. Si quieres agregar m\xe1s alertas, h\xe1znoslo saber."},{triggers:["urgente","ahora","inmediato","r\xe1pido"],response:e=>tx(tR(["⚡ Entendemos que tu solicitud es urgente. Proporciona tu tel\xe9fono y nuestro equipo te contactar\xe1 de inmediato, con recomendaciones r\xe1pidas y efectivas para tu caso.","⚡ D\xe9janos tu n\xfamero y atenderemos tu solicitud de forma prioritaria, con instrucciones y consejos r\xe1pidos para resolver tu situaci\xf3n."],e)),inbox:"principal",tags:["marketing","soporte_funcionalidad"],controlTag:"kb_urgente",maxResponses:2,exceededResponse:"Ya atendimos tu solicitud prioritaria. Si surge algo m\xe1s, estamos disponibles para ayudarte de inmediato."}],tT={green:"#00ff00",red:"#ff0000",yellow:"#ffff00",blue:"#0099ff",lightBlue:"#00aaff",teal:"#00cc88",orange:"#ffaa00",lime:"#ccff00",gray:"#999999"};tT.green,tT.red,tT.yellow,tT.blue,tT.green,tT.orange,tT.orange,tT.orange,tT.teal,tT.orange,tT.lightBlue,tT.teal,tT.lime,tT.red,tT.blue,tT.orange,tT.orange,tT.lightBlue,tT.teal,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.orange,tT.red,tT.orange,tT.blue,tT.orange,tT.red,tT.orange,tT.red,tT.red,tT.gray,tT.lightBlue,tT.orange,tT.orange,tT.red,tT.red;let tk=["lead_calificado","lead_no_calificado","consulta_precio","solicitud_demo","promocion","followup_demo","info_planes","lead_reactivacion","upsell","informacion_general","marketing","feedback","cliente_riesgo","reunion","novedades_producto","referencias_cliente","eventos","lead_renovacion","soporte_incidente","soporte_funcionalidad","soporte_tecnico","caso_especial","escalado_supervision","cliente-grosero","bad_language_flag","conversation_closed","escalado_humano"],t$=["kb_urgente","auto_bienvenida","no_respuesta","error_gpt"];[...t$];let tE=[{word:"grosero",severity:"leve"},{word:"idiota",severity:"grave"},{word:"tonto",severity:"leve"},{word:"imb\xe9cil",severity:"grave"},{word:"puta",severity:"grave"},{word:"puto",severity:"grave"}],tA=[{response:"Lo siento, no puedo responder a palabras groseras. No te preocupes, estoy aqu\xed para ayudarte.",severity:"leve"},{response:"No puedo responder a palabras groseras. Si lo deseas, te canalizo con un humano.",severity:"grave"},{response:"No puedo responder a palabras groseras. Estoy aqu\xed para ayudarte, no para ofenderte.",severity:"leve"},{response:"Lo siento, no puedo responder a palabras groseras. \xbfQuieres hablar de algo m\xe1s?",severity:"leve"},{response:"No puedo responder a palabras groseras. Me voy a cerrar esta conversaci\xf3n.",severity:"grave"}],tO=process.env.BOT_TOKEN||"auBNsnPBgPGZCpKwy2bXpWZz";function tC(e,t,r,n,o){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!o)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r}function tj(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}let tq=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return tq=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),r=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(+e^r()&15>>+e/4).toString(16))};function tI(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let tD=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class tL extends Error{}class tB extends tL{constructor(e,t,r,n){super(`${tB.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new tM({message:r,cause:tD(t)});let o=t?.error;return 400===e?new tz(e,o,r,n):401===e?new tU(e,o,r,n):403===e?new tF(e,o,r,n):404===e?new tH(e,o,r,n):409===e?new tV(e,o,r,n):422===e?new tJ(e,o,r,n):429===e?new tX(e,o,r,n):e>=500?new tY(e,o,r,n):new tB(e,o,r,n)}}class tN extends tB{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class tM extends tB{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class tW extends tM{constructor({message:e}={}){super({message:e??"Request timed out."})}}class tz extends tB{}class tU extends tB{}class tF extends tB{}class tH extends tB{}class tV extends tB{}class tJ extends tB{}class tX extends tB{}class tY extends tB{}class tK extends tL{constructor(){super("Could not parse response content as the length limit was reached")}}class tG extends tL{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class tQ extends Error{constructor(e){super(e)}}let tZ=/^[a-z][a-z0-9+.-]*:/i,t0=e=>tZ.test(e),t1=e=>(t1=Array.isArray)(e),t2=t1;function t3(e){return"object"!=typeof e?{}:e??{}}function t8(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let t4=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new tL(`${e} must be an integer`);if(t<0)throw new tL(`${e} must be a positive integer`);return t},t6=e=>{try{return JSON.parse(e)}catch(e){return}},t5=e=>new Promise(t=>setTimeout(t,e)),t9="5.19.1",t7=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,re=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":t9,"X-Stainless-OS":rr(Deno.build.os),"X-Stainless-Arch":rt(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":t9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":t9,"X-Stainless-OS":rr(globalThis.process.platform??"unknown"),"X-Stainless-Arch":rt(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let r=t.exec(navigator.userAgent);if(r){let t=r[1]||0,n=r[2]||0,o=r[3]||0;return{browser:e,version:`${t}.${n}.${o}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":t9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":t9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},rt=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",rr=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",rn=()=>n??(n=re());function ro(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function rs(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return ro({start(){},async pull(e){let{done:r,value:n}=await t.next();r?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function ra(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function ri(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator]){await e[Symbol.asyncIterator]().return?.();return}let t=e.getReader(),r=t.cancel();t.releaseLock(),await r}let rl=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),rc="RFC3986",ru=e=>String(e),rd={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:ru},rh=(e,t)=>(rh=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),rp=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function rf(e,t){if(t1(e)){let r=[];for(let n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)}let rm={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},rg=function(e,t){Array.prototype.push.apply(e,t1(t)?t:[t])},rb={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,n,o)=>{if(0===e.length)return e;let s=e;if("symbol"==typeof e?s=Symbol.prototype.toString.call(e):"string"!=typeof e&&(s=String(e)),"iso-8859-1"===r)return escape(s).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<s.length;e+=1024){let t=s.length>=1024?s.slice(e,e+1024):s,r=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===o&&(40===n||41===n)){r[r.length]=t.charAt(e);continue}if(n<128){r[r.length]=rp[n];continue}if(n<2048){r[r.length]=rp[192|n>>6]+rp[128|63&n];continue}if(n<55296||n>=57344){r[r.length]=rp[224|n>>12]+rp[128|n>>6&63]+rp[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),r[r.length]=rp[240|n>>18]+rp[128|n>>12&63]+rp[128|n>>6&63]+rp[128|63&n]}a+=r.join("")}return a},encodeValuesOnly:!1,format:rc,formatter:ru,indices:!1,serializeDate:e=>(o??(o=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},ry={};function r_(e){let t;return(s??(s=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function rw(e){let t;return(a??(a=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class rv{constructor(){i.set(this,void 0),l.set(this,void 0),tC(this,i,new Uint8Array,"f"),tC(this,l,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?r_(e):e;tC(this,i,function(e){let t=0;for(let r of e)t+=r.length;let r=new Uint8Array(t),n=0;for(let t of e)r.set(t,n),n+=t.length;return r}([tj(this,i,"f"),r]),"f");let n=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(tj(this,i,"f"),tj(this,l,"f")));){if(t.carriage&&null==tj(this,l,"f")){tC(this,l,t.index,"f");continue}if(null!=tj(this,l,"f")&&(t.index!==tj(this,l,"f")+1||t.carriage)){n.push(rw(tj(this,i,"f").subarray(0,tj(this,l,"f")-1))),tC(this,i,tj(this,i,"f").subarray(tj(this,l,"f")),"f"),tC(this,l,null,"f");continue}let e=null!==tj(this,l,"f")?t.preceding-1:t.preceding,r=rw(tj(this,i,"f").subarray(0,e));n.push(r),tC(this,i,tj(this,i,"f").subarray(t.index),"f"),tC(this,l,null,"f")}return n}flush(){return tj(this,i,"f").length?this.decode("\n"):[]}}i=new WeakMap,l=new WeakMap,rv.NEWLINE_CHARS=new Set(["\n","\r"]),rv.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let rS={off:0,error:200,warn:300,info:400,debug:500},rx=(e,t,r)=>{if(e){if(Object.prototype.hasOwnProperty.call(rS,e))return e;r$(r).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(rS))}`)}};function rR(){}function rP(e,t,r){return!t||rS[e]>rS[r]?rR:t[e].bind(t)}let rT={error:rR,warn:rR,info:rR,debug:rR},rk=new WeakMap;function r$(e){let t=e.logger,r=e.logLevel??"off";if(!t)return rT;let n=rk.get(t);if(n&&n[0]===r)return n[1];let o={error:rP("error",t,r),warn:rP("warn",t,r),info:rP("info",t,r),debug:rP("debug",t,r)};return rk.set(t,[r,o]),o}let rE=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class rA{constructor(e,t,r){this.iterator=e,c.set(this,void 0),this.controller=t,tC(this,c,r,"f")}static fromSSEResponse(e,t,r){let n=!1,o=r?r$(r):console;return new rA(async function*(){if(n)throw new tL("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let r=!1;try{for await(let n of rO(e,t))if(!r){if(n.data.startsWith("[DONE]")){r=!0;continue}if(null!==n.event&&n.event.startsWith("thread.")){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new tB(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}else{let t;try{t=JSON.parse(n.data)}catch(e){throw o.error("Could not parse message into JSON:",n.data),o.error("From chunk:",n.raw),e}if(t&&t.error)throw new tB(void 0,t.error,void 0,e.headers);yield t}}r=!0}catch(e){if(tI(e))return;throw e}finally{r||t.abort()}},t,r)}static fromReadableStream(e,t,r){let n=!1;async function*o(){let t=new rv;for await(let r of ra(e))for(let e of t.decode(r))yield e;for(let e of t.flush())yield e}return new rA(async function*(){if(n)throw new tL("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of o())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(tI(e))return;throw e}finally{e||t.abort()}},t,r)}[(c=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new rA(()=>n(e),this.controller,tj(this,c,"f")),new rA(()=>n(t),this.controller,tj(this,c,"f"))]}toReadableStream(){let e;let t=this;return ro({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:r,done:n}=await e.next();if(n)return t.close();let o=r_(JSON.stringify(r)+"\n");t.enqueue(o)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*rO(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new tL("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new tL("Attempted to iterate over a response with no body")}let r=new rj,n=new rv;for await(let t of rC(ra(e.body)))for(let e of n.decode(t)){let t=r.decode(e);t&&(yield t)}for(let e of n.flush()){let t=r.decode(e);t&&(yield t)}}async function*rC(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?r_(r):r,o=new Uint8Array(t.length+n.length);for(o.set(t),o.set(n,t.length),t=o;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class rj{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){let r=e.indexOf(":");return -1!==r?[e.substring(0,r),":",e.substring(r+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}async function rq(e,t){let{response:r,requestLogID:n,retryOfRequestLogID:o,startTime:s}=t,a=await (async()=>{if(t.options.stream)return(r$(e).debug("response",r.status,r.url,r.headers,r.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(r,t.controller,e):rA.fromSSEResponse(r,t.controller,e);if(204===r.status)return null;if(t.options.__binaryResponse)return r;let n=r.headers.get("content-type"),o=n?.split(";")[0]?.trim();return o?.includes("application/json")||o?.endsWith("+json")?rI(await r.json(),r):await r.text()})();return r$(e).debug(`[${n}] response parsed`,rE({retryOfRequestLogID:o,url:r.url,status:r.status,body:a,durationMs:Date.now()-s})),a}function rI(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class rD extends Promise{constructor(e,t,r=rq){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=r,u.set(this,void 0),tC(this,u,e,"f")}_thenUnwrap(e){return new rD(tj(this,u,"f"),this.responsePromise,async(t,r)=>rI(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(tj(this,u,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}u=new WeakMap;class rL{constructor(e,t,r,n){d.set(this,void 0),tC(this,d,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new tL("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await tj(this,d,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(d=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class rB extends rD{constructor(e,t,r){super(e,t,async(e,t)=>new r(e,t.response,await rq(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class rN extends rL{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class rM extends rL{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...t3(this.options.query),after:t}}:null}}class rW extends rL{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1,this.last_id=r.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...t3(this.options.query),after:e}}:null}}let rz=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function rU(e,t,r){return rz(),new File(e,t??"unknown_file",r)}function rF(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let rH=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],rV=async(e,t)=>({...e,body:await rX(e.body,t)}),rJ=new WeakMap,rX=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,r=rJ.get(t);if(r)return r;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,r=new FormData;if(r.toString()===await new e(r).text())return!1;return!0}catch{return!0}})();return rJ.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let r=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>rQ(r,e,t))),r},rY=e=>e instanceof Blob&&"name"in e,rK=e=>"object"==typeof e&&null!==e&&(e instanceof Response||rH(e)||rY(e)),rG=e=>{if(rK(e))return!0;if(Array.isArray(e))return e.some(rG);if(e&&"object"==typeof e){for(let t in e)if(rG(e[t]))return!0}return!1},rQ=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(r instanceof Response)e.append(t,rU([await r.blob()],rF(r)));else if(rH(r))e.append(t,rU([await new Response(rs(r)).blob()],rF(r)));else if(rY(r))e.append(t,r,rF(r));else if(Array.isArray(r))await Promise.all(r.map(r=>rQ(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,n])=>rQ(e,`${t}[${r}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}},rZ=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,r0=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&rZ(e),r1=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function r2(e,t,r){if(rz(),r0(e=await e))return e instanceof File?e:rU([await e.arrayBuffer()],e.name);if(r1(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),rU(await r3(n),t,r)}let n=await r3(e);if(t||(t=rF(e)),!r?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(r={...r,type:e})}return rU(n,t,r)}async function r3(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(rZ(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(rH(e))for await(let r of e)t.push(...await r3(r));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class r8{constructor(e){this._client=e}}function r4(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let r6=Object.freeze(Object.create(null)),r5=((e=r4)=>function(t,...r){let n;if(1===t.length)return t[0];let o=!1,s=[],a=t.reduce((t,n,a)=>{/[?#]/.test(n)&&(o=!0);let i=r[a],l=(o?encodeURIComponent:e)(""+i);return a!==r.length&&(null==i||"object"==typeof i&&i.toString===Object.getPrototypeOf(Object.getPrototypeOf(i.hasOwnProperty??r6)??r6)?.toString)&&(l=i+"",s.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(i).slice(8,-1)} is not a valid path parameter`})),t+n+(a===r.length?"":l)},""),i=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(i));)s.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(s.sort((e,t)=>e.start-t.start),s.length>0){let e=0,t=s.reduce((t,r)=>{let n=" ".repeat(r.start-e),o="^".repeat(r.length);return e=r.start+r.length,t+n+o},"");throw new tL(`Path parameters result in path with invalid segments:
${s.map(e=>e.error).join("\n")}
${a}
${t}`)}return a})(r4);class r9 extends r8{list(e,t={},r){return this._client.getAPIList(r5`/chat/completions/${e}/messages`,rM,{query:t,...r})}}function r7(e){return void 0!==e&&"function"in e&&void 0!==e.function}function ne(e){return e?.$brand==="auto-parseable-response-format"}function nt(e){return e?.$brand==="auto-parseable-tool"}function nr(e,t){let r=e.choices.map(e=>{var r;if("length"===e.finish_reason)throw new tK;if("content_filter"===e.finish_reason)throw new tG;return no(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let r=e.tools?.find(e=>r7(e)&&e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:nt(r)?r.$parseRaw(t.function.arguments):r?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(r=e.message.content,t.response_format?.type!=="json_schema"?null:t.response_format?.type==="json_schema"?"$parseRaw"in t.response_format?t.response_format.$parseRaw(r):JSON.parse(r):null):null}}});return{...e,choices:r}}function nn(e){return!!ne(e.response_format)||(e.tools?.some(e=>nt(e)||"function"===e.type&&!0===e.function.strict)??!1)}function no(e){for(let t of e||[])if("function"!==t.type)throw new tL(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let ns=e=>e?.role==="assistant",na=e=>e?.role==="tool";class ni{constructor(){h.add(this),this.controller=new AbortController,p.set(this,void 0),f.set(this,()=>{}),m.set(this,()=>{}),g.set(this,void 0),b.set(this,()=>{}),y.set(this,()=>{}),_.set(this,{}),w.set(this,!1),v.set(this,!1),S.set(this,!1),x.set(this,!1),tC(this,p,new Promise((e,t)=>{tC(this,f,e,"f"),tC(this,m,t,"f")}),"f"),tC(this,g,new Promise((e,t)=>{tC(this,b,e,"f"),tC(this,y,t,"f")}),"f"),tj(this,p,"f").catch(()=>{}),tj(this,g,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},tj(this,h,"m",R).bind(this))},0)}_connected(){this.ended||(tj(this,f,"f").call(this),this._emit("connect"))}get ended(){return tj(this,w,"f")}get errored(){return tj(this,v,"f")}get aborted(){return tj(this,S,"f")}abort(){this.controller.abort()}on(e,t){return(tj(this,_,"f")[e]||(tj(this,_,"f")[e]=[])).push({listener:t}),this}off(e,t){let r=tj(this,_,"f")[e];if(!r)return this;let n=r.findIndex(e=>e.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){return(tj(this,_,"f")[e]||(tj(this,_,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{tC(this,x,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){tC(this,x,!0,"f"),await tj(this,g,"f")}_emit(e,...t){if(tj(this,w,"f"))return;"end"===e&&(tC(this,w,!0,"f"),tj(this,b,"f").call(this));let r=tj(this,_,"f")[e];if(r&&(tj(this,_,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];tj(this,x,"f")||r?.length||Promise.reject(e),tj(this,m,"f").call(this,e),tj(this,y,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];tj(this,x,"f")||r?.length||Promise.reject(e),tj(this,m,"f").call(this,e),tj(this,y,"f").call(this,e),this._emit("end")}}_emitFinal(){}}p=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,b=new WeakMap,y=new WeakMap,_=new WeakMap,w=new WeakMap,v=new WeakMap,S=new WeakMap,x=new WeakMap,h=new WeakSet,R=function(e){if(tC(this,v,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new tN),e instanceof tN)return tC(this,S,!0,"f"),this._emit("abort",e);if(e instanceof tL)return this._emit("error",e);if(e instanceof Error){let t=new tL(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new tL(String(e)))};class nl extends ni{constructor(){super(...arguments),P.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),na(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(ns(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new tL("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),tj(this,P,"m",T).call(this)}async finalMessage(){return await this.done(),tj(this,P,"m",k).call(this)}async finalFunctionToolCall(){return await this.done(),tj(this,P,"m",$).call(this)}async finalFunctionToolCallResult(){return await this.done(),tj(this,P,"m",E).call(this)}async totalUsage(){return await this.done(),tj(this,P,"m",A).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=tj(this,P,"m",k).call(this);t&&this._emit("finalMessage",t);let r=tj(this,P,"m",T).call(this);r&&this._emit("finalContent",r);let n=tj(this,P,"m",$).call(this);n&&this._emit("finalFunctionToolCall",n);let o=tj(this,P,"m",E).call(this);null!=o&&this._emit("finalFunctionToolCallResult",o),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",tj(this,P,"m",A).call(this))}async _createChatCompletion(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),tj(this,P,"m",O).call(this,t);let o=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(nr(o,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){let n="tool",{tool_choice:o="auto",stream:s,...a}=t,i="string"!=typeof o&&"function"===o.type&&o?.function?.name,{maxChatCompletions:l=10}=r||{},c=t.tools.map(e=>{if(nt(e)){if(!e.$callback)throw new tL("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let d="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:o,tools:d,messages:[...this.messages]},r),s=t.choices[0]?.message;if(!s)throw new tL("missing message in ChatCompletion response");if(!s.tool_calls?.length)break;for(let e of s.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:o,arguments:s}=e.function,a=u[o];if(a){if(i&&i!==o){let e=`Invalid tool_call: ${JSON.stringify(o)}. ${JSON.stringify(i)} requested. Please try again`;this._addMessage({role:n,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(o)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:r,content:e});continue}try{t="function"==typeof a.parse?await a.parse(s):s}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:r,content:e});continue}let l=await a.function(t,this),c=tj(this,P,"m",C).call(this,l);if(this._addMessage({role:n,tool_call_id:r,content:c}),i)return}}}}P=new WeakSet,T=function(){return tj(this,P,"m",k).call(this).content??null},k=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(ns(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new tL("stream ended without producing a ChatCompletionMessage with role=assistant")},$=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(ns(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},E=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(na(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},A=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},O=function(e){if(null!=e.n&&e.n>1)throw new tL("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},C=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class nc extends nl{static runTools(e,t,r){let n=new nc,o={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,o)),n}_addMessage(e,t=!0){super._addMessage(e,t),ns(e)&&e.content&&this._emit("content",e.content)}}let nu={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class nd extends Error{}class nh extends Error{}let np=(e,t)=>{let r=e.length,n=0,o=e=>{throw new nd(`${e} at position ${n}`)},s=e=>{throw new nh(`${e} at position ${n}`)},a=()=>(d(),n>=r&&o("Unexpected end of input"),'"'===e[n])?i():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||nu.NULL&t&&r-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||nu.BOOL&t&&r-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||nu.BOOL&t&&r-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||nu.INFINITY&t&&r-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||nu.MINUS_INFINITY&t&&1<r-n&&r-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||nu.NAN&t&&r-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u(),i=()=>{let a=n,i=!1;for(n++;n<r&&('"'!==e[n]||i&&"\\"===e[n-1]);)i="\\"===e[n]&&!i,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(a,++n-Number(i)))}catch(e){s(String(e))}else if(nu.STR&t)try{return JSON.parse(e.substring(a,n-Number(i))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}o("Unterminated string literal")},l=()=>{n++,d();let s={};try{for(;"}"!==e[n];){if(d(),n>=r&&nu.OBJ&t)return s;let o=i();d(),n++;try{let e=a();Object.defineProperty(s,o,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(nu.OBJ&t)return s;throw e}d(),","===e[n]&&n++}}catch(e){if(nu.OBJ&t)return s;o("Expected '}' at end of object")}return n++,s},c=()=>{n++;let r=[];try{for(;"]"!==e[n];)r.push(a()),d(),","===e[n]&&n++}catch(e){if(nu.ARR&t)return r;o("Expected ']' at end of array")}return n++,r},u=()=>{if(0===n){"-"===e&&nu.NUM&t&&o("Not sure what '-' is");try{return JSON.parse(e)}catch(r){if(nu.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}s(String(r))}}let a=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=r||nu.NUM&t||o("Unterminated number literal");try{return JSON.parse(e.substring(a,n))}catch(r){"-"===e.substring(a,n)&&nu.NUM&t&&o("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){s(String(e))}}},d=()=>{for(;n<r&&" \n\r	".includes(e[n]);)n++};return a()},nf=e=>(function(e,t=nu.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return np(e.trim(),t)})(e,nu.ALL^nu.NUM);class nm extends nl{constructor(e){super(),j.add(this),q.set(this,void 0),I.set(this,void 0),D.set(this,void 0),tC(this,q,e,"f"),tC(this,I,[],"f")}get currentChatCompletionSnapshot(){return tj(this,D,"f")}static fromReadableStream(e){let t=new nm(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let n=new nm(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){super._createChatCompletion;let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),tj(this,j,"m",L).call(this);let o=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),o))tj(this,j,"m",N).call(this,e);if(o.controller.signal?.aborted)throw new tN;return this._addChatCompletion(tj(this,j,"m",z).call(this))}async _fromReadableStream(e,t){let r;let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),tj(this,j,"m",L).call(this),this._connected();let o=rA.fromReadableStream(e,this.controller);for await(let e of o)r&&r!==e.id&&this._addChatCompletion(tj(this,j,"m",z).call(this)),tj(this,j,"m",N).call(this,e),r=e.id;if(o.controller.signal?.aborted)throw new tN;return this._addChatCompletion(tj(this,j,"m",z).call(this))}[(q=new WeakMap,I=new WeakMap,D=new WeakMap,j=new WeakSet,L=function(){this.ended||tC(this,D,void 0,"f")},B=function(e){let t=tj(this,I,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},tj(this,I,"f")[e.index]=t),t},N=function(e){if(this.ended)return;let t=tj(this,j,"m",F).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=tj(this,j,"m",B).call(this,e);for(let t of(e.finish_reason&&(tj(this,j,"m",W).call(this,e),null!=n.current_tool_call_index&&tj(this,j,"m",M).call(this,e,n.current_tool_call_index)),r.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(tj(this,j,"m",W).call(this,e),null!=n.current_tool_call_index&&tj(this,j,"m",M).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):r?.type)}}},M=function(e,t){if(tj(this,j,"m",B).call(this,e).done_tool_calls.has(t))return;let r=e.message.tool_calls?.[t];if(!r)throw Error("no tool call snapshot");if(!r.type)throw Error("tool call snapshot missing `type`");if("function"===r.type){let e=tj(this,q,"f")?.tools?.find(e=>r7(e)&&e.function.name===r.function.name);this._emit("tool_calls.function.arguments.done",{name:r.function.name,index:t,arguments:r.function.arguments,parsed_arguments:nt(e)?e.$parseRaw(r.function.arguments):e?.function.strict?JSON.parse(r.function.arguments):null})}else r.type},W=function(e){let t=tj(this,j,"m",B).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=tj(this,j,"m",U).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},z=function(){if(this.ended)throw new tL("stream has ended, this shouldn't happen");let e=tj(this,D,"f");if(!e)throw new tL("request ended without sending any chunks");return tC(this,D,void 0,"f"),tC(this,I,[],"f"),function(e,t){var r;let{id:n,choices:o,created:s,model:a,system_fingerprint:i,...l}=e;return r={...l,id:n,choices:o.map(({message:t,finish_reason:r,index:n,logprobs:o,...s})=>{if(!r)throw new tL(`missing finish_reason for choice ${n}`);let{content:a=null,function_call:i,tool_calls:l,...c}=t,u=t.role;if(!u)throw new tL(`missing role for choice ${n}`);if(i){let{arguments:e,name:l}=i;if(null==e)throw new tL(`missing function_call.arguments for choice ${n}`);if(!l)throw new tL(`missing function_call.name for choice ${n}`);return{...s,message:{content:a,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:o}}return l?{...s,index:n,finish_reason:r,logprobs:o,message:{...c,role:u,content:a,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:o,type:s,id:a,...i}=t,{arguments:l,name:c,...u}=o||{};if(null==a)throw new tL(`missing choices[${n}].tool_calls[${r}].id
${ng(e)}`);if(null==s)throw new tL(`missing choices[${n}].tool_calls[${r}].type
${ng(e)}`);if(null==c)throw new tL(`missing choices[${n}].tool_calls[${r}].function.name
${ng(e)}`);if(null==l)throw new tL(`missing choices[${n}].tool_calls[${r}].function.arguments
${ng(e)}`);return{...i,id:a,type:s,function:{...u,name:c,arguments:l}}})}}:{...s,message:{...c,content:a,role:u,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:o}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}},t&&nn(t)?nr(r,t):{...r,choices:r.choices.map(e=>(no(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,tj(this,q,"f"))},U=function(){let e=tj(this,q,"f")?.response_format;return ne(e)?e:null},F=function(e){var t,r,n,o;let s=tj(this,D,"f"),{choices:a,...i}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:u=null,...d}of(s?Object.assign(s,i):s=tC(this,D,{...i,choices:[]},"f"),e.choices)){let e=s.choices[c];if(e||(e=s.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...d}),u){if(e.logprobs){let{content:n,refusal:o,...s}=u;Object.assign(e.logprobs,s),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),o&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...o))}else e.logprobs=Object.assign({},u)}if(l&&(e.finish_reason=l,tj(this,q,"f")&&nn(tj(this,q,"f")))){if("length"===l)throw new tK;if("content_filter"===l)throw new tG}if(Object.assign(e,d),!a)continue;let{content:i,refusal:h,function_call:p,role:f,tool_calls:m,...g}=a;if(Object.assign(e.message,g),h&&(e.message.refusal=(e.message.refusal||"")+h),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),i&&(e.message.content=(e.message.content||"")+i,!e.message.refusal&&tj(this,j,"m",U).call(this)&&(e.message.parsed=nf(e.message.content))),m)for(let{index:t,id:r,type:n,function:s,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let i=(o=e.message.tool_calls)[t]??(o[t]={});Object.assign(i,a),r&&(i.id=r),n&&(i.type=n),s&&(i.function??(i.function={name:s.name??"",arguments:""})),s?.name&&(i.function.name=s.name),s?.arguments&&(i.function.arguments+=s.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let r=e.tools?.find(e=>r7(e)&&e.function?.name===t.function.name);return r7(r)&&(nt(r)||r?.function.strict||!1)}(tj(this,q,"f"),i)&&(i.function.parsed_arguments=nf(i.function.arguments)))}}return s},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new rA(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function ng(e){return JSON.stringify(e)}class nb extends nm{static fromReadableStream(e){let t=new nb(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){let n=new nb(t),o={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,o)),n}}class ny extends r8{constructor(){super(...arguments),this.messages=new r9(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(r5`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(r5`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",rM,{query:e,...t})}delete(e,t){return this._client.delete(r5`/chat/completions/${e}`,t)}parse(e,t){return function(e){for(let t of e??[]){if("function"!==t.type)throw new tL(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new tL(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>nr(t,e))}runTools(e,t){return e.stream?nb.runTools(this._client,e,t):nc.runTools(this._client,e,t)}stream(e,t){return nm.createChatCompletion(this._client,e,t)}}ny.Messages=r9;class n_ extends r8{constructor(){super(...arguments),this.completions=new ny(this._client)}}n_.Completions=ny;let nw=Symbol("brand.privateNullableHeaders"),nv=e=>{let t=new Headers,r=new Set;for(let n of e){let e=new Set;for(let[o,s]of function*(e){let t;if(!e)return;if(nw in e){let{values:t,nulls:r}=e;for(let e of(yield*t.entries(),r))yield[e,null];return}let r=!1;for(let n of(e instanceof Headers?t=e.entries():t2(e)?t=e:(r=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=t2(n[1])?n[1]:[n[1]],o=!1;for(let n of t)void 0!==n&&(r&&!o&&(o=!0,yield[e,null]),yield[e,n])}}(n)){let n=o.toLowerCase();e.has(n)||(t.delete(o),e.add(n)),null===s?(t.delete(o),r.add(n)):(t.append(o,s),r.delete(n))}}return{[nw]:!0,values:t,nulls:r}};class nS extends r8{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:nv([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class nx extends r8{create(e,t){return this._client.post("/audio/transcriptions",rV({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class nR extends r8{create(e,t){return this._client.post("/audio/translations",rV({body:e,...t,__metadata:{model:e.model}},this._client))}}class nP extends r8{constructor(){super(...arguments),this.transcriptions=new nx(this._client),this.translations=new nR(this._client),this.speech=new nS(this._client)}}nP.Transcriptions=nx,nP.Translations=nR,nP.Speech=nS;class nT extends r8{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(r5`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",rM,{query:e,...t})}cancel(e,t){return this._client.post(r5`/batches/${e}/cancel`,t)}}class nk extends r8{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(r5`/assistants/${e}`,{...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(r5`/assistants/${e}`,{body:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",rM,{query:e,...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(r5`/assistants/${e}`,{...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class n$ extends r8{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class nE extends r8{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class nA extends r8{constructor(){super(...arguments),this.sessions=new n$(this._client),this.transcriptionSessions=new nE(this._client)}}nA.Sessions=n$,nA.TranscriptionSessions=nE;class nO extends r8{create(e,t,r){return this._client.post(r5`/threads/${e}/messages`,{body:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{thread_id:n}=t;return this._client.get(r5`/threads/${n}/messages/${e}`,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:n,...o}=t;return this._client.post(r5`/threads/${n}/messages/${e}`,{body:o,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(r5`/threads/${e}/messages`,rM,{query:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{thread_id:n}=t;return this._client.delete(r5`/threads/${n}/messages/${e}`,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class nC extends r8{retrieve(e,t,r){let{thread_id:n,run_id:o,...s}=t;return this._client.get(r5`/threads/${n}/runs/${o}/steps/${e}`,{query:s,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t,r){let{thread_id:n,...o}=t;return this._client.getAPIList(r5`/threads/${n}/runs/${e}/steps`,rM,{query:o,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}let nj=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}},nq=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class nI extends ni{constructor(){super(...arguments),H.add(this),J.set(this,[]),X.set(this,{}),Y.set(this,{}),K.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),er.set(this,void 0),en.set(this,void 0),eo.set(this,void 0)}[(J=new WeakMap,X=new WeakMap,Y=new WeakMap,K=new WeakMap,G=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,er=new WeakMap,en=new WeakMap,eo=new WeakMap,H=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new V;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=rA.fromReadableStream(e,this.controller);for await(let e of n)tj(this,H,"m",es).call(this,e);if(n.controller.signal?.aborted)throw new tN;return this._addRun(tj(this,H,"m",ea).call(this))}toReadableStream(){return new rA(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,n){let o=new V;return o._run(()=>o._runToolAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createToolAssistantStream(e,t,r,n){let o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let s={...r,stream:!0},a=await e.submitToolOutputs(t,s,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))tj(this,H,"m",es).call(this,e);if(a.controller.signal?.aborted)throw new tN;return this._addRun(tj(this,H,"m",ea).call(this))}static createThreadAssistantStream(e,t,r){let n=new V;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){let o=new V;return o._run(()=>o._runAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),o}currentEvent(){return tj(this,er,"f")}currentRun(){return tj(this,en,"f")}currentMessageSnapshot(){return tj(this,K,"f")}currentRunStepSnapshot(){return tj(this,eo,"f")}async finalRunSteps(){return await this.done(),Object.values(tj(this,X,"f"))}async finalMessages(){return await this.done(),Object.values(tj(this,Y,"f"))}async finalRun(){if(await this.done(),!tj(this,G,"f"))throw Error("Final run was not received.");return tj(this,G,"f")}async _createThreadAssistantStream(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let o={...t,stream:!0},s=await e.createAndRun(o,{...r,signal:this.controller.signal});for await(let e of(this._connected(),s))tj(this,H,"m",es).call(this,e);if(s.controller.signal?.aborted)throw new tN;return this._addRun(tj(this,H,"m",ea).call(this))}async _createAssistantStream(e,t,r,n){let o=n?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let s={...r,stream:!0},a=await e.create(t,s,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))tj(this,H,"m",es).call(this,e);if(a.controller.signal?.aborted)throw new tN;return this._addRun(tj(this,H,"m",ea).call(this))}static accumulateDelta(e,t){for(let[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(t8(t)&&t8(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!t8(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let n=t[r];null==n?t.push(e):t[r]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n){return await this._createToolAssistantStream(t,e,r,n)}}V=nI,es=function(e){if(!this.ended)switch(tC(this,er,e,"f"),tj(this,H,"m",ec).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":tj(this,H,"m",ep).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tj(this,H,"m",el).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":tj(this,H,"m",ei).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ea=function(){if(this.ended)throw new tL("stream has ended, this shouldn't happen");if(!tj(this,G,"f"))throw Error("Final run has not been received");return tj(this,G,"f")},ei=function(e){let[t,r]=tj(this,H,"m",ed).call(this,e,tj(this,K,"f"));for(let e of(tC(this,K,t,"f"),tj(this,Y,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,n=t.content[r.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=tj(this,Q,"f")){if(tj(this,Z,"f"))switch(tj(this,Z,"f").type){case"text":this._emit("textDone",tj(this,Z,"f").text,tj(this,K,"f"));break;case"image_file":this._emit("imageFileDone",tj(this,Z,"f").image_file,tj(this,K,"f"))}tC(this,Q,r.index,"f")}tC(this,Z,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==tj(this,Q,"f")){let t=e.data.content[tj(this,Q,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,tj(this,K,"f"));break;case"text":this._emit("textDone",t.text,tj(this,K,"f"))}}tj(this,K,"f")&&this._emit("messageDone",e.data),tC(this,K,void 0,"f")}},el=function(e){let t=tj(this,H,"m",eu).call(this,e);switch(tC(this,eo,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==tj(this,ee,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(tj(this,et,"f")&&this._emit("toolCallDone",tj(this,et,"f")),tC(this,ee,e.index,"f"),tC(this,et,t.step_details.tool_calls[e.index],"f"),tj(this,et,"f")&&this._emit("toolCallCreated",tj(this,et,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":tC(this,eo,void 0,"f"),"tool_calls"==e.data.step_details.type&&tj(this,et,"f")&&(this._emit("toolCallDone",tj(this,et,"f")),tC(this,et,void 0,"f")),this._emit("runStepDone",e.data,t)}},ec=function(e){tj(this,J,"f").push(e),this._emit("event",e)},eu=function(e){switch(e.event){case"thread.run.step.created":return tj(this,X,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=tj(this,X,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let n=V.accumulateDelta(t,r.delta);tj(this,X,"f")[e.data.id]=n}return tj(this,X,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":tj(this,X,"f")[e.data.id]=e.data}if(tj(this,X,"f")[e.data.id])return tj(this,X,"f")[e.data.id];throw Error("No snapshot available")},ed=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=tj(this,H,"m",eh).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eh=function(e,t){return V.accumulateDelta(t,e)},ep=function(e){switch(tC(this,en,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":tC(this,G,e.data,"f"),tj(this,et,"f")&&(this._emit("toolCallDone",tj(this,et,"f")),tC(this,et,void 0,"f"))}};class nD extends r8{constructor(){super(...arguments),this.steps=new nC(this._client)}create(e,t,r){let{include:n,...o}=t;return this._client.post(r5`/threads/${e}/runs`,{query:{include:n},body:o,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}retrieve(e,t,r){let{thread_id:n}=t;return this._client.get(r5`/threads/${n}/runs/${e}`,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{thread_id:n,...o}=t;return this._client.post(r5`/threads/${n}/runs/${e}`,{body:o,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(r5`/threads/${e}/runs`,rM,{query:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{thread_id:n}=t;return this._client.post(r5`/threads/${n}/runs/${e}/cancel`,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(n.id,{thread_id:e},r)}createAndStream(e,t,r){return nI.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let n=nv([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:o,response:s}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...n}}).withResponse();switch(o.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let e=s.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await t5(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return o}}}stream(e,t,r){return nI.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){let{thread_id:n,...o}=t;return this._client.post(r5`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:o,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){let n=await this.submitToolOutputs(e,t,r);return await this.poll(n.id,t,r)}submitToolOutputsStream(e,t,r){return nI.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}}nD.Steps=nC;class nL extends r8{constructor(){super(...arguments),this.runs=new nD(this._client),this.messages=new nO(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(r5`/threads/${e}`,{...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(r5`/threads/${e}`,{body:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t){return this._client.delete(r5`/threads/${e}`,{...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return nI.createThreadAssistantStream(e,this._client.beta.threads,t)}}nL.Runs=nD,nL.Messages=nO;class nB extends r8{constructor(){super(...arguments),this.realtime=new nA(this._client),this.assistants=new nk(this._client),this.threads=new nL(this._client)}}nB.Realtime=nA,nB.Assistants=nk,nB.Threads=nL;class nN extends r8{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class nM extends r8{retrieve(e,t,r){let{container_id:n}=t;return this._client.get(r5`/containers/${n}/files/${e}/content`,{...r,headers:nv([{Accept:"application/binary"},r?.headers]),__binaryResponse:!0})}}class nW extends r8{constructor(){super(...arguments),this.content=new nM(this._client)}create(e,t,r){return this._client.post(r5`/containers/${e}/files`,rV({body:t,...r},this._client))}retrieve(e,t,r){let{container_id:n}=t;return this._client.get(r5`/containers/${n}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(r5`/containers/${e}/files`,rM,{query:t,...r})}delete(e,t,r){let{container_id:n}=t;return this._client.delete(r5`/containers/${n}/files/${e}`,{...r,headers:nv([{Accept:"*/*"},r?.headers])})}}nW.Content=nM;class nz extends r8{constructor(){super(...arguments),this.files=new nW(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(r5`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",rM,{query:e,...t})}delete(e,t){return this._client.delete(r5`/containers/${e}`,{...t,headers:nv([{Accept:"*/*"},t?.headers])})}}nz.Files=nW;class nU extends r8{create(e,t,r){let{include:n,...o}=t;return this._client.post(r5`/conversations/${e}/items`,{query:{include:n},body:o,...r})}retrieve(e,t,r){let{conversation_id:n,...o}=t;return this._client.get(r5`/conversations/${n}/items/${e}`,{query:o,...r})}list(e,t={},r){return this._client.getAPIList(r5`/conversations/${e}/items`,rW,{query:t,...r})}delete(e,t,r){let{conversation_id:n}=t;return this._client.delete(r5`/conversations/${n}/items/${e}`,r)}}class nF extends r8{constructor(){super(...arguments),this.items=new nU(this._client)}create(e,t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(r5`/conversations/${e}`,t)}update(e,t,r){return this._client.post(r5`/conversations/${e}`,{body:t,...r})}delete(e,t){return this._client.delete(r5`/conversations/${e}`,t)}}nF.Items=nU;class nH extends r8{create(e,t){let r=!!e.encoding_format,n=r?e.encoding_format:"base64";r&&r$(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let o=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return r?o:(r$(this._client).debug("embeddings/decoding base64 embeddings from base64"),o._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=nj(t)}),e)))}}class nV extends r8{retrieve(e,t,r){let{eval_id:n,run_id:o}=t;return this._client.get(r5`/evals/${n}/runs/${o}/output_items/${e}`,r)}list(e,t,r){let{eval_id:n,...o}=t;return this._client.getAPIList(r5`/evals/${n}/runs/${e}/output_items`,rM,{query:o,...r})}}class nJ extends r8{constructor(){super(...arguments),this.outputItems=new nV(this._client)}create(e,t,r){return this._client.post(r5`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){let{eval_id:n}=t;return this._client.get(r5`/evals/${n}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(r5`/evals/${e}/runs`,rM,{query:t,...r})}delete(e,t,r){let{eval_id:n}=t;return this._client.delete(r5`/evals/${n}/runs/${e}`,r)}cancel(e,t,r){let{eval_id:n}=t;return this._client.post(r5`/evals/${n}/runs/${e}`,r)}}nJ.OutputItems=nV;class nX extends r8{constructor(){super(...arguments),this.runs=new nJ(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(r5`/evals/${e}`,t)}update(e,t,r){return this._client.post(r5`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",rM,{query:e,...t})}delete(e,t){return this._client.delete(r5`/evals/${e}`,t)}}nX.Runs=nJ;class nY extends r8{create(e,t){return this._client.post("/files",rV({body:e,...t},this._client))}retrieve(e,t){return this._client.get(r5`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",rM,{query:e,...t})}delete(e,t){return this._client.delete(r5`/files/${e}`,t)}content(e,t){return this._client.get(r5`/files/${e}/content`,{...t,headers:nv([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let n=new Set(["processed","error","deleted"]),o=Date.now(),s=await this.retrieve(e);for(;!s.status||!n.has(s.status);)if(await t5(t),s=await this.retrieve(e),Date.now()-o>r)throw new tW({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return s}}class nK extends r8{}class nG extends r8{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class nQ extends r8{constructor(){super(...arguments),this.graders=new nG(this._client)}}nQ.Graders=nG;class nZ extends r8{create(e,t,r){return this._client.getAPIList(r5`/fine_tuning/checkpoints/${e}/permissions`,rN,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(r5`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(r5`/fine_tuning/checkpoints/${n}/permissions/${e}`,r)}}class n0 extends r8{constructor(){super(...arguments),this.permissions=new nZ(this._client)}}n0.Permissions=nZ;class n1 extends r8{list(e,t={},r){return this._client.getAPIList(r5`/fine_tuning/jobs/${e}/checkpoints`,rM,{query:t,...r})}}class n2 extends r8{constructor(){super(...arguments),this.checkpoints=new n1(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(r5`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",rM,{query:e,...t})}cancel(e,t){return this._client.post(r5`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(r5`/fine_tuning/jobs/${e}/events`,rM,{query:t,...r})}pause(e,t){return this._client.post(r5`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(r5`/fine_tuning/jobs/${e}/resume`,t)}}n2.Checkpoints=n1;class n3 extends r8{constructor(){super(...arguments),this.methods=new nK(this._client),this.jobs=new n2(this._client),this.checkpoints=new n0(this._client),this.alpha=new nQ(this._client)}}n3.Methods=nK,n3.Jobs=n2,n3.Checkpoints=n0,n3.Alpha=nQ;class n8 extends r8{}class n4 extends r8{constructor(){super(...arguments),this.graderModels=new n8(this._client)}}n4.GraderModels=n8;class n6 extends r8{createVariation(e,t){return this._client.post("/images/variations",rV({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",rV({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class n5 extends r8{retrieve(e,t){return this._client.get(r5`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",rN,e)}delete(e,t){return this._client.delete(r5`/models/${e}`,t)}}class n9 extends r8{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class n7 extends r8{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class oe extends r8{constructor(){super(...arguments),this.clientSecrets=new n7(this._client)}}function ot(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var r,n,o;let s=(r=e.tools??[],n=t.name,r.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:(o=s,o?.$brand==="auto-parseable-tool")?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>{var r;return"output_text"===e.type?{...e,parsed:(r=e.text,t.text?.format?.type!=="json_schema"?null:"$parseRaw"in t.text?.format?(t.text?.format).$parseRaw(r):JSON.parse(r))}:e});return{...e,content:r}}return e}),n=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||or(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function or(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}oe.ClientSecrets=n7;class on extends ni{constructor(e){super(),ef.add(this),em.set(this,void 0),eg.set(this,void 0),eb.set(this,void 0),tC(this,em,e,"f")}static createResponse(e,t,r){let n=new on(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,r){let n;let o=r?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),tj(this,ef,"m",ey).call(this);let s=null;for await(let o of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),s=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected(),n))tj(this,ef,"m",e_).call(this,o,s);if(n.controller.signal?.aborted)throw new tN;return tj(this,ef,"m",ew).call(this)}[(em=new WeakMap,eg=new WeakMap,eb=new WeakMap,ef=new WeakSet,ey=function(){this.ended||tC(this,eg,void 0,"f")},e_=function(e,t){if(this.ended)return;let r=(e,r)=>{(null==t||r.sequence_number>t)&&this._emit(e,r)},n=tj(this,ef,"m",ev).call(this,e);switch(r("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new tL(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new tL(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new tL(`expected content to be 'output_text', got ${n.type}`);r("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new tL(`missing output at index ${e.output_index}`);"function_call"===t.type&&r("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:r(e.type,e)}},ew=function(){if(this.ended)throw new tL("stream has ended, this shouldn't happen");let e=tj(this,eg,"f");if(!e)throw new tL("request ended without sending any events");tC(this,eg,void 0,"f");let t=function(e,t){return t&&ne(t.text?.format)?ot(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,tj(this,em,"f"));return tC(this,eb,t,"f"),t},ev=function(e){let t=tj(this,eg,"f");if(!t){if("response.created"!==e.type)throw new tL(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return tC(this,eg,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new tL(`missing output at index ${e.output_index}`);"message"===r.type&&r.content.push(e.part);break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new tL(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new tL(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new tL(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new tL(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.completed":tC(this,eg,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=tj(this,eb,"f");if(!e)throw new tL("stream ended without producing a ChatCompletion");return e}}class oo extends r8{list(e,t={},r){return this._client.getAPIList(r5`/responses/${e}/input_items`,rM,{query:t,...r})}}class os extends r8{constructor(){super(...arguments),this.inputItems=new oo(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&or(e),e))}retrieve(e,t={},r){return this._client.get(r5`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&or(e),e))}delete(e,t){return this._client.delete(r5`/responses/${e}`,{...t,headers:nv([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>ot(t,e))}stream(e,t){return on.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(r5`/responses/${e}/cancel`,t)}}os.InputItems=oo;class oa extends r8{create(e,t,r){return this._client.post(r5`/uploads/${e}/parts`,rV({body:t,...r},this._client))}}class oi extends r8{constructor(){super(...arguments),this.parts=new oa(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(r5`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(r5`/uploads/${e}/complete`,{body:t,...r})}}oi.Parts=oa;let ol=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class oc extends r8{create(e,t,r){return this._client.post(r5`/vector_stores/${e}/file_batches`,{body:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:n}=t;return this._client.get(r5`/vector_stores/${n}/file_batches/${e}`,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}cancel(e,t,r){let{vector_store_id:n}=t;return this._client.post(r5`/vector_stores/${n}/file_batches/${e}/cancel`,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,r){let{vector_store_id:n,...o}=t;return this._client.getAPIList(r5`/vector_stores/${n}/file_batches/${e}/files`,rM,{query:o,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async poll(e,t,r){let n=nv([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:o,response:s}=await this.retrieve(t,{vector_store_id:e},{...r,headers:n}).withResponse();switch(o.status){case"in_progress":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let e=s.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await t5(a);break;case"failed":case"cancelled":case"completed":return o}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let o=Math.min(n?.maxConcurrency??5,t.length),s=this._client,a=t.values(),i=[...r];async function l(e){for(let t of e){let e=await s.files.create({file:t,purpose:"assistants"},n);i.push(e.id)}}let c=Array(o).fill(a).map(l);return await ol(c),await this.createAndPoll(e,{file_ids:i})}}class ou extends r8{create(e,t,r){return this._client.post(r5`/vector_stores/${e}/files`,{body:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}retrieve(e,t,r){let{vector_store_id:n}=t;return this._client.get(r5`/vector_stores/${n}/files/${e}`,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}update(e,t,r){let{vector_store_id:n,...o}=t;return this._client.post(r5`/vector_stores/${n}/files/${e}`,{body:o,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e,t={},r){return this._client.getAPIList(r5`/vector_stores/${e}/files`,rM,{query:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}delete(e,t,r){let{vector_store_id:n}=t;return this._client.delete(r5`/vector_stores/${n}/files/${e}`,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){let n=nv([r?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":r?.pollIntervalMs?.toString()??void 0}]);for(;;){let o=await this.retrieve(t,{vector_store_id:e},{...r,headers:n}).withResponse(),s=o.data;switch(s.status){case"in_progress":let a=5e3;if(r?.pollIntervalMs)a=r.pollIntervalMs;else{let e=o.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await t5(a);break;case"failed":case"completed":return s}}}async upload(e,t,r){let n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){let n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}content(e,t,r){let{vector_store_id:n}=t;return this._client.getAPIList(r5`/vector_stores/${n}/files/${e}/content`,rN,{...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}class od extends r8{constructor(){super(...arguments),this.files=new ou(this._client),this.fileBatches=new oc(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(r5`/vector_stores/${e}`,{...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,r){return this._client.post(r5`/vector_stores/${e}`,{body:t,...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",rM,{query:e,...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(r5`/vector_stores/${e}`,{...t,headers:nv([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,r){return this._client.getAPIList(r5`/vector_stores/${e}/search`,rN,{body:t,method:"post",...r,headers:nv([{"OpenAI-Beta":"assistants=v2"},r?.headers])})}}od.Files=ou,od.FileBatches=oc;class oh extends r8{constructor(){super(...arguments),eS.add(this)}async unwrap(e,t,r=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,r,n),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");tj(this,eS,"m",ex).call(this,r);let o=nv([t]).values,s=tj(this,eS,"m",eR).call(this,o,"webhook-signature"),a=tj(this,eS,"m",eR).call(this,o,"webhook-timestamp"),i=tj(this,eS,"m",eR).call(this,o,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new tQ("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new tQ("Webhook timestamp is too old");if(l>c+n)throw new tQ("Webhook timestamp is too new");let u=s.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),d=r.startsWith("whsec_")?Buffer.from(r.replace("whsec_",""),"base64"):Buffer.from(r,"utf-8"),h=i?`${i}.${a}.${e}`:`${a}.${e}`,p=await crypto.subtle.importKey("raw",d,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of u)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",p,t,new TextEncoder().encode(h)))return}catch{continue}throw new tQ("The given webhook signature does not match the expected signature")}}eS=new WeakSet,ex=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},eR=function(e,t){if(!e)throw Error("Headers are required");let r=e.get(t);if(null==r)throw Error(`Missing required header: ${t}`);return r};class op{constructor({baseURL:e=nq("OPENAI_BASE_URL"),apiKey:t=nq("OPENAI_API_KEY"),organization:r=nq("OPENAI_ORG_ID")??null,project:n=nq("OPENAI_PROJECT_ID")??null,webhookSecret:o=nq("OPENAI_WEBHOOK_SECRET")??null,...s}={}){if(eP.add(this),ek.set(this,void 0),this.completions=new nN(this),this.chat=new n_(this),this.embeddings=new nH(this),this.files=new nY(this),this.images=new n6(this),this.audio=new nP(this),this.moderations=new n9(this),this.models=new n5(this),this.fineTuning=new n3(this),this.graders=new n4(this),this.vectorStores=new od(this),this.webhooks=new oh(this),this.beta=new nB(this),this.batches=new nT(this),this.uploads=new oi(this),this.responses=new os(this),this.realtime=new oe(this),this.conversations=new nF(this),this.evals=new nX(this),this.containers=new nz(this),void 0===t)throw new tL("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let a={apiKey:t,organization:r,project:n,webhookSecret:o,...s,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&t7())throw new tL("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??eT.DEFAULT_TIMEOUT,this.logger=a.logger??console;let i="warn";this.logLevel=i,this.logLevel=rx(a.logLevel,"ClientOptions.logLevel",this)??rx(nq("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??i,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),tC(this,ek,rl,"f"),this._options=a,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=r,this.project=n,this.webhookSecret=o}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return nv([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let r,n=e,o=function(e=rb){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||rb.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=rc;if(void 0!==e.format){if(!rh(rd,e.format))throw TypeError("Unknown format option provided.");n=e.format}let o=rd[n],s=rb.filter;if(("function"==typeof e.filter||t1(e.filter))&&(s=e.filter),t=e.arrayFormat&&e.arrayFormat in rm?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":rb.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||rb.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:rb.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:rb.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:rb.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?rb.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:rb.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:rb.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:rb.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:rb.encodeValuesOnly,filter:s,format:n,formatter:o,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:rb.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:rb.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:rb.strictNullHandling}}(t);"function"==typeof o.filter?n=(0,o.filter)("",n):t1(o.filter)&&(r=o.filter);let s=[];if("object"!=typeof n||null===n)return"";let a=rm[o.arrayFormat],i="comma"===a&&o.commaRoundTrip;r||(r=Object.keys(n)),o.sort&&r.sort(o.sort);let l=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];o.skipNulls&&null===n[t]||rg(s,function e(t,r,n,o,s,a,i,l,c,u,d,h,p,f,m,g,b,y){var _,w;let v,S=t,x=y,R=0,P=!1;for(;void 0!==(x=x.get(ry))&&!P;){let e=x.get(t);if(R+=1,void 0!==e){if(e===R)throw RangeError("Cyclic object value");P=!0}void 0===x.get(ry)&&(R=0)}if("function"==typeof u?S=u(r,S):S instanceof Date?S=p?.(S):"comma"===n&&t1(S)&&(S=rf(S,function(e){return e instanceof Date?p?.(e):e})),null===S){if(a)return c&&!g?c(r,rb.encoder,b,"key",f):r;S=""}if("string"==typeof(_=S)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(w=S)&&"object"==typeof w&&w.constructor&&w.constructor.isBuffer&&w.constructor.isBuffer(w)){if(c){let e=g?r:c(r,rb.encoder,b,"key",f);return[m?.(e)+"="+m?.(c(S,rb.encoder,b,"value",f))]}return[m?.(r)+"="+m?.(String(S))]}let T=[];if(void 0===S)return T;if("comma"===n&&t1(S))g&&c&&(S=rf(S,c)),v=[{value:S.length>0?S.join(",")||null:void 0}];else if(t1(u))v=u;else{let e=Object.keys(S);v=d?e.sort(d):e}let k=l?String(r).replace(/\./g,"%2E"):String(r),$=o&&t1(S)&&1===S.length?k+"[]":k;if(s&&t1(S)&&0===S.length)return $+"[]";for(let r=0;r<v.length;++r){let _=v[r],w="object"==typeof _&&void 0!==_.value?_.value:S[_];if(i&&null===w)continue;let x=h&&l?_.replace(/\./g,"%2E"):_,P=t1(S)?"function"==typeof n?n($,x):$:$+(h?"."+x:"["+x+"]");y.set(t,R);let k=new WeakMap;k.set(ry,y),rg(T,e(w,P,n,o,s,a,i,l,"comma"===n&&g&&t1(S)?null:c,u,d,h,p,f,m,g,b,k))}return T}(n[t],t,a,i,o.allowEmptyArrays,o.strictNullHandling,o.skipNulls,o.encodeDotInKeys,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.format,o.formatter,o.encodeValuesOnly,o.charset,l))}let c=s.join(o.delimiter),u=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${t9}`}defaultIdempotencyKey(){return`stainless-node-retry-${tq()}`}makeStatusError(e,t,r,n){return tB.generate(e,t,r,n)}async _callApiKey(){let e;let t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof tL)throw e;throw new tL(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new tL(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,r){let n=!tj(this,eP,"m",e$).call(this)&&r||this.baseURL,o=new URL(t0(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(s)&&(t={...s,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(o.search=this.stringifyQuery(t)),o.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(r=>({method:e,path:t,...r})))}request(e,t=null){return new rD(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){let n=await e,o=n.maxRetries??this.maxRetries;null==t&&(t=o),await this.prepareOptions(n);let{req:s,url:a,timeout:i}=await this.buildRequest(n,{retryCount:o-t});await this.prepareRequest(s,{url:a,options:n});let l="log_"+(16777216*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===r?"":`, retryOf: ${r}`,u=Date.now();if(r$(this).debug(`[${l}] sending request`,rE({retryOfRequestLogID:r,method:n.method,url:a,options:n,headers:s.headers})),n.signal?.aborted)throw new tN;let d=new AbortController,h=await this.fetchWithTimeout(a,s,i,d).catch(tD),p=Date.now();if(h instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new tN;let o=tI(h)||/timed? ?out/i.test(String(h)+("cause"in h?String(h.cause):""));if(t)return r$(this).info(`[${l}] connection ${o?"timed out":"failed"} - ${e}`),r$(this).debug(`[${l}] connection ${o?"timed out":"failed"} (${e})`,rE({retryOfRequestLogID:r,url:a,durationMs:p-u,message:h.message})),this.retryRequest(n,t,r??l);if(r$(this).info(`[${l}] connection ${o?"timed out":"failed"} - error; no more retries left`),r$(this).debug(`[${l}] connection ${o?"timed out":"failed"} (error; no more retries left)`,rE({retryOfRequestLogID:r,url:a,durationMs:p-u,message:h.message})),o)throw new tW;throw new tM({cause:h})}let f=[...h.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${f}] ${s.method} ${a} ${h.ok?"succeeded":"failed"} with status ${h.status} in ${p-u}ms`;if(!h.ok){let e=await this.shouldRetry(h);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await ri(h.body),r$(this).info(`${m} - ${e}`),r$(this).debug(`[${l}] response error (${e})`,rE({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,durationMs:p-u})),this.retryRequest(n,t,r??l,h.headers)}let o=e?"error; no more retries left":"error; not retryable";r$(this).info(`${m} - ${o}`);let s=await h.text().catch(e=>tD(e).message),a=t6(s),i=a?void 0:s;throw r$(this).debug(`[${l}] response error (${o})`,rE({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,message:i,durationMs:Date.now()-u})),this.makeStatusError(h.status,a,i,h.headers)}return r$(this).info(m),r$(this).debug(`[${l}] response start`,rE({retryOfRequestLogID:r,url:h.url,status:h.status,headers:h.headers,durationMs:p-u})),{response:h,options:n,controller:d,requestLogID:l,retryOfRequestLogID:r,startTime:u}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){return new rB(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,r,n){let{signal:o,method:s,...a}=t||{};o&&o.addEventListener("abort",()=>n.abort());let i=setTimeout(()=>n.abort(),r),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};s&&(c.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(i)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r,n){let o;let s=n?.get("retry-after-ms");if(s){let e=parseFloat(s);Number.isNaN(e)||(o=e)}let a=n?.get("retry-after");if(a&&!o){let e=parseFloat(a);o=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(o&&0<=o&&o<6e4)){let r=e.maxRetries??this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(t,r)}return await t5(o),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:n,path:o,query:s,defaultBaseURL:a}=r,i=this.buildURL(o,s,a);"timeout"in r&&t4("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:r}),u=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:u,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...r.fetchOptions??{}},url:i,timeout:r.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:n}){let o={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);let s=nv([o,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...rn(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let r=nv([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&r.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:rs(e)}:tj(this,ek,"f").call(this,{body:e,headers:r})}}eT=op,ek=new WeakMap,eP=new WeakSet,e$=function(){return"https://api.openai.com/v1"!==this.baseURL},op.OpenAI=eT,op.DEFAULT_TIMEOUT=6e5,op.OpenAIError=tL,op.APIError=tB,op.APIConnectionError=tM,op.APIConnectionTimeoutError=tW,op.APIUserAbortError=tN,op.NotFoundError=tH,op.ConflictError=tV,op.RateLimitError=tX,op.BadRequestError=tz,op.AuthenticationError=tU,op.InternalServerError=tY,op.PermissionDeniedError=tF,op.UnprocessableEntityError=tJ,op.InvalidWebhookSignatureError=tQ,op.toFile=r2,op.Completions=nN,op.Chat=n_,op.Embeddings=nH,op.Files=nY,op.Images=n6,op.Audio=nP,op.Moderations=n9,op.Models=n5,op.FineTuning=n3,op.Graders=n4,op.VectorStores=od,op.Webhooks=oh,op.Beta=nB,op.Batches=nT,op.Uploads=oi,op.Responses=os,op.Realtime=oe,op.Conversations=nF,op.Evals=nX,op.Containers=nz;let of=process.env.CHATWOOT_URL||"https://app.chatwoot.com",om=process.env.CHATWOOT_ACCOUNT_ID||"132018",og=process.env.CHATWOOT_PERSONAL_TOKEN||"F2zAjGZ82fXq9Z1SVVWHDFGa",ob=null,oy={},o_=new op({apiKey:process.env.OPENAI_API_KEY});async function ow(e,t,r=3,n=500){try{let o=await tg(e,t);if(!o.ok){let s=await o.text();if(r>0&&[429,500,502,503,504].includes(o.status))return console.warn(`⚠️ Error ${o.status} en ${e}, reintentando en ${n}ms...`),await new Promise(e=>setTimeout(e,n)),ow(e,t,r-1,2*n);throw console.error(`❌ HTTP error ${o.status} en ${e}: ${s}`),Error(`HTTP error ${o.status} en ${e}`)}return await o.json()}catch(o){if(r>0)return console.warn(`⚠️ Fetch fall\xf3, reintentando en ${n}ms...`,o),await new Promise(e=>setTimeout(e,n)),ow(e,t,r-1,2*n);throw console.error(`❌ Fetch definitivo fall\xf3 en ${e}:`,o),o}}function ov(e){return e[Math.floor(Math.random()*e.length)]}async function oS(e){try{let t=await e.json(),r=t.event;switch(r){case"conversation_created":await ox(t);break;case"message_created":"incoming"===t.message_type&&await oz(t);break;case"conversation_updated":await oA(t);break;default:console.log(`Evento '${r}' no manejado`)}return ej.NextResponse.json({status:"ok"})}catch(e){return console.error("❌ Error webhook:",e),ej.NextResponse.json({error:"server error"},{status:500})}}async function ox(e){let t=e.meta?.sender,r=t?.id??await oL(t?.name||"Cliente",t?.email);if(!r)return;let n=e.id??await oB(r,ty.principal);if(!n)return;(await oO(n)).includes("auto_bienvenida")||(await oj(n,["auto_bienvenida"]),await oI(n,ov(t_)));let o=[];await oU(n,r),o.length&&await oC(n,o);let s=oN(ty.principal),a=s?tS[s]:void 0;a?.assignTeamId&&await oM(n,a.assignTeamId),a?.priority&&await oW(n,a.priority);let i=(await oq(n)).filter(e=>"incoming"===e.message_type).length;ok(n,i)}async function oR(e,t,r){try{let r=await o_.chat.completions.create({model:"gpt-4o-mini",messages:[{role:"system",content:"Eres un asistente de atenci\xf3n al cliente."},{role:"user",content:e},{role:"system",content:t?"El usuario tiene un n\xfamero de tel\xe9fono.":"El usuario no tiene un n\xfamero de tel\xe9fono."}],temperature:.7,max_tokens:200}),n=r.choices[0]?.message?.content?.trim();if(!n)throw Error("GPT respondi\xf3 vac\xedo");return n}catch(e){return console.error("❌ Error GPT:",e),r&&(await oC(r,["error_gpt"]),await oI(r,"⚠️ Nuestro asistente AI no puede responder en este momento. Un agente humano te atender\xe1 pronto.")),null}}let oP={},oT={};function ok(e,t=0){if(oP[e]||oT[e])return;let r=3e4+6e5*t;console.log(`⏳ scheduleAutoClose llamado para conversaci\xf3n ${e}, timeout = ${r}ms`),oT[e]=setTimeout(async()=>{try{if(oP[e])return;let t=await ow(`${of}/api/v1/accounts/${om}/conversations/${e}`,{headers:{api_access_token:og}});if("open"!==t.status)return;await oj(e,["no_respuesta"]),await oI(e,ov(tw)),await o$(e),oP[e]=!0,console.log(`✅ Conversaci\xf3n ${e} cerrada autom\xe1ticamente por inactividad`)}catch(e){console.error("❌ Error en autoClose:",e)}finally{delete oT[e]}},r)}async function o$(e){try{await ow(`${of}/api/v1/accounts/${om}/conversations/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({status:"resolved"})}),console.log(`✅ Conversaci\xf3n ${e} cerrada autom\xe1ticamente`)}catch(e){console.error("❌ Error cerrando conversaci\xf3n:",e)}}async function oE(e){try{await ow(`${of}/api/v1/accounts/${om}/conversations/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({status:"open"})}),oP[e]=!1,ok(e),console.log(`🔔 Conversaci\xf3n ${e} reabierta`)}catch(e){console.error("❌ Error reabriendo conversaci\xf3n:",e)}}async function oA(e){let t=e.conversation?.id;t&&"resolved"===(await ow(`${of}/api/v1/accounts/${om}/conversations/${t}`,{headers:{api_access_token:og}})).status&&(console.log(`ℹ️ La conversaci\xf3n ${t} ya fue resuelta`),await oI(t,ov(tw)))}async function oO(e){try{let t=await ow(`${of}/api/v1/accounts/${om}/conversations/${e}/labels`,{headers:{api_access_token:og}});return t.payload?.map(e=>e.title).filter(Boolean)||[]}catch(e){return console.error("❌ Error obteniendo etiquetas:",e),[]}}async function oC(e,t){try{let r=await oO(e),n=t.filter(e=>e.startsWith("__remove__")).map(e=>e.replace("__remove__","")),o=t.filter(e=>!e.startsWith("__remove__")),s=new Set(tk),a=new Set(t$);for(let t of n)!r.includes(t)||s.has(t)||a.has(t)||(await ow(`${of}/api/v1/accounts/${om}/conversations/${e}/labels`,{method:"DELETE",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({labels:[t]})}),console.log(`🗑️ Etiqueta '${t}' eliminada de conversaci\xf3n ${e}`));let i=Array.from(new Set([...r.filter(e=>s.has(e)||a.has(e)),...r.filter(e=>!s.has(e)&&!a.has(e)&&!n.includes(e)),...o.filter(Boolean)]));await ow(`${of}/api/v1/accounts/${om}/conversations/${e}/labels`,{method:"POST",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({labels:i})}),console.log(`✅ Etiquetas actualizadas para conversaci\xf3n ${e}:`,i)}catch(e){console.error("❌ Error en addTagsSafely:",e)}}async function oj(e,t){try{let r=new Set(tk),n=new Set(t$),o=t.filter(e=>e&&!r.has(e)&&!n.has(e));if(0===o.length)return;await ow(`${of}/api/v1/accounts/${om}/conversations/${e}/labels`,{method:"POST",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({labels:o})}),console.log(`📌 Etiquetas agregadas a conversaci\xf3n ${e}:`,o)}catch(e){console.error("❌ Error en safeAddTags:",e)}}async function oq(e){return(await ow(`${of}/api/v1/accounts/${om}/conversations/${e}/messages`,{headers:{api_access_token:og}})).payload}async function oI(e,t){await ow(`${of}/api/v1/accounts/${om}/conversations/${e}/messages`,{method:"POST",headers:{"Content-Type":"application/json",api_access_token:tO},body:JSON.stringify({content:t,message_type:"outgoing"})})}async function oD(e){let t=await ow(`${of}/api/v1/accounts/${om}/conversations/${e}`,{headers:{api_access_token:og}});return t.meta?.sender?.id}async function oL(e,t){try{return(await ow(`${of}/api/v1/accounts/${om}/contacts`,{method:"POST",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({name:e,email:t})})).id}catch(e){console.error("❌ Error creando contacto:",e);return}}async function oB(e,t){try{return(await ow(`${of}/api/v1/accounts/${om}/conversations`,{method:"POST",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({inbox_id:t,contact_id:e})})).id}catch(e){console.error("❌ Error creando conversaci\xf3n:",e);return}}function oN(e){return Object.entries(ty).find(([,t])=>Number(t)===Number(e))?.[0]}async function oM(e,t){if(!t){console.warn(`⚠️ No se proporcion\xf3 teamId para la conversaci\xf3n ${e}`);return}try{let r=await ow(`${of}/api/v1/accounts/${om}/conversations/${e}`,{headers:{api_access_token:og}});r.team?.id?console.log(`ℹ️ La conversaci\xf3n ${e} ya tiene un equipo asignado`):(await ow(`${of}/api/v1/accounts/${om}/conversations/${e}/assignments`,{method:"POST",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({team_id:t})}),console.log(`✅ Conversaci\xf3n ${e} asignada al equipo ${t}`))}catch(e){console.error("❌ Error asignando equipo:",e)}}async function oW(e,t){try{await ow(`${of}/api/v1/accounts/${om}/conversations/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({priority:t})})}catch(e){console.error("❌ Error estableciendo prioridad:",e)}}async function oz(e){let t=e.conversation?.id,r=e.content?.trim();if(!t||!r)return;let n=Date.now(),o=e=>e?.replace(/\s+/g," ").trim()||"";if(ob&&ob.conversationId===t&&o(ob.content)===o(r)&&n-ob.timestamp<2e3)return;ob={conversationId:t,content:r,timestamp:n};let s=await ow(`${of}/api/v1/accounts/${om}/conversations/${t}`,{headers:{api_access_token:og}});"resolved"===s.status&&(await oE(t),await oI(t,ov(tv)));let a=oN(s.inbox_id),i=await oO(t),l=await oD(t),c=!1;l&&(c=!!(await ow(`${of}/api/v1/accounts/${om}/contacts/${l}`,{headers:{api_access_token:og}})).phone_number);let u=[];l&&await oU(t,l);let d=null;oy[t]||(oy[t]||=await oH(t)||{},console.log(`🔹 Cargamos contador de KB para la conversaci\xf3n ${t}`));let h=tP.find(e=>e.triggers.some(e=>r.toLowerCase().includes(e.toLowerCase())));if(h){let e=(h.controlTag||h.triggers[0]).toLowerCase().trim();oy[t]||=await oH(t)||{};let r=oy[t],n=r[e]||0;console.log(`KB Tag: ${e}, count: ${n}, max: ${h.maxResponses}`),!h.maxResponses||n<h.maxResponses?(d="function"==typeof h.response?h.response(c):h.response,r[e]=n+1,oy[t]=r,await oV(t,r),h.controlTag&&!i.includes(h.controlTag)&&u.push(h.controlTag),h.tags?.length&&u.push(...h.tags)):d=h.exceededResponse||d,console.log("KB Counter actualizado:",r)}let p=await oF(t,r,await oq(t));p.reply&&(d=p.reply),u.push(...p.tags);let f=tE.find(e=>r.toLowerCase().includes(e.word));if(f){let e=f.severity||"leve";d=ov(tA.filter(t=>t.severity===e)).response,u.push("cliente-grosero","caso_especial")}d||(d=await oR(r,c,t));let m=a?tS[a]:void 0,g=m?.tags??[],b=Array.from(new Set([...i.filter(e=>tk.includes(e)),...u,...g]));await oC(t,b),d&&await oI(t,d),m?.assignTeamId&&!s.team?.id&&await oM(t,m.assignTeamId),m?.priority&&!s.priority&&await oW(t,m.priority);let y=(await oq(t)).filter(e=>"incoming"===e.message_type).length;ok(t,y)}async function oU(e,t){let r=[];try{let n=await ow(`${of}/api/v1/accounts/${om}/contacts/${t}`,{headers:{api_access_token:og}}),o=await oO(e);n.phone_number?(o.includes("lead_calificado")||r.push("lead_calificado"),o.includes("sin_telefono")&&r.push("__remove__sin_telefono")):o.includes("sin_telefono")||r.push("sin_telefono")}catch(e){console.error("❌ Error manejando lead tags:",e)}return{tags:r}}async function oF(e,t,r){let n=[],o=r[r.length-1],s=/(\+?\d{10,15})/.exec(t)?.[0]||o?.content?.match(/(\+?\d{10,15})/)?.[0];return s&&n.push("telefono_recibido"),{reply:s?`📱 Hemos recibido tu tel\xe9fono: ${s}`:null,tags:n}}async function oH(e){let t=await ow(`${of}/api/v1/accounts/${om}/conversations/${e}`,{headers:{api_access_token:og}});return t.meta?.kb_counter||{}}async function oV(e,t){await ow(`${of}/api/v1/accounts/${om}/conversations/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",api_access_token:og},body:JSON.stringify({meta:{kb_counter:t}})})}let oJ=new eA.AppRouteRouteModule({definition:{kind:eO.x.APP_ROUTE,page:"/api/chat-webhook/route",pathname:"/api/chat-webhook",filename:"route",bundlePath:"app/api/chat-webhook/route"},resolvedPagePath:"/Users/emmanuelhernandez/Desktop/chatweb/app/api/chat-webhook/route.ts",nextConfigOutput:"",userland:eE}),{requestAsyncStorage:oX,staticGenerationAsyncStorage:oY,serverHooks:oK}=oJ,oG="/api/chat-webhook/route";function oQ(){return(0,eC.patchFetch)({serverHooks:oK,staticGenerationAsyncStorage:oY})}},6801:e=>{"use strict";var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,o=Object.prototype.hasOwnProperty,s={};function a(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),n=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===r.length?n:`${n}; ${r.join("; ")}`}function i(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[n,o]=[r.slice(0,e),r.slice(e+1)];try{t.set(n,decodeURIComponent(null!=o?o:"true"))}catch{}}return t}function l(e){var t,r;if(!e)return;let[[n,o],...s]=i(e),{domain:a,expires:l,httponly:d,maxage:h,path:p,samesite:f,secure:m,partitioned:g,priority:b}=Object.fromEntries(s.map(([e,t])=>[e.toLowerCase(),t]));return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}({name:n,value:decodeURIComponent(o),domain:a,...l&&{expires:new Date(l)},...d&&{httpOnly:!0},..."string"==typeof h&&{maxAge:Number(h)},path:p,...f&&{sameSite:c.includes(t=(t=f).toLowerCase())?t:void 0},...m&&{secure:!0},...b&&{priority:u.includes(r=(r=b).toLowerCase())?r:void 0},...g&&{partitioned:!0}})}((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(s,{RequestCookies:()=>d,ResponseCookies:()=>h,parseCookie:()=>i,parseSetCookie:()=>l,stringifyCookie:()=>a}),e.exports=((e,s,a,i)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let l of n(s))o.call(e,l)||l===a||t(e,l,{get:()=>s[l],enumerable:!(i=r(s,l))||i.enumerable});return e})(t({},"__esModule",{value:!0}),s);var c=["strict","lax","none"],u=["low","medium","high"],d=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t)for(let[e,r]of i(t))this._parsed.set(e,{name:e,value:r})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===n).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,n=this._parsed;return n.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(n).map(([e,t])=>a(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>a(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},h=class{constructor(e){var t,r,n;this._parsed=new Map,this._headers=e;let o=null!=(n=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?n:[];for(let e of Array.isArray(o)?o:function(e){if(!e)return[];var t,r,n,o,s,a=[],i=0;function l(){for(;i<e.length&&/\s/.test(e.charAt(i));)i+=1;return i<e.length}for(;i<e.length;){for(t=i,s=!1;l();)if(","===(r=e.charAt(i))){for(n=i,i+=1,l(),o=i;i<e.length&&"="!==(r=e.charAt(i))&&";"!==r&&","!==r;)i+=1;i<e.length&&"="===e.charAt(i)?(s=!0,i=o,a.push(e.substring(t,n)),t=i):i=n+1}else i+=1;(!s||i>=e.length)&&a.push(e.substring(t,e.length))}return a}(o)){let t=l(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===n)}has(e){return this._parsed.has(e)}set(...e){let[t,r,n]=1===e.length?[e[0].name,e[0].value,e[0]]:e,o=this._parsed;return o.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...n})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=a(r);t.append("set-cookie",e)}}(o,this._headers),this}delete(...e){let[t,r,n]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:r,domain:n,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(a).join("; ")}}},627:(e,t,r)=>{var n;(()=>{var o={226:function(o,s){!function(a,i){"use strict";var l="function",c="undefined",u="object",d="string",h="major",p="model",f="name",m="type",g="vendor",b="version",y="architecture",_="console",w="mobile",v="tablet",S="smarttv",x="wearable",R="embedded",P="Amazon",T="Apple",k="ASUS",$="BlackBerry",E="Browser",A="Chrome",O="Firefox",C="Google",j="Huawei",q="Microsoft",I="Motorola",D="Opera",L="Samsung",B="Sharp",N="Sony",M="Xiaomi",W="Zebra",z="Facebook",U="Chromium OS",F="Mac OS",H=function(e,t){var r={};for(var n in e)t[n]&&t[n].length%2==0?r[n]=t[n].concat(e[n]):r[n]=e[n];return r},V=function(e){for(var t={},r=0;r<e.length;r++)t[e[r].toUpperCase()]=e[r];return t},J=function(e,t){return typeof e===d&&-1!==X(t).indexOf(X(e))},X=function(e){return e.toLowerCase()},Y=function(e,t){if(typeof e===d)return e=e.replace(/^\s\s*/,""),typeof t===c?e:e.substring(0,350)},K=function(e,t){for(var r,n,o,s,a,c,d=0;d<t.length&&!a;){var h=t[d],p=t[d+1];for(r=n=0;r<h.length&&!a&&h[r];)if(a=h[r++].exec(e))for(o=0;o<p.length;o++)c=a[++n],typeof(s=p[o])===u&&s.length>0?2===s.length?typeof s[1]==l?this[s[0]]=s[1].call(this,c):this[s[0]]=s[1]:3===s.length?typeof s[1]!==l||s[1].exec&&s[1].test?this[s[0]]=c?c.replace(s[1],s[2]):void 0:this[s[0]]=c?s[1].call(this,c,s[2]):void 0:4===s.length&&(this[s[0]]=c?s[3].call(this,c.replace(s[1],s[2])):void 0):this[s]=c||i;d+=2}},G=function(e,t){for(var r in t)if(typeof t[r]===u&&t[r].length>0){for(var n=0;n<t[r].length;n++)if(J(t[r][n],e))return"?"===r?i:r}else if(J(t[r],e))return"?"===r?i:r;return e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,b],[/opios[\/ ]+([\w\.]+)/i],[b,[f,D+" Mini"]],[/\bopr\/([\w\.]+)/i],[b,[f,D]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,b],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[f,"UC"+E]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[b,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[b,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[b,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+E],b],[/\bfocus\/([\w\.]+)/i],[b,[f,O+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[f,D+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[f,D+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[f,"MIUI "+E]],[/fxios\/([-\w\.]+)/i],[b,[f,O]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+E]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+E],b],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,b],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,z],b],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[b,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[f,A+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,A+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[f,"Android "+E]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[b,G,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[f,O+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,b],[/(cobalt)\/([\w\.]+)/i],[f,[b,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[y,"amd64"]],[/(ia32(?=;))/i],[[y,X]],[/((?:i[346]|x)86)[;\)]/i],[[y,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[y,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[y,"armhf"]],[/windows (ce|mobile); ppc;/i],[[y,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[y,/ower/,"",X]],[/(sun4\w)[;\)]/i],[[y,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[y,X]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[g,L],[m,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[g,L],[m,w]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[g,T],[m,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[g,T],[m,v]],[/(macintosh);/i],[p,[g,T]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[g,B],[m,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[g,j],[m,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[g,j],[m,w]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[g,M],[m,w]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[g,M],[m,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[g,"OPPO"],[m,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[g,"Vivo"],[m,w]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[g,"Realme"],[m,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[g,I],[m,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[g,I],[m,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[g,"LG"],[m,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[g,"LG"],[m,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[g,"Lenovo"],[m,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[g,"Nokia"],[m,w]],[/(pixel c)\b/i],[p,[g,C],[m,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[g,C],[m,w]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[g,N],[m,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[g,N],[m,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[g,"OnePlus"],[m,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[g,P],[m,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[g,P],[m,w]],[/(playbook);[-\w\),; ]+(rim)/i],[p,g,[m,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[g,$],[m,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[g,k],[m,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[g,k],[m,w]],[/(nexus 9)/i],[p,[g,"HTC"],[m,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[p,/_/g," "],[m,w]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[g,"Acer"],[m,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[g,"Meizu"],[m,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,p,[m,w]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,p,[m,v]],[/(surface duo)/i],[p,[g,q],[m,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[g,"Fairphone"],[m,w]],[/(u304aa)/i],[p,[g,"AT&T"],[m,w]],[/\bsie-(\w*)/i],[p,[g,"Siemens"],[m,w]],[/\b(rct\w+) b/i],[p,[g,"RCA"],[m,v]],[/\b(venue[\d ]{2,7}) b/i],[p,[g,"Dell"],[m,v]],[/\b(q(?:mv|ta)\w+) b/i],[p,[g,"Verizon"],[m,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[g,"Barnes & Noble"],[m,v]],[/\b(tm\d{3}\w+) b/i],[p,[g,"NuVision"],[m,v]],[/\b(k88) b/i],[p,[g,"ZTE"],[m,v]],[/\b(nx\d{3}j) b/i],[p,[g,"ZTE"],[m,w]],[/\b(gen\d{3}) b.+49h/i],[p,[g,"Swiss"],[m,w]],[/\b(zur\d{3}) b/i],[p,[g,"Swiss"],[m,v]],[/\b((zeki)?tb.*\b) b/i],[p,[g,"Zeki"],[m,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],p,[m,v]],[/\b(ns-?\w{0,9}) b/i],[p,[g,"Insignia"],[m,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[g,"NextBook"],[m,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],p,[m,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],p,[m,w]],[/\b(ph-1) /i],[p,[g,"Essential"],[m,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[g,"Envizen"],[m,v]],[/\b(trio[-\w\. ]+) b/i],[p,[g,"MachSpeed"],[m,v]],[/\btu_(1491) b/i],[p,[g,"Rotor"],[m,v]],[/(shield[\w ]+) b/i],[p,[g,"Nvidia"],[m,v]],[/(sprint) (\w+)/i],[g,p,[m,w]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[g,q],[m,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[g,W],[m,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[g,W],[m,w]],[/smart-tv.+(samsung)/i],[g,[m,S]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[g,L],[m,S]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,"LG"],[m,S]],[/(apple) ?tv/i],[g,[p,T+" TV"],[m,S]],[/crkey/i],[[p,A+"cast"],[g,C],[m,S]],[/droid.+aft(\w)( bui|\))/i],[p,[g,P],[m,S]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[g,B],[m,S]],[/(bravia[\w ]+)( bui|\))/i],[p,[g,N],[m,S]],[/(mitv-\w{5}) bui/i],[p,[g,M],[m,S]],[/Hbbtv.*(technisat) (.*);/i],[g,p,[m,S]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,Y],[p,Y],[m,S]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,S]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,p,[m,_]],[/droid.+; (shield) bui/i],[p,[g,"Nvidia"],[m,_]],[/(playstation [345portablevi]+)/i],[p,[g,N],[m,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[g,q],[m,_]],[/((pebble))app/i],[g,p,[m,x]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[g,T],[m,x]],[/droid.+; (glass) \d/i],[p,[g,C],[m,x]],[/droid.+; (wt63?0{2,3})\)/i],[p,[g,W],[m,x]],[/(quest( 2| pro)?)/i],[p,[g,z],[m,x]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[m,R]],[/(aeobc)\b/i],[p,[g,P],[m,R]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[m,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[m,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,w]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,b],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,b],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[b,G,Q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[b,G,Q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,F],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,b],[/\(bb(10);/i],[b,[f,$]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[b,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[f,O+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[f,A+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,U],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,b],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,b]]},ee=function(e,t){if(typeof e===u&&(t=e,e=i),!(this instanceof ee))return new ee(e,t).getResult();var r=typeof a!==c&&a.navigator?a.navigator:i,n=e||(r&&r.userAgent?r.userAgent:""),o=r&&r.userAgentData?r.userAgentData:i,s=t?H(Z,t):Z,_=r&&r.userAgent==n;return this.getBrowser=function(){var e,t={};return t[f]=i,t[b]=i,K.call(t,n,s.browser),t[h]=typeof(e=t[b])===d?e.replace(/[^\d\.]/g,"").split(".")[0]:i,_&&r&&r.brave&&typeof r.brave.isBrave==l&&(t[f]="Brave"),t},this.getCPU=function(){var e={};return e[y]=i,K.call(e,n,s.cpu),e},this.getDevice=function(){var e={};return e[g]=i,e[p]=i,e[m]=i,K.call(e,n,s.device),_&&!e[m]&&o&&o.mobile&&(e[m]=w),_&&"Macintosh"==e[p]&&r&&typeof r.standalone!==c&&r.maxTouchPoints&&r.maxTouchPoints>2&&(e[p]="iPad",e[m]=v),e},this.getEngine=function(){var e={};return e[f]=i,e[b]=i,K.call(e,n,s.engine),e},this.getOS=function(){var e={};return e[f]=i,e[b]=i,K.call(e,n,s.os),_&&!e[f]&&o&&"Unknown"!=o.platform&&(e[f]=o.platform.replace(/chrome os/i,U).replace(/macos/i,F)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return n},this.setUA=function(e){return n=typeof e===d&&e.length>350?Y(e,350):e,this},this.setUA(n),this};ee.VERSION="1.0.35",ee.BROWSER=V([f,b,h]),ee.CPU=V([y]),ee.DEVICE=V([p,g,m,_,w,S,v,x,R]),ee.ENGINE=ee.OS=V([f,b]),typeof s!==c?(o.exports&&(s=o.exports=ee),s.UAParser=ee):r.amdO?void 0!==(n=(function(){return ee}).call(t,r,t,e))&&(e.exports=n):typeof a!==c&&(a.UAParser=ee);var et=typeof a!==c&&(a.jQuery||a.Zepto);if(et&&!et.ua){var er=new ee;et.ua=er.getResult(),et.ua.get=function(){return er.getUA()},et.ua.set=function(e){er.setUA(e);var t=er.getResult();for(var r in t)et.ua[r]=t[r]}}}("object"==typeof window?window:this)}},s={};function a(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}},n=!0;try{o[e].call(r.exports,r,r.exports,a),n=!1}finally{n&&delete s[e]}return r.exports}a.ab=__dirname+"/";var i=a(226);e.exports=i})()},3278:(e,t,r)=>{"use strict";e.exports=r(517)},3313:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{PageSignatureError:function(){return r},RemovedPageError:function(){return n},RemovedUAError:function(){return o}});class r extends Error{constructor({page:e}){super(`The middleware "${e}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class n extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class o extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}},1658:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{ImageResponse:function(){return n.ImageResponse},NextRequest:function(){return o.NextRequest},NextResponse:function(){return s.NextResponse},URLPattern:function(){return i.URLPattern},userAgent:function(){return a.userAgent},userAgentFromString:function(){return a.userAgentFromString}});let n=r(5949),o=r(6404),s=r(3780),a=r(4091),i=r(8847)},5693:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NextURL",{enumerable:!0,get:function(){return u}});let n=r(6900),o=r(8054),s=r(7352),a=r(2150),i=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function l(e,t){return new URL(String(e).replace(i,"localhost"),t&&String(t).replace(i,"localhost"))}let c=Symbol("NextURLInternal");class u{constructor(e,t,r){let n,o;"object"==typeof t&&"pathname"in t||"string"==typeof t?(n=t,o=r||{}):o=r||t||{},this[c]={url:l(e,n??o.base),options:o,basePath:""},this.analyze()}analyze(){var e,t,r,o,i;let l=(0,a.getNextPathnameInfo)(this[c].url.pathname,{nextConfig:this[c].options.nextConfig,parseData:!0,i18nProvider:this[c].options.i18nProvider}),u=(0,s.getHostname)(this[c].url,this[c].options.headers);this[c].domainLocale=this[c].options.i18nProvider?this[c].options.i18nProvider.detectDomainLocale(u):(0,n.detectDomainLocale)(null==(t=this[c].options.nextConfig)?void 0:null==(e=t.i18n)?void 0:e.domains,u);let d=(null==(r=this[c].domainLocale)?void 0:r.defaultLocale)||(null==(i=this[c].options.nextConfig)?void 0:null==(o=i.i18n)?void 0:o.defaultLocale);this[c].url.pathname=l.pathname,this[c].defaultLocale=d,this[c].basePath=l.basePath??"",this[c].buildId=l.buildId,this[c].locale=l.locale??d,this[c].trailingSlash=l.trailingSlash}formatPathname(){return(0,o.formatNextPathnameInfo)({basePath:this[c].basePath,buildId:this[c].buildId,defaultLocale:this[c].options.forceLocale?void 0:this[c].defaultLocale,locale:this[c].locale,pathname:this[c].url.pathname,trailingSlash:this[c].trailingSlash})}formatSearch(){return this[c].url.search}get buildId(){return this[c].buildId}set buildId(e){this[c].buildId=e}get locale(){return this[c].locale??""}set locale(e){var t,r;if(!this[c].locale||!(null==(r=this[c].options.nextConfig)?void 0:null==(t=r.i18n)?void 0:t.locales.includes(e)))throw TypeError(`The NextURL configuration includes no locale "${e}"`);this[c].locale=e}get defaultLocale(){return this[c].defaultLocale}get domainLocale(){return this[c].domainLocale}get searchParams(){return this[c].url.searchParams}get host(){return this[c].url.host}set host(e){this[c].url.host=e}get hostname(){return this[c].url.hostname}set hostname(e){this[c].url.hostname=e}get port(){return this[c].url.port}set port(e){this[c].url.port=e}get protocol(){return this[c].url.protocol}set protocol(e){this[c].url.protocol=e}get href(){let e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[c].url=l(e),this.analyze()}get origin(){return this[c].url.origin}get pathname(){return this[c].url.pathname}set pathname(e){this[c].url.pathname=e}get hash(){return this[c].url.hash}set hash(e){this[c].url.hash=e}get search(){return this[c].url.search}set search(e){this[c].url.search=e}get password(){return this[c].url.password}set password(e){this[c].url.password=e}get username(){return this[c].url.username}set username(e){this[c].url.username=e}get basePath(){return this[c].basePath}set basePath(e){this[c].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new u(String(this),this[c].options)}}},4203:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}static set(e,t,r,n){return Reflect.set(e,t,r,n)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},5911:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{RequestCookies:function(){return n.RequestCookies},ResponseCookies:function(){return n.ResponseCookies},stringifyCookie:function(){return n.stringifyCookie}});let n=r(6801)},5949:(e,t)=>{"use strict";function r(){throw Error('ImageResponse moved from "next/server" to "next/og" since Next.js 14, please import from "next/og" instead')}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ImageResponse",{enumerable:!0,get:function(){return r}})},6404:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{INTERNALS:function(){return i},NextRequest:function(){return l}});let n=r(5693),o=r(5472),s=r(3313),a=r(5911),i=Symbol("internal request");class l extends Request{constructor(e,t={}){let r="string"!=typeof e&&"url"in e?e.url:String(e);(0,o.validateURL)(r),e instanceof Request?super(e,t):super(r,t);let s=new n.NextURL(r,{headers:(0,o.toNodeOutgoingHttpHeaders)(this.headers),nextConfig:t.nextConfig});this[i]={cookies:new a.RequestCookies(this.headers),geo:t.geo||{},ip:t.ip,nextUrl:s,url:s.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,geo:this.geo,ip:this.ip,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[i].cookies}get geo(){return this[i].geo}get ip(){return this[i].ip}get nextUrl(){return this[i].nextUrl}get page(){throw new s.RemovedPageError}get ua(){throw new s.RemovedUAError}get url(){return this[i].url}}},3780:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NextResponse",{enumerable:!0,get:function(){return d}});let n=r(5911),o=r(5693),s=r(5472),a=r(4203),i=r(5911),l=Symbol("internal response"),c=new Set([301,302,303,307,308]);function u(e,t){var r;if(null==e?void 0:null==(r=e.request)?void 0:r.headers){if(!(e.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");let r=[];for(let[n,o]of e.request.headers)t.set("x-middleware-request-"+n,o),r.push(n);t.set("x-middleware-override-headers",r.join(","))}}class d extends Response{constructor(e,t={}){super(e,t);let r=this.headers,c=new Proxy(new i.ResponseCookies(r),{get(e,o,s){switch(o){case"delete":case"set":return(...s)=>{let a=Reflect.apply(e[o],e,s),l=new Headers(r);return a instanceof i.ResponseCookies&&r.set("x-middleware-set-cookie",a.getAll().map(e=>(0,n.stringifyCookie)(e)).join(",")),u(t,l),a};default:return a.ReflectAdapter.get(e,o,s)}}});this[l]={cookies:c,url:t.url?new o.NextURL(t.url,{headers:(0,s.toNodeOutgoingHttpHeaders)(r),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[l].cookies}static json(e,t){let r=Response.json(e,t);return new d(r.body,r)}static redirect(e,t){let r="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!c.has(r))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');let n="object"==typeof t?t:{},o=new Headers(null==n?void 0:n.headers);return o.set("Location",(0,s.validateURL)(e)),new d(null,{...n,headers:o,status:r})}static rewrite(e,t){let r=new Headers(null==t?void 0:t.headers);return r.set("x-middleware-rewrite",(0,s.validateURL)(e)),u(t,r),new d(null,{...t,headers:r})}static next(e){let t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),u(e,t),new d(null,{...e,headers:t})}}},8847:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"URLPattern",{enumerable:!0,get:function(){return r}});let r="undefined"==typeof URLPattern?void 0:URLPattern},4091:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{isBot:function(){return o},userAgent:function(){return a},userAgentFromString:function(){return s}});let n=function(e){return e&&e.__esModule?e:{default:e}}(r(627));function o(e){return/Googlebot|Mediapartners-Google|AdsBot-Google|googleweblight|Storebot-Google|Google-PageRenderer|Google-InspectionTool|Bingbot|BingPreview|Slurp|DuckDuckBot|baiduspider|yandex|sogou|LinkedInBot|bitlybot|tumblr|vkShare|quora link preview|facebookexternalhit|facebookcatalog|Twitterbot|applebot|redditbot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|ia_archiver/i.test(e)}function s(e){return{...(0,n.default)(e),isBot:void 0!==e&&o(e)}}function a({headers:e}){return s(e.get("user-agent")||void 0)}},5472:(e,t)=>{"use strict";function r(e){let t=new Headers;for(let[r,n]of Object.entries(e))for(let e of Array.isArray(n)?n:[n])void 0!==e&&("number"==typeof e&&(e=e.toString()),t.append(r,e));return t}function n(e){var t,r,n,o,s,a=[],i=0;function l(){for(;i<e.length&&/\s/.test(e.charAt(i));)i+=1;return i<e.length}for(;i<e.length;){for(t=i,s=!1;l();)if(","===(r=e.charAt(i))){for(n=i,i+=1,l(),o=i;i<e.length&&"="!==(r=e.charAt(i))&&";"!==r&&","!==r;)i+=1;i<e.length&&"="===e.charAt(i)?(s=!0,i=o,a.push(e.substring(t,n)),t=i):i=n+1}else i+=1;(!s||i>=e.length)&&a.push(e.substring(t,e.length))}return a}function o(e){let t={},r=[];if(e)for(let[o,s]of e.entries())"set-cookie"===o.toLowerCase()?(r.push(...n(s)),t[o]=1===r.length?r[0]:r):t[o]=s;return t}function s(e){try{return String(new URL(String(e)))}catch(t){throw Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t})}}Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{fromNodeOutgoingHttpHeaders:function(){return r},splitCookiesString:function(){return n},toNodeOutgoingHttpHeaders:function(){return o},validateURL:function(){return s}})},7352:(e,t)=>{"use strict";function r(e,t){let r;if((null==t?void 0:t.host)&&!Array.isArray(t.host))r=t.host.toString().split(":",1)[0];else{if(!e.hostname)return;r=e.hostname}return r.toLowerCase()}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getHostname",{enumerable:!0,get:function(){return r}})},6900:(e,t)=>{"use strict";function r(e,t,r){if(e)for(let s of(r&&(r=r.toLowerCase()),e)){var n,o;if(t===(null==(n=s.domain)?void 0:n.split(":",1)[0].toLowerCase())||r===s.defaultLocale.toLowerCase()||(null==(o=s.locales)?void 0:o.some(e=>e.toLowerCase()===r)))return s}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"detectDomainLocale",{enumerable:!0,get:function(){return r}})},4444:(e,t)=>{"use strict";function r(e,t){let r;let n=e.split("/");return(t||[]).some(t=>!!n[1]&&n[1].toLowerCase()===t.toLowerCase()&&(r=t,n.splice(1,1),e=n.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"normalizeLocalePath",{enumerable:!0,get:function(){return r}})},7420:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addLocale",{enumerable:!0,get:function(){return s}});let n=r(1303),o=r(3540);function s(e,t,r,s){if(!t||t===r)return e;let a=e.toLowerCase();return!s&&((0,o.pathHasPrefix)(a,"/api")||(0,o.pathHasPrefix)(a,"/"+t.toLowerCase()))?e:(0,n.addPathPrefix)(e,"/"+t)}},1303:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addPathPrefix",{enumerable:!0,get:function(){return o}});let n=r(6278);function o(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:o,hash:s}=(0,n.parsePath)(e);return""+t+r+o+s}},1068:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addPathSuffix",{enumerable:!0,get:function(){return o}});let n=r(6278);function o(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:o,hash:s}=(0,n.parsePath)(e);return""+r+t+o+s}},8054:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"formatNextPathnameInfo",{enumerable:!0,get:function(){return i}});let n=r(5316),o=r(1303),s=r(1068),a=r(7420);function i(e){let t=(0,a.addLocale)(e.pathname,e.locale,e.buildId?void 0:e.defaultLocale,e.ignorePrefix);return(e.buildId||!e.trailingSlash)&&(t=(0,n.removeTrailingSlash)(t)),e.buildId&&(t=(0,s.addPathSuffix)((0,o.addPathPrefix)(t,"/_next/data/"+e.buildId),"/"===e.pathname?"index.json":".json")),t=(0,o.addPathPrefix)(t,e.basePath),!e.buildId&&e.trailingSlash?t.endsWith("/")?t:(0,s.addPathSuffix)(t,"/"):(0,n.removeTrailingSlash)(t)}},2150:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getNextPathnameInfo",{enumerable:!0,get:function(){return a}});let n=r(4444),o=r(7858),s=r(3540);function a(e,t){var r,a;let{basePath:i,i18n:l,trailingSlash:c}=null!=(r=t.nextConfig)?r:{},u={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):c};i&&(0,s.pathHasPrefix)(u.pathname,i)&&(u.pathname=(0,o.removePathPrefix)(u.pathname,i),u.basePath=i);let d=u.pathname;if(u.pathname.startsWith("/_next/data/")&&u.pathname.endsWith(".json")){let e=u.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),r=e[0];u.buildId=r,d="index"!==e[1]?"/"+e.slice(1).join("/"):"/",!0===t.parseData&&(u.pathname=d)}if(l){let e=t.i18nProvider?t.i18nProvider.analyze(u.pathname):(0,n.normalizeLocalePath)(u.pathname,l.locales);u.locale=e.detectedLocale,u.pathname=null!=(a=e.pathname)?a:u.pathname,!e.detectedLocale&&u.buildId&&(e=t.i18nProvider?t.i18nProvider.analyze(d):(0,n.normalizeLocalePath)(d,l.locales)).detectedLocale&&(u.locale=e.detectedLocale)}return u}},6278:(e,t)=>{"use strict";function r(e){let t=e.indexOf("#"),r=e.indexOf("?"),n=r>-1&&(t<0||r<t);return n||t>-1?{pathname:e.substring(0,n?r:t),query:n?e.substring(r,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"parsePath",{enumerable:!0,get:function(){return r}})},3540:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"pathHasPrefix",{enumerable:!0,get:function(){return o}});let n=r(6278);function o(e,t){if("string"!=typeof e)return!1;let{pathname:r}=(0,n.parsePath)(e);return r===t||r.startsWith(t+"/")}},7858:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removePathPrefix",{enumerable:!0,get:function(){return o}});let n=r(3540);function o(e,t){if(!(0,n.pathHasPrefix)(e,t))return e;let r=e.slice(t.length);return r.startsWith("/")?r:"/"+r}},5316:(e,t)=>{"use strict";function r(e){return e.replace(/\/$/,"")||"/"}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removeTrailingSlash",{enumerable:!0,get:function(){return r}})},3352:(e,t,r)=>{if(!globalThis.DOMException)try{let{MessageChannel:e}=r(6162),t=new e().port1,n=new ArrayBuffer;t.postMessage(n,[n,n])}catch(e){"DOMException"===e.constructor.name&&(globalThis.DOMException=e.constructor)}e.exports=globalThis.DOMException},2873:function(e,t){(function(e){"use strict";var t,r,n;function o(){}function s(e){return"object"==typeof e&&null!==e||"function"==typeof e}function a(e,t){try{Object.defineProperty(e,"name",{value:t,configurable:!0})}catch(e){}}let i=Promise,l=Promise.prototype.then,c=Promise.reject.bind(i);function u(e){return new i(e)}function d(e){return u(t=>t(e))}function h(e,t,r){return l.call(e,t,r)}function p(e,t,r){h(h(e,t,r),void 0,o)}function f(e,t){p(e,void 0,t)}function m(e){h(e,void 0,o)}let g=e=>{if("function"==typeof queueMicrotask)g=queueMicrotask;else{let e=d(void 0);g=t=>h(e,t)}return g(e)};function b(e,t,r){if("function"!=typeof e)throw TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,r)}function y(e,t,r){try{return d(b(e,t,r))}catch(e){return c(e)}}class _{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(e){let t=this._back,r=t;16383===t._elements.length&&(r={_elements:[],_next:void 0}),t._elements.push(e),r!==t&&(this._back=r,t._next=r),++this._size}shift(){let e=this._front,t=e,r=this._cursor,n=r+1,o=e._elements,s=o[r];return 16384===n&&(t=e._next,n=0),--this._size,this._cursor=n,e!==t&&(this._front=t),o[r]=void 0,s}forEach(e){let t=this._cursor,r=this._front,n=r._elements;for(;(t!==n.length||void 0!==r._next)&&(t!==n.length||(n=(r=r._next)._elements,t=0,0!==n.length));)e(n[t]),++t}peek(){let e=this._front,t=this._cursor;return e._elements[t]}}let w=Symbol("[[AbortSteps]]"),v=Symbol("[[ErrorSteps]]"),S=Symbol("[[CancelSteps]]"),x=Symbol("[[PullSteps]]"),R=Symbol("[[ReleaseSteps]]");function P(e,t){var r;e._ownerReadableStream=t,t._reader=e,"readable"===t._state?E(e):"closed"===t._state?(E(e),O(e)):(r=t._storedError,E(e),A(e,r))}function T(e,t){return t1(e._ownerReadableStream,t)}function k(e){var t,r;let n=e._ownerReadableStream;"readable"===n._state?A(e,TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):(t=e,r=TypeError("Reader was released and can no longer be used to monitor the stream's closedness"),E(t),A(t,r)),n._readableStreamController[R](),n._reader=void 0,e._ownerReadableStream=void 0}function $(e){return TypeError("Cannot "+e+" a stream using a released reader")}function E(e){e._closedPromise=u((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r})}function A(e,t){void 0!==e._closedPromise_reject&&(m(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function O(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}let C=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},j=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function q(e,t){if(void 0!==e&&!("object"==typeof e||"function"==typeof e))throw TypeError(`${t} is not an object.`)}function I(e,t){if("function"!=typeof e)throw TypeError(`${t} is not a function.`)}function D(e,t){if(!("object"==typeof e&&null!==e||"function"==typeof e))throw TypeError(`${t} is not an object.`)}function L(e,t,r){if(void 0===e)throw TypeError(`Parameter ${t} is required in '${r}'.`)}function B(e,t,r){if(void 0===e)throw TypeError(`${t} is required in '${r}'.`)}function N(e){return Number(e)}function M(e,t){var r,n;let o=Number.MAX_SAFE_INTEGER,s=Number(e);if(!C(s=0===(r=s)?0:r))throw TypeError(`${t} is not a finite number`);if((s=0===(n=j(s))?0:n)<0||s>o)throw TypeError(`${t} is outside the accepted range of 0 to ${o}, inclusive`);return C(s)&&0!==s?s:0}function W(e,t){if(!tZ(e))throw TypeError(`${t} is not a ReadableStream.`)}function z(e){return new J(e)}function U(e,t){e._reader._readRequests.push(t)}function F(e,t,r){let n=e._reader._readRequests.shift();r?n._closeSteps():n._chunkSteps(t)}function H(e){return e._reader._readRequests.length}function V(e){let t=e._reader;return!!(void 0!==t&&X(t))}class J{constructor(e){if(L(e,1,"ReadableStreamDefaultReader"),W(e,"First parameter"),t0(e))throw TypeError("This stream has already been locked for exclusive reading by another reader");P(this,e),this._readRequests=new _}get closed(){return X(this)?this._closedPromise:c(G("closed"))}cancel(e){return X(this)?void 0===this._ownerReadableStream?c($("cancel")):T(this,e):c(G("cancel"))}read(){let e,t;if(!X(this))return c(G("read"));if(void 0===this._ownerReadableStream)return c($("read from"));let r=u((r,n)=>{e=r,t=n});return Y(this,{_chunkSteps:t=>e({value:t,done:!1}),_closeSteps:()=>e({value:void 0,done:!0}),_errorSteps:e=>t(e)}),r}releaseLock(){if(!X(this))throw G("releaseLock");if(void 0!==this._ownerReadableStream)k(this),K(this,TypeError("Reader was released"))}}function X(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_readRequests"))&&e instanceof J}function Y(e,t){let r=e._ownerReadableStream;r._disturbed=!0,"closed"===r._state?t._closeSteps():"errored"===r._state?t._errorSteps(r._storedError):r._readableStreamController[x](t)}function K(e,t){let r=e._readRequests;e._readRequests=new _,r.forEach(e=>{e._errorSteps(t)})}function G(e){return TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}Object.defineProperties(J.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),a(J.prototype.cancel,"cancel"),a(J.prototype.read,"read"),a(J.prototype.releaseLock,"releaseLock"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(J.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});let Q=Object.getPrototypeOf(Object.getPrototypeOf(async function*(){}).prototype);class Z{constructor(e,t){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=e,this._preventCancel=t}next(){let e=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?h(this._ongoingPromise,e,e):e(),this._ongoingPromise}return(e){let t=()=>this._returnSteps(e);return this._ongoingPromise?h(this._ongoingPromise,t,t):t()}_nextSteps(){let e,t;if(this._isFinished)return Promise.resolve({value:void 0,done:!0});let r=this._reader,n=u((r,n)=>{e=r,t=n});return Y(r,{_chunkSteps:t=>{this._ongoingPromise=void 0,g(()=>e({value:t,done:!1}))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,k(r),e({value:void 0,done:!0})},_errorSteps:e=>{this._ongoingPromise=void 0,this._isFinished=!0,k(r),t(e)}}),n}_returnSteps(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;let t=this._reader;if(!this._preventCancel){let r=T(t,e);return k(t),h(r,()=>({value:e,done:!0}),void 0)}return k(t),d({value:e,done:!0})}}let ee={next(){return et(this)?this._asyncIteratorImpl.next():c(er("next"))},return(e){return et(this)?this._asyncIteratorImpl.return(e):c(er("return"))}};function et(e){if(!s(e)||!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof Z}catch(e){return!1}}function er(e){return TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}Object.setPrototypeOf(ee,Q);let en=Number.isNaN||function(e){return e!=e};function eo(e){return e.slice()}function es(e,t,r,n,o){new Uint8Array(e).set(new Uint8Array(r,n,o),t)}let ea=e=>("function"==typeof e.transfer?ea=e=>e.transfer():"function"==typeof structuredClone?ea=e=>structuredClone(e,{transfer:[e]}):ea=e=>e,ea(e)),ei=e=>(ei="boolean"==typeof e.detached?e=>e.detached:e=>0===e.byteLength)(e);function el(e,t,r){if(e.slice)return e.slice(t,r);let n=r-t,o=new ArrayBuffer(n);return es(o,0,e,t,n),o}function ec(e,t){let r=e[t];if(null!=r){if("function"!=typeof r)throw TypeError(`${String(t)} is not a function`);return r}}let eu=null!==(n=null!==(t=Symbol.asyncIterator)&&void 0!==t?t:null===(r=Symbol.for)||void 0===r?void 0:r.call(Symbol,"Symbol.asyncIterator"))&&void 0!==n?n:"@@asyncIterator";function ed(e){return new Uint8Array(el(e.buffer,e.byteOffset,e.byteOffset+e.byteLength))}function eh(e){let t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function ep(e,t,r){if(!(!("number"!=typeof r||en(r))&&!(r<0))||r===1/0)throw RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function ef(e){e._queue=new _,e._queueTotalSize=0}function em(e){return e===DataView}class eg{constructor(){throw TypeError("Illegal constructor")}get view(){if(!e_(this))throw eF("view");return this._view}respond(e){if(!e_(this))throw eF("respond");if(L(e,1,"respond"),e=M(e,"First parameter"),void 0===this._associatedReadableByteStreamController)throw TypeError("This BYOB request has been invalidated");if(ei(this._view.buffer))throw TypeError("The BYOB request's buffer has been detached and so cannot be used as a response");eW(this._associatedReadableByteStreamController,e)}respondWithNewView(e){if(!e_(this))throw eF("respondWithNewView");if(L(e,1,"respondWithNewView"),!ArrayBuffer.isView(e))throw TypeError("You can only respond with array buffer views");if(void 0===this._associatedReadableByteStreamController)throw TypeError("This BYOB request has been invalidated");if(ei(e.buffer))throw TypeError("The given view's buffer has been detached and so cannot be used as a response");ez(this._associatedReadableByteStreamController,e)}}Object.defineProperties(eg.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),a(eg.prototype.respond,"respond"),a(eg.prototype.respondWithNewView,"respondWithNewView"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(eg.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class eb{constructor(){throw TypeError("Illegal constructor")}get byobRequest(){if(!ey(this))throw eH("byobRequest");return eN(this)}get desiredSize(){if(!ey(this))throw eH("desiredSize");return eM(this)}close(){if(!ey(this))throw eH("close");if(this._closeRequested)throw TypeError("The stream has already been closed; do not close it again!");let e=this._controlledReadableByteStream._state;if("readable"!==e)throw TypeError(`The stream (in ${e} state) is not in the readable state and cannot be closed`);eI(this)}enqueue(e){if(!ey(this))throw eH("enqueue");if(L(e,1,"enqueue"),!ArrayBuffer.isView(e))throw TypeError("chunk must be an array buffer view");if(0===e.byteLength)throw TypeError("chunk must have non-zero byteLength");if(0===e.buffer.byteLength)throw TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw TypeError("stream is closed or draining");let t=this._controlledReadableByteStream._state;if("readable"!==t)throw TypeError(`The stream (in ${t} state) is not in the readable state and cannot be enqueued to`);eD(this,e)}error(e){if(!ey(this))throw eH("error");eL(this,e)}[S](e){ev(this),ef(this);let t=this._cancelAlgorithm(e);return eq(this),t}[x](e){let t=this._controlledReadableByteStream;if(this._queueTotalSize>0){eB(this,e);return}let r=this._autoAllocateChunkSize;if(void 0!==r){let t;try{t=new ArrayBuffer(r)}catch(t){e._errorSteps(t);return}let n={buffer:t,bufferByteLength:r,byteOffset:0,byteLength:r,bytesFilled:0,minimumFill:1,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(n)}U(t,e),ew(this)}[R](){if(this._pendingPullIntos.length>0){let e=this._pendingPullIntos.peek();e.readerType="none",this._pendingPullIntos=new _,this._pendingPullIntos.push(e)}}}function ey(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream"))&&e instanceof eb}function e_(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController"))&&e instanceof eg}function ew(e){if(function(e){let t=e._controlledReadableByteStream;return"readable"===t._state&&!e._closeRequested&&!!e._started&&!!(V(t)&&H(t)>0||eX(t)&&eJ(t)>0||eM(e)>0)}(e)){if(e._pulling){e._pullAgain=!0;return}e._pulling=!0,p(e._pullAlgorithm(),()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,ew(e)),null),t=>(eL(e,t),null))}}function ev(e){eA(e),e._pendingPullIntos=new _}function eS(e,t){let r=!1;"closed"===e._state&&(r=!0);let n=ex(t);"default"===t.readerType?F(e,n,r):function(e,t,r){let n=e._reader._readIntoRequests.shift();r?n._closeSteps(t):n._chunkSteps(t)}(e,n,r)}function ex(e){let t=e.bytesFilled,r=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/r)}function eR(e,t,r,n){e._queue.push({buffer:t,byteOffset:r,byteLength:n}),e._queueTotalSize+=n}function eP(e,t,r,n){let o;try{o=el(t,r,r+n)}catch(t){throw eL(e,t),t}eR(e,o,0,n)}function eT(e,t){t.bytesFilled>0&&eP(e,t.buffer,t.byteOffset,t.bytesFilled),ej(e)}function ek(e,t){let r=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),n=t.bytesFilled+r,o=r,s=!1,a=n%t.elementSize,i=n-a;i>=t.minimumFill&&(o=i-t.bytesFilled,s=!0);let l=e._queue;for(;o>0;){let r=l.peek(),n=Math.min(o,r.byteLength),s=t.byteOffset+t.bytesFilled;es(t.buffer,s,r.buffer,r.byteOffset,n),r.byteLength===n?l.shift():(r.byteOffset+=n,r.byteLength-=n),e._queueTotalSize-=n,e$(e,n,t),o-=n}return s}function e$(e,t,r){r.bytesFilled+=t}function eE(e){0===e._queueTotalSize&&e._closeRequested?(eq(e),t2(e._controlledReadableByteStream)):ew(e)}function eA(e){null!==e._byobRequest&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function eO(e){for(;e._pendingPullIntos.length>0;){if(0===e._queueTotalSize)return;let t=e._pendingPullIntos.peek();ek(e,t)&&(ej(e),eS(e._controlledReadableByteStream,t))}}function eC(e,t){let r=e._pendingPullIntos.peek();eA(e),"closed"===e._controlledReadableByteStream._state?function(e,t){"none"===t.readerType&&ej(e);let r=e._controlledReadableByteStream;if(eX(r))for(;eJ(r)>0;)eS(r,ej(e))}(e,r):function(e,t,r){if(e$(e,t,r),"none"===r.readerType){eT(e,r),eO(e);return}if(r.bytesFilled<r.minimumFill)return;ej(e);let n=r.bytesFilled%r.elementSize;if(n>0){let t=r.byteOffset+r.bytesFilled;eP(e,r.buffer,t-n,n)}r.bytesFilled-=n,eS(e._controlledReadableByteStream,r),eO(e)}(e,t,r),ew(e)}function ej(e){return e._pendingPullIntos.shift()}function eq(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function eI(e){let t=e._controlledReadableByteStream;if(!e._closeRequested&&"readable"===t._state){if(e._queueTotalSize>0){e._closeRequested=!0;return}if(e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek();if(t.bytesFilled%t.elementSize!=0){let t=TypeError("Insufficient bytes to fill elements in the given buffer");throw eL(e,t),t}}eq(e),t2(t)}}function eD(e,t){let r=e._controlledReadableByteStream;if(e._closeRequested||"readable"!==r._state)return;let{buffer:n,byteOffset:o,byteLength:s}=t;if(ei(n))throw TypeError("chunk's buffer is detached and so cannot be enqueued");let a=ea(n);if(e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek();if(ei(t.buffer))throw TypeError("The BYOB request's buffer has been detached and so cannot be filled with an enqueued chunk");eA(e),t.buffer=ea(t.buffer),"none"===t.readerType&&eT(e,t)}V(r)?(function(e){let t=e._controlledReadableByteStream._reader;for(;t._readRequests.length>0;){if(0===e._queueTotalSize)return;eB(e,t._readRequests.shift())}}(e),0===H(r)?eR(e,a,o,s):(e._pendingPullIntos.length>0&&ej(e),F(r,new Uint8Array(a,o,s),!1))):eX(r)?(eR(e,a,o,s),eO(e)):eR(e,a,o,s),ew(e)}function eL(e,t){let r=e._controlledReadableByteStream;"readable"===r._state&&(ev(e),ef(e),eq(e),t3(r,t))}function eB(e,t){let r=e._queue.shift();e._queueTotalSize-=r.byteLength,eE(e);let n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);t._chunkSteps(n)}function eN(e){if(null===e._byobRequest&&e._pendingPullIntos.length>0){let t=e._pendingPullIntos.peek(),r=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),n=Object.create(eg.prototype);n._associatedReadableByteStreamController=e,n._view=r,e._byobRequest=n}return e._byobRequest}function eM(e){let t=e._controlledReadableByteStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function eW(e,t){let r=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t)throw TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(0===t)throw TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+t>r.byteLength)throw RangeError("bytesWritten out of range")}r.buffer=ea(r.buffer),eC(e,t)}function ez(e,t){let r=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t.byteLength)throw TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(0===t.byteLength)throw TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==t.buffer.byteLength)throw RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+t.byteLength>r.byteLength)throw RangeError("The region specified by view is larger than byobRequest");let n=t.byteLength;r.buffer=ea(t.buffer),eC(e,n)}function eU(e,t,r,n,o,s,a){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,ef(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=s,t._pullAlgorithm=n,t._cancelAlgorithm=o,t._autoAllocateChunkSize=a,t._pendingPullIntos=new _,e._readableStreamController=t,p(d(r()),()=>(t._started=!0,ew(t),null),e=>(eL(t,e),null))}function eF(e){return TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function eH(e){return TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function eV(e,t){e._reader._readIntoRequests.push(t)}function eJ(e){return e._reader._readIntoRequests.length}function eX(e){let t=e._reader;return!!(void 0!==t&&eK(t))}Object.defineProperties(eb.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),a(eb.prototype.close,"close"),a(eb.prototype.enqueue,"enqueue"),a(eb.prototype.error,"error"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(eb.prototype,Symbol.toStringTag,{value:"ReadableByteStreamController",configurable:!0});class eY{constructor(e){if(L(e,1,"ReadableStreamBYOBReader"),W(e,"First parameter"),t0(e))throw TypeError("This stream has already been locked for exclusive reading by another reader");if(!ey(e._readableStreamController))throw TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");P(this,e),this._readIntoRequests=new _}get closed(){return eK(this)?this._closedPromise:c(eZ("closed"))}cancel(e){return eK(this)?void 0===this._ownerReadableStream?c($("cancel")):T(this,e):c(eZ("cancel"))}read(e,t={}){let r,n,o;if(!eK(this))return c(eZ("read"));if(!ArrayBuffer.isView(e))return c(TypeError("view must be an array buffer view"));if(0===e.byteLength)return c(TypeError("view must have non-zero byteLength"));if(0===e.buffer.byteLength)return c(TypeError("view's buffer must have non-zero byteLength"));if(ei(e.buffer))return c(TypeError("view's buffer has been detached"));try{var s,a;s="options",q(t,s),r={min:M(null!==(a=null==t?void 0:t.min)&&void 0!==a?a:1,`${s} has member 'min' that`)}}catch(e){return c(e)}let i=r.min;if(0===i)return c(TypeError("options.min must be greater than 0"));if(em(e.constructor)){if(i>e.byteLength)return c(RangeError("options.min must be less than or equal to view's byteLength"))}else if(i>e.length)return c(RangeError("options.min must be less than or equal to view's length"));if(void 0===this._ownerReadableStream)return c($("read from"));let l=u((e,t)=>{n=e,o=t});return eG(this,e,i,{_chunkSteps:e=>n({value:e,done:!1}),_closeSteps:e=>n({value:e,done:!0}),_errorSteps:e=>o(e)}),l}releaseLock(){if(!eK(this))throw eZ("releaseLock");if(void 0!==this._ownerReadableStream)k(this),eQ(this,TypeError("Reader was released"))}}function eK(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_readIntoRequests"))&&e instanceof eY}function eG(e,t,r,n){let o=e._ownerReadableStream;o._disturbed=!0,"errored"===o._state?n._errorSteps(o._storedError):function(e,t,r,n){let o;let s=e._controlledReadableByteStream,a=t.constructor,i=em(a)?1:a.BYTES_PER_ELEMENT,{byteOffset:l,byteLength:c}=t;try{o=ea(t.buffer)}catch(e){n._errorSteps(e);return}let u={buffer:o,bufferByteLength:o.byteLength,byteOffset:l,byteLength:c,bytesFilled:0,minimumFill:r*i,elementSize:i,viewConstructor:a,readerType:"byob"};if(e._pendingPullIntos.length>0){e._pendingPullIntos.push(u),eV(s,n);return}if("closed"===s._state){let e=new a(u.buffer,u.byteOffset,0);n._closeSteps(e);return}if(e._queueTotalSize>0){if(ek(e,u)){let t=ex(u);eE(e),n._chunkSteps(t);return}if(e._closeRequested){let t=TypeError("Insufficient bytes to fill elements in the given buffer");eL(e,t),n._errorSteps(t);return}}e._pendingPullIntos.push(u),eV(s,n),ew(e)}(o._readableStreamController,t,r,n)}function eQ(e,t){let r=e._readIntoRequests;e._readIntoRequests=new _,r.forEach(e=>{e._errorSteps(t)})}function eZ(e){return TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function e0(e,t){let{highWaterMark:r}=e;if(void 0===r)return t;if(en(r)||r<0)throw RangeError("Invalid highWaterMark");return r}function e1(e){let{size:t}=e;return t||(()=>1)}function e2(e,t){q(e,t);let r=null==e?void 0:e.highWaterMark,n=null==e?void 0:e.size;return{highWaterMark:void 0===r?void 0:N(r),size:void 0===n?void 0:(I(n,`${t} has member 'size' that`),e=>N(n(e)))}}function e3(e,t){if(!e5(e))throw TypeError(`${t} is not a WritableStream.`)}Object.defineProperties(eY.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),a(eY.prototype.cancel,"cancel"),a(eY.prototype.read,"read"),a(eY.prototype.releaseLock,"releaseLock"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(eY.prototype,Symbol.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});let e8="function"==typeof AbortController;class e4{constructor(e={},t={}){void 0===e?e=null:D(e,"First parameter");let r=e2(t,"Second parameter"),n=function(e,t){q(e,t);let r=null==e?void 0:e.abort,n=null==e?void 0:e.close,o=null==e?void 0:e.start,s=null==e?void 0:e.type,a=null==e?void 0:e.write;return{abort:void 0===r?void 0:(I(r,`${t} has member 'abort' that`),t=>y(r,e,[t])),close:void 0===n?void 0:(I(n,`${t} has member 'close' that`),()=>y(n,e,[])),start:void 0===o?void 0:(I(o,`${t} has member 'start' that`),t=>b(o,e,[t])),write:void 0===a?void 0:(I(a,`${t} has member 'write' that`),(t,r)=>y(a,e,[t,r])),type:s}}(e,"First parameter");if(e6(this),void 0!==n.type)throw RangeError("Invalid type is specified");let o=e1(r);(function(e,t,r,n){let o,s;let a=Object.create(tf.prototype);o=void 0!==t.start?()=>t.start(a):()=>void 0,s=void 0!==t.write?e=>t.write(e,a):()=>d(void 0),tg(e,a,o,s,void 0!==t.close?()=>t.close():()=>d(void 0),void 0!==t.abort?e=>t.abort(e):()=>d(void 0),r,n)})(this,n,e0(r,1),o)}get locked(){if(!e5(this))throw tS("locked");return e9(this)}abort(e){return e5(this)?e9(this)?c(TypeError("Cannot abort a stream that already has a writer")):e7(this,e):c(tS("abort"))}close(){return e5(this)?e9(this)?c(TypeError("Cannot close a stream that already has a writer")):to(this)?c(TypeError("Cannot close an already-closing stream")):te(this):c(tS("close"))}getWriter(){if(!e5(this))throw tS("getWriter");return new ti(this)}}function e6(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new _,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function e5(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_writableStreamController"))&&e instanceof e4}function e9(e){return void 0!==e._writer}function e7(e,t){var r;if("closed"===e._state||"errored"===e._state)return d(void 0);e._writableStreamController._abortReason=t,null===(r=e._writableStreamController._abortController)||void 0===r||r.abort(t);let n=e._state;if("closed"===n||"errored"===n)return d(void 0);if(void 0!==e._pendingAbortRequest)return e._pendingAbortRequest._promise;let o=!1;"erroring"===n&&(o=!0,t=void 0);let s=u((r,n)=>{e._pendingAbortRequest={_promise:void 0,_resolve:r,_reject:n,_reason:t,_wasAlreadyErroring:o}});return e._pendingAbortRequest._promise=s,o||tr(e,t),s}function te(e){var t;let r=e._state;if("closed"===r||"errored"===r)return c(TypeError(`The stream (in ${r} state) is not in the writable state and cannot be closed`));let n=u((t,r)=>{e._closeRequest={_resolve:t,_reject:r}}),o=e._writer;return void 0!==o&&e._backpressure&&"writable"===r&&tC(o),ep(t=e._writableStreamController,tp,0),t_(t),n}function tt(e,t){if("writable"===e._state){tr(e,t);return}tn(e)}function tr(e,t){let r=e._writableStreamController;e._state="erroring",e._storedError=t;let n=e._writer;void 0!==n&&tu(n,t),!(void 0!==e._inFlightWriteRequest||void 0!==e._inFlightCloseRequest)&&r._started&&tn(e)}function tn(e){e._state="errored",e._writableStreamController[v]();let t=e._storedError;if(e._writeRequests.forEach(e=>{e._reject(t)}),e._writeRequests=new _,void 0===e._pendingAbortRequest){ts(e);return}let r=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,r._wasAlreadyErroring){r._reject(t),ts(e);return}p(e._writableStreamController[w](r._reason),()=>(r._resolve(),ts(e),null),t=>(r._reject(t),ts(e),null))}function to(e){return void 0!==e._closeRequest||void 0!==e._inFlightCloseRequest}function ts(e){void 0!==e._closeRequest&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);let t=e._writer;void 0!==t&&tk(t,e._storedError)}function ta(e,t){let r=e._writer;void 0!==r&&t!==e._backpressure&&(t?tE(r):tC(r)),e._backpressure=t}Object.defineProperties(e4.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),a(e4.prototype.abort,"abort"),a(e4.prototype.close,"close"),a(e4.prototype.getWriter,"getWriter"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(e4.prototype,Symbol.toStringTag,{value:"WritableStream",configurable:!0});class ti{constructor(e){if(L(e,1,"WritableStreamDefaultWriter"),e3(e,"First parameter"),e9(e))throw TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;let t=e._state;if("writable"===t)!to(e)&&e._backpressure?tE(this):(tE(this),tC(this)),tT(this);else if("erroring"===t)tA(this,e._storedError),tT(this);else if("closed"===t)tE(this),tC(this),tT(this),t$(this);else{let t=e._storedError;tA(this,t),tT(this),tk(this,t)}}get closed(){return tl(this)?this._closedPromise:c(tR("closed"))}get desiredSize(){if(!tl(this))throw tR("desiredSize");if(void 0===this._ownerWritableStream)throw tP("desiredSize");return function(e){let t=e._ownerWritableStream,r=t._state;return"errored"===r||"erroring"===r?null:"closed"===r?0:ty(t._writableStreamController)}(this)}get ready(){return tl(this)?this._readyPromise:c(tR("ready"))}abort(e){return tl(this)?void 0===this._ownerWritableStream?c(tP("abort")):e7(this._ownerWritableStream,e):c(tR("abort"))}close(){if(!tl(this))return c(tR("close"));let e=this._ownerWritableStream;return void 0===e?c(tP("close")):to(e)?c(TypeError("Cannot close an already-closing stream")):tc(this)}releaseLock(){if(!tl(this))throw tR("releaseLock");void 0!==this._ownerWritableStream&&td(this)}write(e){return tl(this)?void 0===this._ownerWritableStream?c(tP("write to")):th(this,e):c(tR("write"))}}function tl(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream"))&&e instanceof ti}function tc(e){return te(e._ownerWritableStream)}function tu(e,t){"pending"===e._readyPromiseState?tO(e,t):tA(e,t)}function td(e){var t,r;let n=e._ownerWritableStream,o=TypeError("Writer was released and can no longer be used to monitor the stream's closedness");tu(e,o),"pending"===e._closedPromiseState?tk(e,o):(t=e,r=o,tT(t),tk(t,r)),n._writer=void 0,e._ownerWritableStream=void 0}function th(e,t){let r=e._ownerWritableStream,n=r._writableStreamController,o=function(e,t){try{return e._strategySizeAlgorithm(t)}catch(t){return tw(e,t),1}}(n,t);if(r!==e._ownerWritableStream)return c(tP("write to"));let s=r._state;if("errored"===s)return c(r._storedError);if(to(r)||"closed"===s)return c(TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===s)return c(r._storedError);let a=u((e,t)=>{r._writeRequests.push({_resolve:e,_reject:t})});return function(e,t,r){try{ep(e,t,r)}catch(t){tw(e,t);return}let n=e._controlledWritableStream;to(n)||"writable"!==n._state||ta(n,0>=ty(e)),t_(e)}(n,t,o),a}Object.defineProperties(ti.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),a(ti.prototype.abort,"abort"),a(ti.prototype.close,"close"),a(ti.prototype.releaseLock,"releaseLock"),a(ti.prototype.write,"write"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(ti.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});let tp={};class tf{constructor(){throw TypeError("Illegal constructor")}get abortReason(){if(!tm(this))throw tx("abortReason");return this._abortReason}get signal(){if(!tm(this))throw tx("signal");if(void 0===this._abortController)throw TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(e){if(!tm(this))throw tx("error");"writable"===this._controlledWritableStream._state&&tv(this,e)}[w](e){let t=this._abortAlgorithm(e);return tb(this),t}[v](){ef(this)}}function tm(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream"))&&e instanceof tf}function tg(e,t,r,n,o,s,a,i){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,ef(t),t._abortReason=void 0,t._abortController=function(){if(e8)return new AbortController}(),t._started=!1,t._strategySizeAlgorithm=i,t._strategyHWM=a,t._writeAlgorithm=n,t._closeAlgorithm=o,t._abortAlgorithm=s,ta(e,0>=ty(t)),p(d(r()),()=>(t._started=!0,t_(t),null),r=>(t._started=!0,tt(e,r),null))}function tb(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function ty(e){return e._strategyHWM-e._queueTotalSize}function t_(e){let t=e._controlledWritableStream;if(!e._started||void 0!==t._inFlightWriteRequest)return;if("erroring"===t._state){tn(t);return}if(0===e._queue.length)return;let r=e._queue.peek().value;r===tp?function(e){let t=e._controlledWritableStream;t._inFlightCloseRequest=t._closeRequest,t._closeRequest=void 0,eh(e);let r=e._closeAlgorithm();tb(e),p(r,()=>((function(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,"erroring"===e._state&&(e._storedError=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";let t=e._writer;void 0!==t&&t$(t)})(t),null),e=>(t._inFlightCloseRequest._reject(e),t._inFlightCloseRequest=void 0,void 0!==t._pendingAbortRequest&&(t._pendingAbortRequest._reject(e),t._pendingAbortRequest=void 0),tt(t,e),null))}(e):function(e,t){let r=e._controlledWritableStream;r._inFlightWriteRequest=r._writeRequests.shift(),p(e._writeAlgorithm(t),()=>{r._inFlightWriteRequest._resolve(void 0),r._inFlightWriteRequest=void 0;let t=r._state;return eh(e),to(r)||"writable"!==t||ta(r,0>=ty(e)),t_(e),null},t=>("writable"===r._state&&tb(e),r._inFlightWriteRequest._reject(t),r._inFlightWriteRequest=void 0,tt(r,t),null))}(e,r)}function tw(e,t){"writable"===e._controlledWritableStream._state&&tv(e,t)}function tv(e,t){let r=e._controlledWritableStream;tb(e),tr(r,t)}function tS(e){return TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function tx(e){return TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function tR(e){return TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function tP(e){return TypeError("Cannot "+e+" a stream using a released writer")}function tT(e){e._closedPromise=u((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r,e._closedPromiseState="pending"})}function tk(e,t){void 0!==e._closedPromise_reject&&(m(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function t$(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function tE(e){e._readyPromise=u((t,r)=>{e._readyPromise_resolve=t,e._readyPromise_reject=r}),e._readyPromiseState="pending"}function tA(e,t){tE(e),tO(e,t)}function tO(e,t){void 0!==e._readyPromise_reject&&(m(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function tC(e){void 0!==e._readyPromise_resolve&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}Object.defineProperties(tf.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(tf.prototype,Symbol.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});let tj="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof global?global:void 0,tq=function(){let e=null==tj?void 0:tj.DOMException;return!function(e){if(!("function"==typeof e||"object"==typeof e)||"DOMException"!==e.name)return!1;try{return new e,!0}catch(e){return!1}}(e)?void 0:e}()||function(){let e=function(e,t){this.message=e||"",this.name=t||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return a(e,"DOMException"),e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}();function tI(e,t,r,n,s,a){let i=z(e),l=new ti(t);e._disturbed=!0;let g=!1,b=d(void 0);return u((y,_)=>{var w,v;let S;if(void 0!==a){if(S=()=>{let r=void 0!==a.reason?a.reason:new tq("Aborted","AbortError"),o=[];n||o.push(()=>"writable"===t._state?e7(t,r):d(void 0)),s||o.push(()=>"readable"===e._state?t1(e,r):d(void 0)),P(()=>Promise.all(o.map(e=>e())),!0,r)},a.aborted){S();return}a.addEventListener("abort",S)}if(R(e,i._closedPromise,e=>(n?T(!0,e):P(()=>e7(t,e),!0,e),null)),R(t,l._closedPromise,t=>(s?T(!0,t):P(()=>t1(e,t),!0,t),null)),w=i._closedPromise,v=()=>(r?T():P(()=>(function(e){let t=e._ownerWritableStream,r=t._state;return to(t)||"closed"===r?d(void 0):"errored"===r?c(t._storedError):tc(e)})(l)),null),"closed"===e._state?v():p(w,v),to(t)||"closed"===t._state){let t=TypeError("the destination writable stream closed before all data could be piped to it");s?T(!0,t):P(()=>t1(e,t),!0,t)}function x(){let e=b;return h(b,()=>e!==b?x():void 0)}function R(e,t,r){"errored"===e._state?r(e._storedError):f(t,r)}function P(e,r,n){!g&&((g=!0,"writable"!==t._state||to(t))?o():p(x(),o));function o(){return p(e(),()=>$(r,n),e=>$(!0,e)),null}}function T(e,r){!g&&((g=!0,"writable"!==t._state||to(t))?$(e,r):p(x(),()=>$(e,r)))}function $(e,t){return td(l),k(i),void 0!==a&&a.removeEventListener("abort",S),e?_(t):y(void 0),null}m(u((e,t)=>{!function r(n){n?e():h(g?d(!0):h(l._readyPromise,()=>u((e,t)=>{Y(i,{_chunkSteps:t=>{b=h(th(l,t),void 0,o),e(!1)},_closeSteps:()=>e(!0),_errorSteps:t})})),r,t)}(!1)}))})}class tD{constructor(){throw TypeError("Illegal constructor")}get desiredSize(){if(!tL(this))throw tJ("desiredSize");return tF(this)}close(){if(!tL(this))throw tJ("close");if(!tH(this))throw TypeError("The stream is not in a state that permits close");tW(this)}enqueue(e){if(!tL(this))throw tJ("enqueue");if(!tH(this))throw TypeError("The stream is not in a state that permits enqueue");return tz(this,e)}error(e){if(!tL(this))throw tJ("error");tU(this,e)}[S](e){ef(this);let t=this._cancelAlgorithm(e);return tM(this),t}[x](e){let t=this._controlledReadableStream;if(this._queue.length>0){let r=eh(this);this._closeRequested&&0===this._queue.length?(tM(this),t2(t)):tB(this),e._chunkSteps(r)}else U(t,e),tB(this)}[R](){}}function tL(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream"))&&e instanceof tD}function tB(e){if(tN(e)){if(e._pulling){e._pullAgain=!0;return}e._pulling=!0,p(e._pullAlgorithm(),()=>(e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,tB(e)),null),t=>(tU(e,t),null))}}function tN(e){let t=e._controlledReadableStream;return!!tH(e)&&!!e._started&&!!(t0(t)&&H(t)>0||tF(e)>0)}function tM(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function tW(e){if(!tH(e))return;let t=e._controlledReadableStream;e._closeRequested=!0,0===e._queue.length&&(tM(e),t2(t))}function tz(e,t){if(!tH(e))return;let r=e._controlledReadableStream;if(t0(r)&&H(r)>0)F(r,t,!1);else{let r;try{r=e._strategySizeAlgorithm(t)}catch(t){throw tU(e,t),t}try{ep(e,t,r)}catch(t){throw tU(e,t),t}}tB(e)}function tU(e,t){let r=e._controlledReadableStream;"readable"===r._state&&(ef(e),tM(e),t3(r,t))}function tF(e){let t=e._controlledReadableStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function tH(e){let t=e._controlledReadableStream._state;return!e._closeRequested&&"readable"===t}function tV(e,t,r,n,o,s,a){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,ef(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=a,t._strategyHWM=s,t._pullAlgorithm=n,t._cancelAlgorithm=o,e._readableStreamController=t,p(d(r()),()=>(t._started=!0,tB(t),null),e=>(tU(t,e),null))}function tJ(e){return TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function tX(e,t){q(e,t);let r=null==e?void 0:e.preventAbort,n=null==e?void 0:e.preventCancel,o=null==e?void 0:e.preventClose,s=null==e?void 0:e.signal;return void 0!==s&&function(e,t){if(!function(e){if("object"!=typeof e||null===e)return!1;try{return"boolean"==typeof e.aborted}catch(e){return!1}}(e))throw TypeError(`${t} is not an AbortSignal.`)}(s,`${t} has member 'signal' that`),{preventAbort:!!r,preventCancel:!!n,preventClose:!!o,signal:s}}Object.defineProperties(tD.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),a(tD.prototype.close,"close"),a(tD.prototype.enqueue,"enqueue"),a(tD.prototype.error,"error"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(tD.prototype,Symbol.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});class tY{constructor(e={},t={}){void 0===e?e=null:D(e,"First parameter");let r=e2(t,"Second parameter"),n=function(e,t){q(e,t);let r=null==e?void 0:e.autoAllocateChunkSize,n=null==e?void 0:e.cancel,o=null==e?void 0:e.pull,s=null==e?void 0:e.start,a=null==e?void 0:e.type;return{autoAllocateChunkSize:void 0===r?void 0:M(r,`${t} has member 'autoAllocateChunkSize' that`),cancel:void 0===n?void 0:(I(n,`${t} has member 'cancel' that`),t=>y(n,e,[t])),pull:void 0===o?void 0:(I(o,`${t} has member 'pull' that`),t=>y(o,e,[t])),start:void 0===s?void 0:(I(s,`${t} has member 'start' that`),t=>b(s,e,[t])),type:void 0===a?void 0:function(e,t){if("bytes"!=(e=`${e}`))throw TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}(a,`${t} has member 'type' that`)}}(e,"First parameter");if(tQ(this),"bytes"===n.type){if(void 0!==r.size)throw RangeError("The strategy for a byte stream cannot have a size function");!function(e,t,r){let n,o,s;let a=Object.create(eb.prototype);n=void 0!==t.start?()=>t.start(a):()=>void 0,o=void 0!==t.pull?()=>t.pull(a):()=>d(void 0),s=void 0!==t.cancel?e=>t.cancel(e):()=>d(void 0);let i=t.autoAllocateChunkSize;if(0===i)throw TypeError("autoAllocateChunkSize must be greater than 0");eU(e,a,n,o,s,r,i)}(this,n,e0(r,0))}else{let e=e1(r);!function(e,t,r,n){let o,s;let a=Object.create(tD.prototype);o=void 0!==t.start?()=>t.start(a):()=>void 0,s=void 0!==t.pull?()=>t.pull(a):()=>d(void 0),tV(e,a,o,s,void 0!==t.cancel?e=>t.cancel(e):()=>d(void 0),r,n)}(this,n,e0(r,1),e)}}get locked(){if(!tZ(this))throw t8("locked");return t0(this)}cancel(e){return tZ(this)?t0(this)?c(TypeError("Cannot cancel a stream that already has a reader")):t1(this,e):c(t8("cancel"))}getReader(e){if(!tZ(this))throw t8("getReader");return void 0===function(e,t){q(e,t);let r=null==e?void 0:e.mode;return{mode:void 0===r?void 0:function(e,t){if("byob"!=(e=`${e}`))throw TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}(r,`${t} has member 'mode' that`)}}(e,"First parameter").mode?z(this):new eY(this)}pipeThrough(e,t={}){if(!tZ(this))throw t8("pipeThrough");L(e,1,"pipeThrough");let r=function(e,t){q(e,t);let r=null==e?void 0:e.readable;B(r,"readable","ReadableWritablePair"),W(r,`${t} has member 'readable' that`);let n=null==e?void 0:e.writable;return B(n,"writable","ReadableWritablePair"),e3(n,`${t} has member 'writable' that`),{readable:r,writable:n}}(e,"First parameter"),n=tX(t,"Second parameter");if(t0(this))throw TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(e9(r.writable))throw TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return m(tI(this,r.writable,n.preventClose,n.preventAbort,n.preventCancel,n.signal)),r.readable}pipeTo(e,t={}){let r;if(!tZ(this))return c(t8("pipeTo"));if(void 0===e)return c("Parameter 1 is required in 'pipeTo'.");if(!e5(e))return c(TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));try{r=tX(t,"Second parameter")}catch(e){return c(e)}return t0(this)?c(TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):e9(e)?c(TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):tI(this,e,r.preventClose,r.preventAbort,r.preventCancel,r.signal)}tee(){if(!tZ(this))throw t8("tee");let e=ey(this._readableStreamController)?function(e){let t,r,n,o,s,a=z(e),i=!1,l=!1,c=!1,h=!1,p=!1,m=u(e=>{s=e});function b(e){f(e._closedPromise,t=>(e!==a||(eL(n._readableStreamController,t),eL(o._readableStreamController,t),h&&p||s(void 0)),null))}function y(){eK(a)&&(k(a),b(a=z(e))),Y(a,{_chunkSteps:t=>{g(()=>{l=!1,c=!1;let r=t;if(!h&&!p)try{r=ed(t)}catch(t){eL(n._readableStreamController,t),eL(o._readableStreamController,t),s(t1(e,t));return}h||eD(n._readableStreamController,t),p||eD(o._readableStreamController,r),i=!1,l?w():c&&v()})},_closeSteps:()=>{i=!1,h||eI(n._readableStreamController),p||eI(o._readableStreamController),n._readableStreamController._pendingPullIntos.length>0&&eW(n._readableStreamController,0),o._readableStreamController._pendingPullIntos.length>0&&eW(o._readableStreamController,0),h&&p||s(void 0)},_errorSteps:()=>{i=!1}})}function _(t,r){X(a)&&(k(a),b(a=new eY(e)));let u=r?o:n,d=r?n:o;eG(a,t,1,{_chunkSteps:t=>{g(()=>{l=!1,c=!1;let n=r?p:h;if(r?h:p)n||ez(u._readableStreamController,t);else{let r;try{r=ed(t)}catch(t){eL(u._readableStreamController,t),eL(d._readableStreamController,t),s(t1(e,t));return}n||ez(u._readableStreamController,t),eD(d._readableStreamController,r)}i=!1,l?w():c&&v()})},_closeSteps:e=>{i=!1;let t=r?p:h,n=r?h:p;t||eI(u._readableStreamController),n||eI(d._readableStreamController),void 0!==e&&(t||ez(u._readableStreamController,e),!n&&d._readableStreamController._pendingPullIntos.length>0&&eW(d._readableStreamController,0)),t&&n||s(void 0)},_errorSteps:()=>{i=!1}})}function w(){if(i)return l=!0,d(void 0);i=!0;let e=eN(n._readableStreamController);return null===e?y():_(e._view,!1),d(void 0)}function v(){if(i)return c=!0,d(void 0);i=!0;let e=eN(o._readableStreamController);return null===e?y():_(e._view,!0),d(void 0)}function S(){}return n=tG(S,w,function(n){if(h=!0,t=n,p){let n=t1(e,eo([t,r]));s(n)}return m}),o=tG(S,v,function(n){if(p=!0,r=n,h){let n=t1(e,eo([t,r]));s(n)}return m}),b(a),[n,o]}(this):function(e,t){let r,n,o,s,a;let i=z(e),l=!1,c=!1,h=!1,p=!1,m=u(e=>{a=e});function b(){return l?c=!0:(l=!0,Y(i,{_chunkSteps:e=>{g(()=>{c=!1,h||tz(o._readableStreamController,e),p||tz(s._readableStreamController,e),l=!1,c&&b()})},_closeSteps:()=>{l=!1,h||tW(o._readableStreamController),p||tW(s._readableStreamController),h&&p||a(void 0)},_errorSteps:()=>{l=!1}})),d(void 0)}function y(){}return o=tK(y,b,function(t){if(h=!0,r=t,p){let t=t1(e,eo([r,n]));a(t)}return m}),s=tK(y,b,function(t){if(p=!0,n=t,h){let t=t1(e,eo([r,n]));a(t)}return m}),f(i._closedPromise,e=>(tU(o._readableStreamController,e),tU(s._readableStreamController,e),h&&p||a(void 0),null)),[o,s]}(this);return eo(e)}values(e){if(!tZ(this))throw t8("values");return function(e,t){let r=new Z(z(e),t),n=Object.create(ee);return n._asyncIteratorImpl=r,n}(this,(q(e,"First parameter"),{preventCancel:!!(null==e?void 0:e.preventCancel)}).preventCancel)}[eu](e){return this.values(e)}static from(e){var t;let r;return s(e)&&void 0!==e.getReader?(t=e.getReader(),r=tK(o,function(){let e;try{e=t.read()}catch(e){return c(e)}return h(e,e=>{if(!s(e))throw TypeError("The promise returned by the reader.read() method must fulfill with an object");if(e.done)tW(r._readableStreamController);else{let t=e.value;tz(r._readableStreamController,t)}},void 0)},function(e){try{return d(t.cancel(e))}catch(e){return c(e)}},0)):function(e){let t;let r=function e(t,r="sync",n){if(void 0===n){if("async"===r){if(void 0===(n=ec(t,eu))){let r=ec(t,Symbol.iterator);return function(e){let t={[Symbol.iterator]:()=>e.iterator},r=async function*(){return yield*t}(),n=r.next;return{iterator:r,nextMethod:n,done:!1}}(e(t,"sync",r))}}else n=ec(t,Symbol.iterator)}if(void 0===n)throw TypeError("The object is not iterable");let o=b(n,t,[]);if(!s(o))throw TypeError("The iterator method must return an object");let a=o.next;return{iterator:o,nextMethod:a,done:!1}}(e,"async");return t=tK(o,function(){let e;try{e=function(e){let t=b(e.nextMethod,e.iterator,[]);if(!s(t))throw TypeError("The iterator.next() method must return an object");return t}(r)}catch(e){return c(e)}return h(d(e),e=>{if(!s(e))throw TypeError("The promise returned by the iterator.next() method must fulfill with an object");if(e.done)tW(t._readableStreamController);else{let r=e.value;tz(t._readableStreamController,r)}},void 0)},function(e){let t,n;let o=r.iterator;try{t=ec(o,"return")}catch(e){return c(e)}if(void 0===t)return d(void 0);try{n=b(t,o,[e])}catch(e){return c(e)}return h(d(n),e=>{if(!s(e))throw TypeError("The promise returned by the iterator.return() method must fulfill with an object")},void 0)},0)}(e)}}function tK(e,t,r,n=1,o=()=>1){let s=Object.create(tY.prototype);return tQ(s),tV(s,Object.create(tD.prototype),e,t,r,n,o),s}function tG(e,t,r){let n=Object.create(tY.prototype);return tQ(n),eU(n,Object.create(eb.prototype),e,t,r,0,void 0),n}function tQ(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function tZ(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_readableStreamController"))&&e instanceof tY}function t0(e){return void 0!==e._reader}function t1(e,t){if(e._disturbed=!0,"closed"===e._state)return d(void 0);if("errored"===e._state)return c(e._storedError);t2(e);let r=e._reader;if(void 0!==r&&eK(r)){let e=r._readIntoRequests;r._readIntoRequests=new _,e.forEach(e=>{e._closeSteps(void 0)})}return h(e._readableStreamController[S](t),o,void 0)}function t2(e){e._state="closed";let t=e._reader;if(void 0!==t&&(O(t),X(t))){let e=t._readRequests;t._readRequests=new _,e.forEach(e=>{e._closeSteps()})}}function t3(e,t){e._state="errored",e._storedError=t;let r=e._reader;void 0!==r&&(A(r,t),X(r)?K(r,t):eQ(r,t))}function t8(e){return TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function t4(e,t){q(e,t);let r=null==e?void 0:e.highWaterMark;return B(r,"highWaterMark","QueuingStrategyInit"),{highWaterMark:N(r)}}Object.defineProperties(tY,{from:{enumerable:!0}}),Object.defineProperties(tY.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),a(tY.from,"from"),a(tY.prototype.cancel,"cancel"),a(tY.prototype.getReader,"getReader"),a(tY.prototype.pipeThrough,"pipeThrough"),a(tY.prototype.pipeTo,"pipeTo"),a(tY.prototype.tee,"tee"),a(tY.prototype.values,"values"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(tY.prototype,Symbol.toStringTag,{value:"ReadableStream",configurable:!0}),Object.defineProperty(tY.prototype,eu,{value:tY.prototype.values,writable:!0,configurable:!0});let t6=e=>e.byteLength;a(t6,"size");class t5{constructor(e){L(e,1,"ByteLengthQueuingStrategy"),e=t4(e,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!t7(this))throw t9("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!t7(this))throw t9("size");return t6}}function t9(e){return TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function t7(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark"))&&e instanceof t5}Object.defineProperties(t5.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(t5.prototype,Symbol.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});let re=()=>1;a(re,"size");class rt{constructor(e){L(e,1,"CountQueuingStrategy"),e=t4(e,"First parameter"),this._countQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!rn(this))throw rr("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!rn(this))throw rr("size");return re}}function rr(e){return TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function rn(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark"))&&e instanceof rt}Object.defineProperties(rt.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(rt.prototype,Symbol.toStringTag,{value:"CountQueuingStrategy",configurable:!0});class ro{constructor(e={},t={},r={}){let n;void 0===e&&(e=null);let o=e2(t,"Second parameter"),s=e2(r,"Third parameter"),a=function(e,t){q(e,t);let r=null==e?void 0:e.cancel,n=null==e?void 0:e.flush,o=null==e?void 0:e.readableType,s=null==e?void 0:e.start,a=null==e?void 0:e.transform,i=null==e?void 0:e.writableType;return{cancel:void 0===r?void 0:(I(r,`${t} has member 'cancel' that`),t=>y(r,e,[t])),flush:void 0===n?void 0:(I(n,`${t} has member 'flush' that`),t=>y(n,e,[t])),readableType:o,start:void 0===s?void 0:(I(s,`${t} has member 'start' that`),t=>b(s,e,[t])),transform:void 0===a?void 0:(I(a,`${t} has member 'transform' that`),(t,r)=>y(a,e,[t,r])),writableType:i}}(e,"First parameter");if(void 0!==a.readableType)throw RangeError("Invalid readableType specified");if(void 0!==a.writableType)throw RangeError("Invalid writableType specified");let i=e0(s,0),l=e1(s),f=e0(o,1),m=e1(o);(function(e,t,r,n,o,s){function a(){return t}e._writable=function(e,t,r,n,o=1,s=()=>1){let a=Object.create(e4.prototype);return e6(a),tg(a,Object.create(tf.prototype),e,t,r,n,o,s),a}(a,function(t){return function(e,t){let r=e._transformStreamController;return e._backpressure?h(e._backpressureChangePromise,()=>{let n=e._writable;if("erroring"===n._state)throw n._storedError;return rf(r,t)},void 0):rf(r,t)}(e,t)},function(){return function(e){let t=e._transformStreamController;if(void 0!==t._finishPromise)return t._finishPromise;let r=e._readable;t._finishPromise=u((e,r)=>{t._finishPromise_resolve=e,t._finishPromise_reject=r});let n=t._flushAlgorithm();return rh(t),p(n,()=>("errored"===r._state?rb(t,r._storedError):(tW(r._readableStreamController),rg(t)),null),e=>(tU(r._readableStreamController,e),rb(t,e),null)),t._finishPromise}(e)},function(t){return function(e,t){let r=e._transformStreamController;if(void 0!==r._finishPromise)return r._finishPromise;let n=e._readable;r._finishPromise=u((e,t)=>{r._finishPromise_resolve=e,r._finishPromise_reject=t});let o=r._cancelAlgorithm(t);return rh(r),p(o,()=>("errored"===n._state?rb(r,n._storedError):(tU(n._readableStreamController,t),rg(r)),null),e=>(tU(n._readableStreamController,e),rb(r,e),null)),r._finishPromise}(e,t)},r,n),e._readable=tK(a,function(){return rc(e,!1),e._backpressureChangePromise},function(t){return function(e,t){let r=e._transformStreamController;if(void 0!==r._finishPromise)return r._finishPromise;let n=e._writable;r._finishPromise=u((e,t)=>{r._finishPromise_resolve=e,r._finishPromise_reject=t});let o=r._cancelAlgorithm(t);return rh(r),p(o,()=>("errored"===n._state?rb(r,n._storedError):(tw(n._writableStreamController,t),rl(e),rg(r)),null),t=>(tw(n._writableStreamController,t),rl(e),rb(r,t),null)),r._finishPromise}(e,t)},o,s),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,rc(e,!0),e._transformStreamController=void 0})(this,u(e=>{n=e}),f,m,i,l),function(e,t){let r,n,o;let s=Object.create(ru.prototype);r=void 0!==t.transform?e=>t.transform(e,s):e=>{try{return rp(s,e),d(void 0)}catch(e){return c(e)}},n=void 0!==t.flush?()=>t.flush(s):()=>d(void 0),o=void 0!==t.cancel?e=>t.cancel(e):()=>d(void 0),s._controlledTransformStream=e,e._transformStreamController=s,s._transformAlgorithm=r,s._flushAlgorithm=n,s._cancelAlgorithm=o,s._finishPromise=void 0,s._finishPromise_resolve=void 0,s._finishPromise_reject=void 0}(this,a),void 0!==a.start?n(a.start(this._transformStreamController)):n(void 0)}get readable(){if(!rs(this))throw ry("readable");return this._readable}get writable(){if(!rs(this))throw ry("writable");return this._writable}}function rs(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_transformStreamController"))&&e instanceof ro}function ra(e,t){tU(e._readable._readableStreamController,t),ri(e,t)}function ri(e,t){rh(e._transformStreamController),tw(e._writable._writableStreamController,t),rl(e)}function rl(e){e._backpressure&&rc(e,!1)}function rc(e,t){void 0!==e._backpressureChangePromise&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=u(t=>{e._backpressureChangePromise_resolve=t}),e._backpressure=t}Object.defineProperties(ro.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(ro.prototype,Symbol.toStringTag,{value:"TransformStream",configurable:!0});class ru{constructor(){throw TypeError("Illegal constructor")}get desiredSize(){if(!rd(this))throw rm("desiredSize");return tF(this._controlledTransformStream._readable._readableStreamController)}enqueue(e){if(!rd(this))throw rm("enqueue");rp(this,e)}error(e){if(!rd(this))throw rm("error");ra(this._controlledTransformStream,e)}terminate(){if(!rd(this))throw rm("terminate");(function(e){let t=e._controlledTransformStream;tW(t._readable._readableStreamController),ri(t,TypeError("TransformStream terminated"))})(this)}}function rd(e){return!!(s(e)&&Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream"))&&e instanceof ru}function rh(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0,e._cancelAlgorithm=void 0}function rp(e,t){let r=e._controlledTransformStream,n=r._readable._readableStreamController;if(!tH(n))throw TypeError("Readable side is not in a state that permits enqueue");try{tz(n,t)}catch(e){throw ri(r,e),r._readable._storedError}!tN(n)!==r._backpressure&&rc(r,!0)}function rf(e,t){return h(e._transformAlgorithm(t),void 0,t=>{throw ra(e._controlledTransformStream,t),t})}function rm(e){return TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function rg(e){void 0!==e._finishPromise_resolve&&(e._finishPromise_resolve(),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function rb(e,t){void 0!==e._finishPromise_reject&&(m(e._finishPromise),e._finishPromise_reject(t),e._finishPromise_resolve=void 0,e._finishPromise_reject=void 0)}function ry(e){return TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}Object.defineProperties(ru.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),a(ru.prototype.enqueue,"enqueue"),a(ru.prototype.error,"error"),a(ru.prototype.terminate,"terminate"),"symbol"==typeof Symbol.toStringTag&&Object.defineProperty(ru.prototype,Symbol.toStringTag,{value:"TransformStreamDefaultController",configurable:!0}),e.ByteLengthQueuingStrategy=t5,e.CountQueuingStrategy=rt,e.ReadableByteStreamController=eb,e.ReadableStream=tY,e.ReadableStreamBYOBReader=eY,e.ReadableStreamBYOBRequest=eg,e.ReadableStreamDefaultController=tD,e.ReadableStreamDefaultReader=J,e.TransformStream=ro,e.TransformStreamDefaultController=ru,e.WritableStream=e4,e.WritableStreamDefaultController=tf,e.WritableStreamDefaultWriter=ti})(t)},5242:(e,t,r)=>{if(!globalThis.ReadableStream)try{let e=r(7742),{emitWarning:t}=e;try{e.emitWarning=()=>{},Object.assign(globalThis,r(2477)),e.emitWarning=t}catch(r){throw e.emitWarning=t,r}}catch(e){Object.assign(globalThis,r(2873))}try{let{Blob:e}=r(8893);e&&!e.prototype.stream&&(e.prototype.stream=function(e){let t=0,r=this;return new ReadableStream({type:"bytes",async pull(e){let n=r.slice(t,Math.min(r.size,t+65536)),o=await n.arrayBuffer();t+=o.byteLength,e.enqueue(new Uint8Array(o)),t===r.size&&e.close()}})})}catch(e){}},603:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(598);let o=class extends n.Z{#e=0;#t="";constructor(e,t,r={}){if(arguments.length<2)throw TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,r),null===r&&(r={});let n=void 0===r.lastModified?Date.now():Number(r.lastModified);Number.isNaN(n)||(this.#e=n),this.#t=String(t)}get name(){return this.#t}get lastModified(){return this.#e}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof n.Z&&/^(File)$/.test(e[Symbol.toStringTag])}}},2591:(e,t,r)=>{"use strict";r.d(t,{$B:()=>s.Z});let n=require("node:fs");require("node:path");var o=r(3352),s=r(603);r(598);let{stat:a}=n.promises;class i{#r;#n;constructor(e){this.#r=e.path,this.#n=e.start,this.size=e.size,this.lastModified=e.lastModified}slice(e,t){return new i({path:this.#r,lastModified:this.lastModified,size:t-e,start:this.#n+e})}async *stream(){let{mtimeMs:e}=await a(this.#r);if(e>this.lastModified)throw new o("The requested file could not be read, typically due to permission problems that have occurred after a reference to a file was acquired.","NotReadableError");yield*(0,n.createReadStream)(this.#r,{start:this.#n,end:this.#n+this.size-1})}get[Symbol.toStringTag](){return"Blob"}}},598:(e,t,r)=>{"use strict";async function*n(e,t=!0){for(let r of e)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r)){if(t){let e=r.byteOffset,t=r.byteOffset+r.byteLength;for(;e!==t;){let n=Math.min(t-e,65536),o=r.buffer.slice(e,e+n);e+=o.byteLength,yield new Uint8Array(o)}}else yield r}else{let e=0;for(;e!==r.size;){let t=r.slice(e,Math.min(r.size,e+65536)),n=await t.arrayBuffer();e+=n.byteLength,yield new Uint8Array(n)}}}r.d(t,{Z:()=>s}),r(5242);let o=class e{#o=[];#s="";#a=0;#i="transparent";constructor(t=[],r={}){if("object"!=typeof t||null===t)throw TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if("function"!=typeof t[Symbol.iterator])throw TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if("object"!=typeof r&&"function"!=typeof r)throw TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");null===r&&(r={});let n=new TextEncoder;for(let r of t){let t;t=ArrayBuffer.isView(r)?new Uint8Array(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)):r instanceof ArrayBuffer?new Uint8Array(r.slice(0)):r instanceof e?r:n.encode(`${r}`),this.#a+=ArrayBuffer.isView(t)?t.byteLength:t.size,this.#o.push(t)}this.#i=`${void 0===r.endings?"transparent":r.endings}`;let o=void 0===r.type?"":String(r.type);this.#s=/^[\x20-\x7E]*$/.test(o)?o:""}get size(){return this.#a}get type(){return this.#s}async text(){let e=new TextDecoder,t="";for await(let r of n(this.#o,!1))t+=e.decode(r,{stream:!0});return t+e.decode()}async arrayBuffer(){let e=new Uint8Array(this.size),t=0;for await(let r of n(this.#o,!1))e.set(r,t),t+=r.length;return e.buffer}stream(){let e=n(this.#o,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){let r=await e.next();r.done?t.close():t.enqueue(r.value)},async cancel(){await e.return()}})}slice(t=0,r=this.size,n=""){let{size:o}=this,s=t<0?Math.max(o+t,0):Math.min(t,o),a=r<0?Math.max(o+r,0):Math.min(r,o),i=Math.max(a-s,0),l=this.#o,c=[],u=0;for(let e of l){if(u>=i)break;let t=ArrayBuffer.isView(e)?e.byteLength:e.size;if(s&&t<=s)s-=t,a-=t;else{let r;ArrayBuffer.isView(e)?u+=(r=e.subarray(s,Math.min(t,a))).byteLength:u+=(r=e.slice(s,Math.min(t,a))).size,a-=t,c.push(r),s=0}}let d=new e([],{type:String(n).toLowerCase()});return d.#a=i,d.#o=c,d}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&"object"==typeof e&&"function"==typeof e.constructor&&("function"==typeof e.stream||"function"==typeof e.arrayBuffer)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(o.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});let s=o},8620:(e,t,r)=>{"use strict";r.d(t,{Ct:()=>p,au:()=>f});var n=r(598),o=r(603),{toStringTag:s,iterator:a,hasInstance:i}=Symbol,l=Math.random,c="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),u=(e,t,r)=>(e+="",/^(Blob|File)$/.test(t&&t[s])?[(r=void 0!==r?r+"":"File"==t[s]?t.name:"blob",e),t.name!==r||"blob"==t[s]?new o.Z([t],r,t):t]:[e,t+""]),d=(e,t)=>(t?e:e.replace(/\r?\n|\r/g,"\r\n")).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),h=(e,t,r)=>{if(t.length<r)throw TypeError(`Failed to execute '${e}' on 'FormData': ${r} arguments required, but only ${t.length} present.`)};let p=class{#l=[];constructor(...e){if(e.length)throw TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[s](){return"FormData"}[a](){return this.entries()}static[i](e){return e&&"object"==typeof e&&"FormData"===e[s]&&!c.some(t=>"function"!=typeof e[t])}append(...e){h("append",arguments,2),this.#l.push(u(...e))}delete(e){h("delete",arguments,1),e+="",this.#l=this.#l.filter(([t])=>t!==e)}get(e){h("get",arguments,1),e+="";for(var t=this.#l,r=t.length,n=0;n<r;n++)if(t[n][0]===e)return t[n][1];return null}getAll(e,t){return h("getAll",arguments,1),t=[],e+="",this.#l.forEach(r=>r[0]===e&&t.push(r[1])),t}has(e){return h("has",arguments,1),e+="",this.#l.some(t=>t[0]===e)}forEach(e,t){for(var[r,n]of(h("forEach",arguments,1),this))e.call(t,n,r,this)}set(...e){h("set",arguments,2);var t=[],r=!0;e=u(...e),this.#l.forEach(n=>{n[0]===e[0]?r&&(r=!t.push(e)):t.push(n)}),r&&t.push(e),this.#l=t}*entries(){yield*this.#l}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}};function f(e,t=n.Z){var r=`${l()}${l()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),o=[],s=`--${r}\r
Content-Disposition: form-data; name="`;return e.forEach((e,t)=>"string"==typeof e?o.push(s+d(t)+`"\r
\r
${e.replace(/\r(?!\n)|(?<!\r)\n/g,"\r\n")}\r
`):o.push(s+d(t)+`"; filename="${d(e.name,1)}"\r
Content-Type: ${e.type||"application/octet-stream"}\r
\r
`,e,"\r\n")),o.push(`--${r}--`),new t(o,{type:"multipart/form-data; boundary="+r})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[379],()=>r(1111));module.exports=n})();